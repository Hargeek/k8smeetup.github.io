
<p>本文介绍通过Kubernetes Deployment对象如何去运行一个应用.</p>

<ul id="markdown-toc">
  <li><a href="#objectives" id="markdown-toc-objectives">Objectives</a></li>
  <li><a href="#before-you-begin" id="markdown-toc-before-you-begin">Before you begin</a></li>
  <li><a href="#创建和探究一个nginx-deployment" id="markdown-toc-创建和探究一个nginx-deployment">创建和探究一个nginx deployment</a></li>
  <li><a href="#更新deployment" id="markdown-toc-更新deployment">更新deployment</a></li>
  <li><a href="#通过增加副本数来弹缩应用" id="markdown-toc-通过增加副本数来弹缩应用">通过增加副本数来弹缩应用</a></li>
  <li><a href="#删除deployment" id="markdown-toc-删除deployment">删除deployment</a></li>
  <li><a href="#replicationcontrollers--旧的方式" id="markdown-toc-replicationcontrollers--旧的方式">ReplicationControllers – 旧的方式</a></li>
  <li><a href="#whats-next" id="markdown-toc-whats-next">What’s next</a></li>
</ul>

<h2 id="objectives">Objectives</h2>

<ul>
  <li>创建一个nginx deployment.</li>
  <li>使用kubectl列举关于deployment信息.</li>
  <li>更新deployment.</li>
</ul>

<h2 id="before-you-begin">Before you begin</h2>

<p>You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. If you do not already have a
cluster, you can create one by using
<a href="/docs/getting-started-guides/minikube">Minikube</a>,
or you can use one of these Kubernetes playgrounds:</p>

<ul>
  <li><a href="https://www.katacoda.com/courses/kubernetes/playground">Katacoda</a></li>
  <li><a href="http://labs.play-with-k8s.com/">Play with Kubernetes</a></li>
</ul>

<p>To check the version, enter <code class="highlighter-rouge">kubectl version</code>.</p>

<h2 id="创建和探究一个nginx-deployment">创建和探究一个nginx deployment</h2>

<p>你可以通过创建一个Kubernetes Deployment对象来运行一个应用, 可以在一个YAML文件中描述Deployment. 例如, 下面这个YAML文件描述了一个运行nginx:1.7.9 Docker镜像的Deployment:</p>

<table class="includecode">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/cn/docs/tasks/run-application/deployment.yaml" download="deployment.yaml">
                    <code>deployment.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('deployment.yaml')" title="Copy deployment.yaml to clipboard" />
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
<div id="deployment.yaml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nginx-deployment</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="s">2</span> <span class="c1"># tells deployment to run 2 pods matching the template</span>
  <span class="na">template</span><span class="pi">:</span> <span class="c1"># create pods using pod definition in this template</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="c1"># unlike pod-nginx.yaml, the name is not included in the meta data as a unique name is</span>
      <span class="c1"># generated from the deployment name</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:1.7.9</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre></div></div>
</td>
        </tr>
    </tbody>
</table>

<ol>
  <li>
    <p>通过YAML文件创建一个Deployment:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create -f https://k8s.io/docs/tasks/run-application/deployment.yaml
</code></pre></div>    </div>
  </li>
  <li>
    <p>展示Deployment相关信息:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl describe deployment nginx-deployment

 user@computer:~/website$ kubectl describe deployment nginx-deployment
 Name:     nginx-deployment
 Namespace:    default
 CreationTimestamp:  Tue, 30 Aug 2016 18:11:37 -0700
 Labels:     app=nginx
 Annotations:    deployment.kubernetes.io/revision=1
 Selector:   app=nginx
 Replicas:   2 desired | 2 updated | 2 total | 2 available | 0 unavailable
 StrategyType:   RollingUpdate
 MinReadySeconds:  0
 RollingUpdateStrategy:  1 max unavailable, 1 max surge
 Pod Template:
   Labels:       app=nginx
   Containers:
    nginx:
     Image:              nginx:1.7.9
     Port:               80/TCP
     Environment:        &lt;none&gt;
     Mounts:             &lt;none&gt;
   Volumes:              &lt;none&gt;
 Conditions:
   Type          Status  Reason
   ----          ------  ------
   Available     True    MinimumReplicasAvailable
   Progressing   True    NewReplicaSetAvailable
 OldReplicaSets:   &lt;none&gt;
 NewReplicaSet:    nginx-deployment-1771418926 (2/2 replicas created)
 No events.
</code></pre></div>    </div>
  </li>
  <li>
    <p>列出deployment创建的pods:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pods -l app=nginx

 NAME                                READY     STATUS    RESTARTS   AGE
 nginx-deployment-1771418926-7o5ns   1/1       Running   0          16h
 nginx-deployment-1771418926-r18az   1/1       Running   0          16h
</code></pre></div>    </div>
  </li>
  <li>
    <p>展示某一个pod信息:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl describe pod &lt;pod-name&gt;
</code></pre></div>    </div>

    <p>该处 <code class="highlighter-rouge">&lt;pod-name&gt;</code> 指某一pod的名称.</p>
  </li>
</ol>

<h2 id="更新deployment">更新deployment</h2>

<p>你可以通过更新一个新的YAML文件来更新deployment. 下面的YAML文件指定该deployment镜像更新为nginx 1.8.</p>

<table class="includecode">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/cn/docs/tutorials/stateless-application/deployment-update.yaml" download="deployment-update.yaml">
                    <code>deployment-update.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('deployment-update.yaml')" title="Copy deployment-update.yaml to clipboard" />
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
<div id="deployment-update.yaml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nginx-deployment</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="s">2</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:1.8</span> <span class="c1"># Update the version of nginx from 1.7.9 to 1.8</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre></div></div>
</td>
        </tr>
    </tbody>
</table>

<ol>
  <li>
    <p>应用新的YAML:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply -f https://k8s.io/docs/tutorials/stateless-application/deployment-update.yaml
</code></pre></div>    </div>
  </li>
  <li>
    <p>查看该deployment创建的pods以新的名称同时删除旧的pods:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pods -l app=nginx
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="通过增加副本数来弹缩应用">通过增加副本数来弹缩应用</h2>

<p>你可以通过应用新的YAML文件来增加Deployment中pods的数量. 该YAML文件将<code class="highlighter-rouge">replicas</code>设置为4, 指定该Deployment应有4个pods:</p>

<table class="includecode">
    <thead>
        <tr>
            <th>
                <a href="https://raw.githubusercontent.com/kubernetes/website/master/cn/docs/tutorials/stateless-application/deployment-scale.yaml" download="deployment-scale.yaml">
                    <code>deployment-scale.yaml</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('deployment-scale.yaml')" title="Copy deployment-scale.yaml to clipboard" />
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
<div id="deployment-scale.yaml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nginx-deployment</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="s">4</span> <span class="c1"># Update the replicas from 2 to 4</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:1.8</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre></div></div>
</td>
        </tr>
    </tbody>
</table>

<ol>
  <li>
    <p>应用新的YAML文件:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply -f https://k8s.io/docs/tutorials/stateless-application/deployment-scale.yaml
</code></pre></div>    </div>
  </li>
  <li>
    <p>验证Deployment有4个pods:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pods -l app=nginx
</code></pre></div>    </div>

    <p>输出的结果类似于:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> NAME                               READY     STATUS    RESTARTS   AGE
 nginx-deployment-148880595-4zdqq   1/1       Running   0          25s
 nginx-deployment-148880595-6zgi1   1/1       Running   0          25s
 nginx-deployment-148880595-fxcez   1/1       Running   0          2m
 nginx-deployment-148880595-rwovn   1/1       Running   0          2m
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="删除deployment">删除deployment</h2>

<p>通过名称删除deployment:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl delete deployment nginx-deployment
</code></pre></div></div>

<h2 id="replicationcontrollers--旧的方式">ReplicationControllers – 旧的方式</h2>

<p>创建一个多副本应用首选方法是使用Deployment,反过来使用ReplicaSet. 在Deployment和ReplicaSet加入到Kubernetes之前, 多副本应用通过<a href="/docs/concepts/workloads/controllers/replicationcontroller/">ReplicationController</a>来配置.</p>

<h2 id="whats-next">What’s next</h2>

<ul>
  <li>了解更多 <a href="/docs/concepts/workloads/controllers/deployment/">Deployment objects</a>.</li>
</ul>

