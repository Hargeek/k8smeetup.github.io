
  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    

<!Doctype html>
<html id="docs" class="Concepts">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono">
    <link rel="stylesheet" type="text/css" href="/css/styles.css"><!-- default styles.css on -->
    <link rel="stylesheet" type="text/css" href="/css/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="/css/sweetalert.css">
    <link rel="stylesheet" type="text/css" href="/css/callouts.css">
    <link rel="stylesheet" type="text/css" href="/css/custom-jekyll/tags.css">
    
    
    <!-- no custom css detected -->

    
    <meta name="description" content="Images" />
    

    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/jquery-ui.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/sweetalert.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/custom-jekyll/tags.js"></script>
    <!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Images | Kubernetes</title>
<meta property="og:title" content="Images" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Production-Grade Container Orchestration" />
<meta property="og:description" content="Production-Grade Container Orchestration" />
<link rel="canonical" href="http://0.0.0.0:4000/docs/concepts/containers/images/" />
<meta property="og:url" content="http://0.0.0.0:4000/docs/concepts/containers/images/" />
<meta property="og:site_name" content="Kubernetes" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@kubernetesio" />
<script type="application/ld+json">
{"name":null,"description":"Production-Grade Container Orchestration","author":null,"@type":"WebPage","url":"http://0.0.0.0:4000/docs/concepts/containers/images/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/images/favicon.png"}},"image":null,"headline":"Images","dateModified":null,"datePublished":null,"sameAs":null,"mainEntityOfPage":null,"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>

<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            <li><a href="/docs/home/">Documentation</a></li>
            <li><a href="http://blog.kubernetes.io/">Blog</a></li>
            <li><a href="/partners/">Partners</a></li>
            <li><a href="/community/">Community</a></li>
            <li><a href="/case-studies/">Case Studies</a></li>
            <li>
                <a href="#">
                    v1.8 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                  <li><a href="https://kubernetes.io/docs/home/">v1.8</a></li>
                
                  <li><a href="https://v1-7.docs.kubernetes.io/docs/home/">v1.7</a></li>
                
                  <li><a href="https://v1-6.docs.kubernetes.io/docs/home/">v1.6</a></li>
                
                  <li><a href="https://v1-5.docs.kubernetes.io/docs/">v1.5</a></li>
                
                  <li><a href="https://v1-4.docs.kubernetes.io/docs/">v1.4</a></li>
                
                </ul>
              </li>
            </li>
        </ul>
        <!-- <a href="/docs/home" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a> -->
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
        <div class="nav-box">
            <h3><a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a></h3>
            <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
            <p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
        </div>
        <div class="nav-box">
            <h3><a href="/community/">Community</a></h3>
            <p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
        </div>
        <div class="nav-box">
            <h3><a href="http://blog.kubernetes.io">Blog</a></h3>
            <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
        </div>
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Concepts</h1>
  <h5>Detailed explanations of Kubernetes system concepts and abstractions.</h5>
  <div id="vendorStrip" class="light-text">
    <ul>
      <li><a href="/docs/home/" >HOME</a></li>
      <li><a href="/docs/setup/" >SETUP</a></li>
      <li><a href="/docs/concepts/" class="YAH">CONCEPTS</a></li>
      <li><a href="/docs/tasks/" >TASKS</a></li>
      <li><a href="/docs/tutorials/" >TUTORIALS</a></li>
      <li><a href="/docs/reference/" >REFERENCE</a></li>
    </ul>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)" autofocus="autofocus">
    </div>
  </div>
</section>




<section id="encyclopedia">
  <div id="docsToc">
        <div class="pi-accordion">
          
  

    

    
      <a class="item" data-title="Concepts" href="/docs/concepts/"></a>
    
  

  
    <div class="item" data-title="Overview">
      <div class="container">
        
  

    

    
      <a class="item" data-title="认识 Kubernetes?" href="/docs/concepts/overview/what-is-kubernetes/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes 组件" href="/docs/concepts/overview/components/"></a>
    
  

  
    <div class="item" data-title="Working with Kubernetes Objects">
      <div class="container">
        
  

    

    
      <a class="item" data-title="理解 Kubernetes 对象" href="/docs/concepts/overview/working-with-objects/kubernetes-objects/"></a>
    
  

  

    

    
      <a class="item" data-title="Names" href="/docs/concepts/overview/working-with-objects/names/"></a>
    
  

  

    

    
      <a class="item" data-title="Namespaces" href="/docs/concepts/overview/working-with-objects/namespaces/"></a>
    
  

  

    

    
      <a class="item" data-title="Labels 和 Selectors" href="/docs/concepts/overview/working-with-objects/labels/"></a>
    
  

  

    

    
      <a class="item" data-title="Annotations" href="/docs/concepts/overview/working-with-objects/annotations/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="Kubernetes API" href="/docs/concepts/overview/kubernetes-api/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Kubernetes Architecture">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Nodes" href="/docs/concepts/architecture/nodes/"></a>
    
  

  

    

    
      <a class="item" data-title="Master 节点通信" href="/docs/concepts/architecture/master-node-communication/"></a>
    
  

  

    

    
      <a class="item" data-title="云控制器管理器的基础概念" href="/docs/concepts/architecture/cloud-controller/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Extending Kubernetes">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Extending your Kubernetes Cluster" href="/docs/concepts/overview/extending/"></a>
    
  

  
    <div class="item" data-title="Extending the Kubernetes API">
      <div class="container">
        
  

    

    
      <a class="item" data-title="使用聚合层扩展Kubernetes API" href="/docs/concepts/api-extension/apiserver-aggregation/"></a>
    
  

  

    

    
      <a class="item" data-title="自定义资源" href="/docs/concepts/api-extension/custom-resources/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Compute, Storage, and Networking Extensions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="网络插件" href="/docs/concepts/cluster-administration/network-plugins/"></a>
    
  

  

    

    
      <a class="item" data-title="设备插件" href="/docs/concepts/cluster-administration/device-plugins/"></a>
    
  

  

    

    
      <a class="item" data-title="Using Sysctls in a Kubernetes Cluster" href="/docs/concepts/cluster-administration/sysctl-cluster/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="Service Catalog" href="/docs/concepts/service-catalog/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Containers">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Images" href="/docs/concepts/containers/images/"></a>
    
  

  

    

    
      <a class="item" data-title="容器环境变量" href="/docs/concepts/containers/container-environment-variables/"></a>
    
  

  

    

    
      <a class="item" data-title="容器生命周期的钩子" href="/docs/concepts/containers/container-lifecycle-hooks/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Workloads">
      <div class="container">
        
  
    <div class="item" data-title="Pods">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Pod Overview" href="/docs/concepts/workloads/pods/pod-overview/"></a>
    
  

  

    

    
      <a class="item" data-title="Pods" href="/docs/concepts/workloads/pods/pod/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod 生命周期" href="/docs/concepts/workloads/pods/pod-lifecycle/"></a>
    
  

  

    

    
      <a class="item" data-title="Init 容器" href="/docs/concepts/workloads/pods/init-containers/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod Preset" href="/docs/concepts/workloads/pods/podpreset/"></a>
    
  

  

    

    
      <a class="item" data-title="Disruptions" href="/docs/concepts/workloads/pods/disruptions/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Controllers">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Replica Sets" href="/docs/concepts/workloads/controllers/replicaset/"></a>
    
  

  

    

    
      <a class="item" data-title="Replication Controller" href="/docs/concepts/workloads/controllers/replicationcontroller/"></a>
    
  

  

    

    
      <a class="item" data-title="Deployment" href="/docs/concepts/workloads/controllers/deployment/"></a>
    
  

  

    

    
      <a class="item" data-title="StatefulSet" href="/docs/concepts/workloads/controllers/statefulset/"></a>
    
  

  

    

    
      <a class="item" data-title="Daemon Sets" href="/docs/concepts/workloads/controllers/daemonset/"></a>
    
  

  

    

    
      <a class="item" data-title="垃圾收集" href="/docs/concepts/workloads/controllers/garbage-collection/"></a>
    
  

  

    

    
      <a class="item" data-title="Jobs - Run to Completion" href="/docs/concepts/workloads/controllers/jobs-run-to-completion/"></a>
    
  

  

    

    
      <a class="item" data-title="Cron Job" href="/docs/concepts/workloads/controllers/cron-jobs/"></a>
    
  


      </div>
    </div>
  


      </div>
    </div>
  

  
    <div class="item" data-title="Configuration">
      <div class="container">
        
  

    

    
      <a class="item" data-title="配置最佳实践" href="/docs/concepts/configuration/overview/"></a>
    
  

  

    

    
      <a class="item" data-title="Managing Compute Resources for Containers" href="/docs/concepts/configuration/manage-compute-resources-container/"></a>
    
  

  

    

    
      <a class="item" data-title="Assigning Pods to Nodes" href="/docs/concepts/configuration/assign-pod-node/"></a>
    
  

  

    

    
      <a class="item" data-title="Taint 和 Toleration" href="/docs/concepts/configuration/taint-and-toleration/"></a>
    
  

  

    

    
      <a class="item" data-title="Secret" href="/docs/concepts/configuration/secret/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 kubeconfig 文件组织集群访问" href="/docs/concepts/configuration/organize-cluster-access-kubeconfig/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod 优先级和抢占" href="/docs/concepts/configuration/pod-priority-preemption/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Services, Load Balancing, and Networking">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Service" href="/docs/concepts/services-networking/service/"></a>
    
  

  

    

    
      <a class="item" data-title="DNS Pod 与 Service" href="/docs/concepts/services-networking/dns-pod-service/"></a>
    
  

  

    

    
      <a class="item" data-title="应用连接到 Service" href="/docs/concepts/services-networking/connect-applications-service/"></a>
    
  

  

    

    
      <a class="item" data-title="Ingress resource" href="/docs/concepts/services-networking/ingress/"></a>
    
  

  

    

    
      <a class="item" data-title="Network Policies" href="/docs/concepts/services-networking/network-policies/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 HostAliases 向 Pod /etc/hosts 文件添加条目" href="/docs/concepts/services-networking/add-entries-to-pod-etc-hosts-with-host-aliases/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Storage">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Volumes" href="/docs/concepts/storage/volumes/"></a>
    
  

  

    

    
      <a class="item" data-title="Persistent Volumes" href="/docs/concepts/storage/persistent-volumes/"></a>
    
  

  

    

    
      <a class="item" data-title="Storage Classes" href="/docs/concepts/storage/storage-classes/"></a>
    
  

  

    

    
      <a class="item" data-title="Dynamic Volume Provisioning" href="/docs/concepts/storage/dynamic-provisioning/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Cluster Administration">
      <div class="container">
        
  

    

    
      <a class="item" data-title="集群管理概述" href="/docs/concepts/cluster-administration/cluster-administration-overview/"></a>
    
  

  

    

    
      <a class="item" data-title="证书" href="/docs/concepts/cluster-administration/certificates/"></a>
    
  

  

    

    
      <a class="item" data-title="云供应商" href="/docs/concepts/cluster-administration/cloud-providers/"></a>
    
  

  

    

    
      <a class="item" data-title="Managing Resources" href="/docs/concepts/cluster-administration/manage-deployment/"></a>
    
  

  

    

    
      <a class="item" data-title="集群网络" href="/docs/concepts/cluster-administration/networking/"></a>
    
  

  

    

    
      <a class="item" data-title="网络插件" href="/docs/concepts/cluster-administration/network-plugins/"></a>
    
  

  

    

    
      <a class="item" data-title="日志架构" href="/docs/concepts/cluster-administration/logging/"></a>
    
  

  

    

    
      <a class="item" data-title="配置 kubelet 垃圾收集" href="/docs/concepts/cluster-administration/kubelet-garbage-collection/"></a>
    
  

  

    

    
      <a class="item" data-title="Federation" href="/docs/concepts/cluster-administration/federation/"></a>
    
  

  

    

    
      <a class="item" data-title="Using Sysctls in a Kubernetes Cluster" href="/docs/concepts/cluster-administration/sysctl-cluster/"></a>
    
  

  

    

    
  

  

    

    
  

  

    

    
      <a class="item" data-title="Proxies in Kubernetes" href="/docs/concepts/cluster-administration/proxies/"></a>
    
  

  

    

    
      <a class="item" data-title="Controller manager metrics" href="/docs/concepts/cluster-administration/controller-metrics/"></a>
    
  

  

    

    
      <a class="item" data-title="设备插件" href="/docs/concepts/cluster-administration/device-plugins/"></a>
    
  

  
    <div class="item" data-title="Policies">
      <div class="container">
        
  

    

    
      <a class="item" data-title="资源配额" href="/docs/concepts/policy/resource-quotas/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod 安全策略" href="/docs/concepts/policy/pod-security-policy/"></a>
    
  


      </div>
    </div>
  


      </div>
    </div>
  


        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
  </div> <!-- /docsToc -->

  <div id="docsContent">
        <p><a href="/editdocs#docs/concepts/containers/images.md" id="editPageButton">Edit This Page</a></p>

        
          <h1>Images</h1>
        

        
<p>You create your Docker image and push it to a registry before referring to it in a Kubernetes pod.</p>

<p>The <code class="highlighter-rouge">image</code> property of a container supports the same syntax as the <code class="highlighter-rouge">docker</code> command does, including private registries and tags.</p>

<ul id="markdown-toc">
  <li><a href="#updating-images" id="markdown-toc-updating-images">Updating Images</a></li>
  <li><a href="#using-a-private-registry" id="markdown-toc-using-a-private-registry">Using a Private Registry</a>    <ul>
      <li><a href="#using-google-container-registry" id="markdown-toc-using-google-container-registry">Using Google Container Registry</a></li>
      <li><a href="#using-aws-ec2-container-registry" id="markdown-toc-using-aws-ec2-container-registry">Using AWS EC2 Container Registry</a></li>
      <li><a href="#using-azure-container-registry-acr" id="markdown-toc-using-azure-container-registry-acr">Using Azure Container Registry (ACR)</a></li>
      <li><a href="#configuring-nodes-to-authenticate-to-a-private-repository" id="markdown-toc-configuring-nodes-to-authenticate-to-a-private-repository">Configuring Nodes to Authenticate to a Private Repository</a></li>
      <li><a href="#pre-pulling-images" id="markdown-toc-pre-pulling-images">Pre-pulling Images</a></li>
      <li><a href="#specifying-imagepullsecrets-on-a-pod" id="markdown-toc-specifying-imagepullsecrets-on-a-pod">Specifying ImagePullSecrets on a Pod</a>        <ul>
          <li><a href="#creating-a-secret-with-a-docker-config" id="markdown-toc-creating-a-secret-with-a-docker-config">Creating a Secret with a Docker Config</a>            <ul>
              <li><a href="#bypassing-kubectl-create-secrets" id="markdown-toc-bypassing-kubectl-create-secrets">Bypassing kubectl create secrets</a></li>
            </ul>
          </li>
          <li><a href="#referring-to-an-imagepullsecrets-on-a-pod" id="markdown-toc-referring-to-an-imagepullsecrets-on-a-pod">Referring to an imagePullSecrets on a Pod</a></li>
        </ul>
      </li>
      <li><a href="#use-cases" id="markdown-toc-use-cases">Use Cases</a></li>
    </ul>
  </li>
</ul>

<h2 id="updating-images">Updating Images</h2>

<p>The default pull policy is <code class="highlighter-rouge">IfNotPresent</code> which causes the Kubelet to not
pull an image if it already exists. If you would like to always force a pull
you must set a pull image policy of <code class="highlighter-rouge">Always</code> or specify a <code class="highlighter-rouge">:latest</code> tag on
your image.</p>

<p>If you did not specify tag of your image, it will be assumed as <code class="highlighter-rouge">:latest</code>, with
pull image policy of <code class="highlighter-rouge">Always</code> correspondingly.</p>

<p>Note that you should avoid using <code class="highlighter-rouge">:latest</code> tag, see <a href="/docs/concepts/configuration/overview/#container-images">Best Practices for Configuration</a> for more information.</p>

<h2 id="using-a-private-registry">Using a Private Registry</h2>

<p>Private registries may require keys to read images from them.
Credentials can be provided in several ways:</p>

<ul>
  <li>Using Google Container Registry
    <ul>
      <li>Per-cluster</li>
      <li>automatically configured on Google Compute Engine or Google Container Engine</li>
      <li>all pods can read the project’s private registry</li>
    </ul>
  </li>
  <li>Using AWS EC2 Container Registry (ECR)
    <ul>
      <li>use IAM roles and policies to control access to ECR repositories</li>
      <li>automatically refreshes ECR login credentials</li>
    </ul>
  </li>
  <li>Using Azure Container Registry (ACR)</li>
  <li>Configuring Nodes to Authenticate to a Private Registry
    <ul>
      <li>all pods can read any configured private registries</li>
      <li>requires node configuration by cluster administrator</li>
    </ul>
  </li>
  <li>Pre-pulling Images
    <ul>
      <li>all pods can use any images cached on a node</li>
      <li>requires root access to all nodes to setup</li>
    </ul>
  </li>
  <li>Specifying ImagePullSecrets on a Pod
    <ul>
      <li>only pods which provide own keys can access the private registry
Each option is described in more detail below.</li>
    </ul>
  </li>
</ul>

<h3 id="using-google-container-registry">Using Google Container Registry</h3>

<p>Kubernetes has native support for the <a href="https://cloud.google.com/tools/container-registry/">Google Container
Registry (GCR)</a>, when running on Google Compute
Engine (GCE).  If you are running your cluster on GCE or Google Container Engine (GKE), simply
use the full image name (e.g. gcr.io/my_project/image:tag).</p>

<p>All pods in a cluster will have read access to images in this registry.</p>

<p>The kubelet will authenticate to GCR using the instance’s
Google service account.  The service account on the instance
will have a <code class="highlighter-rouge">https://www.googleapis.com/auth/devstorage.read_only</code>,
so it can pull from the project’s GCR, but not push.</p>

<h3 id="using-aws-ec2-container-registry">Using AWS EC2 Container Registry</h3>

<p>Kubernetes has native support for the <a href="https://aws.amazon.com/ecr/">AWS EC2 Container
Registry</a>, when nodes are AWS EC2 instances.</p>

<p>Simply use the full image name (e.g. <code class="highlighter-rouge">ACCOUNT.dkr.ecr.REGION.amazonaws.com/imagename:tag</code>)
in the Pod definition.</p>

<p>All users of the cluster who can create pods will be able to run pods that use any of the
images in the ECR registry.</p>

<p>The kubelet will fetch and periodically refresh ECR credentials.  It needs the following permissions to do this:</p>

<ul>
  <li><code class="highlighter-rouge">ecr:GetAuthorizationToken</code></li>
  <li><code class="highlighter-rouge">ecr:BatchCheckLayerAvailability</code></li>
  <li><code class="highlighter-rouge">ecr:GetDownloadUrlForLayer</code></li>
  <li><code class="highlighter-rouge">ecr:GetRepositoryPolicy</code></li>
  <li><code class="highlighter-rouge">ecr:DescribeRepositories</code></li>
  <li><code class="highlighter-rouge">ecr:ListImages</code></li>
  <li><code class="highlighter-rouge">ecr:BatchGetImage</code></li>
</ul>

<p>Requirements:</p>

<ul>
  <li>You must be using kubelet version <code class="highlighter-rouge">v1.2.0</code> or newer.  (e.g. run <code class="highlighter-rouge">/usr/bin/kubelet --version=true</code>).</li>
  <li>If your nodes are in region A and your registry is in a different region B, you need version <code class="highlighter-rouge">v1.3.0</code> or newer.</li>
  <li>ECR must be offered in your region</li>
</ul>

<p>Troubleshooting:</p>

<ul>
  <li>Verify all requirements above.</li>
  <li>Get $REGION (e.g. <code class="highlighter-rouge">us-west-2</code>) credentials on your workstation. SSH into the host and run Docker manually with those creds. Does it work?</li>
  <li>Verify kubelet is running with <code class="highlighter-rouge">--cloud-provider=aws</code>.</li>
  <li>Check kubelet logs (e.g. <code class="highlighter-rouge">journalctl -u kubelet</code>) for log lines like:
    <ul>
      <li><code class="highlighter-rouge">plugins.go:56] Registering credential provider: aws-ecr-key</code></li>
      <li><code class="highlighter-rouge">provider.go:91] Refreshing cache for provider: *aws_credentials.ecrProvider</code></li>
    </ul>
  </li>
</ul>

<h3 id="using-azure-container-registry-acr">Using Azure Container Registry (ACR)</h3>
<p>When using <a href="https://azure.microsoft.com/en-us/services/container-registry/">Azure Container Registry</a>
you can authenticate using either an admin user or a service principal.
In either case, authentication is done via standard Docker authentication.  These instructions assume the
<a href="https://github.com/azure/azure-cli">azure-cli</a> command line tool.</p>

<p>You first need to create a registry and generate credentials, complete documentation for this can be found in
the <a href="https://docs.microsoft.com/en-us/azure/container-registry/container-registry-get-started-azure-cli">Azure container registry documentation</a>.</p>

<p>Once you have created your container registry, you will use the following credentials to login:</p>

<ul>
  <li><code class="highlighter-rouge">DOCKER_USER</code> : service principal, or admin username</li>
  <li><code class="highlighter-rouge">DOCKER_PASSWORD</code>: service principal password, or admin user password</li>
  <li><code class="highlighter-rouge">DOCKER_REGISTRY_SERVER</code>: <code class="highlighter-rouge">${some-registry-name}.azurecr.io</code></li>
  <li><code class="highlighter-rouge">DOCKER_EMAIL</code>: <code class="highlighter-rouge">${some-email-address}</code></li>
</ul>

<p>Once you have those variables filled in you can
<a href="/docs/concepts/containers/images/#specifying-imagepullsecrets-on-a-pod">configure a Kubernetes Secret and use it to deploy a Pod</a>.</p>

<h3 id="configuring-nodes-to-authenticate-to-a-private-repository">Configuring Nodes to Authenticate to a Private Repository</h3>

<p><strong>Note:</strong> if you are running on Google Container Engine (GKE), there will already be a <code class="highlighter-rouge">.dockercfg</code> on each node
with credentials for Google Container Registry.  You cannot use this approach.</p>

<p><strong>Note:</strong> if you are running on AWS EC2 and are using the EC2 Container Registry (ECR), the kubelet on each node will
manage and update the ECR login credentials. You cannot use this approach.</p>

<p><strong>Note:</strong> this approach is suitable if you can control node configuration.  It
will not work reliably on GCE, and any other cloud provider that does automatic
node replacement.</p>

<p>Docker stores keys for private registries in the <code class="highlighter-rouge">$HOME/.dockercfg</code> or <code class="highlighter-rouge">$HOME/.docker/config.json</code> file.  If you put this
in the <code class="highlighter-rouge">$HOME</code> of user <code class="highlighter-rouge">root</code> on a kubelet, then docker will use it.</p>

<p>Here are the recommended steps to configuring your nodes to use a private registry.  In this
example, run these on your desktop/laptop:</p>

<ol>
  <li>Run <code class="highlighter-rouge">docker login [server]</code> for each set of credentials you want to use.  This updates <code class="highlighter-rouge">$HOME/.docker/config.json</code>.</li>
  <li>View <code class="highlighter-rouge">$HOME/.docker/config.json</code> in an editor to ensure it contains just the credentials you want to use.</li>
  <li>Get a list of your nodes, for example:
    <ul>
      <li>if you want the names: <code class="highlighter-rouge">nodes=$(kubectl get nodes -o jsonpath='{range.items[*].metadata}{.name} {end}')</code></li>
      <li>if you want to get the IPs: <code class="highlighter-rouge">nodes=$(kubectl get nodes -o jsonpath='{range .items[*].status.addresses[?(@.type=="ExternalIP")]}{.address} {end}')</code></li>
    </ul>
  </li>
  <li>Copy your local <code class="highlighter-rouge">.docker/config.json</code> to the home directory of root on each node.
    <ul>
      <li>for example: <code class="highlighter-rouge">for n in $nodes; do scp ~/.docker/config.json root@$n:/root/.docker/config.json; done</code></li>
    </ul>
  </li>
</ol>

<p>Verify by creating a pod that uses a private image, e.g.:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">$ cat &lt;&lt;EOF &gt; /tmp/private-image-test-1.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">private-image-test-1</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">uses-private-image</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">$PRIVATE_IMAGE_NAME</span>
      <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">Always</span>
      <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span> <span class="s2">"</span><span class="s">echo"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">SUCCESS"</span> <span class="pi">]</span>
<span class="s">EOF</span>
<span class="s">$ kubectl create -f /tmp/private-image-test-1.yaml</span>
<span class="s">pod "private-image-test-1" created</span>
<span class="s">$</span>
</code></pre></div></div>

<p>If everything is working, then, after a few moments, you should see:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl logs private-image-test-1
SUCCESS
</code></pre></div></div>

<p>If it failed, then you will see:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl describe pods/private-image-test-1 | <span class="nb">grep</span> <span class="s2">"Failed"</span>
  Fri, 26 Jun 2015 15:36:13 <span class="nt">-0700</span>    Fri, 26 Jun 2015 15:39:13 <span class="nt">-0700</span>    19    <span class="o">{</span>kubelet node-i2hq<span class="o">}</span>    spec.containers<span class="o">{</span>uses-private-image<span class="o">}</span>    failed        Failed to pull image <span class="s2">"user/privaterepo:v1"</span>: Error: image user/privaterepo:v1 not found
</code></pre></div></div>

<p>You must ensure all nodes in the cluster have the same <code class="highlighter-rouge">.docker/config.json</code>.  Otherwise, pods will run on
some nodes and fail to run on others.  For example, if you use node autoscaling, then each instance
template needs to include the <code class="highlighter-rouge">.docker/config.json</code> or mount a drive that contains it.</p>

<p>All pods will have read access to images in any private registry once private
registry keys are added to the <code class="highlighter-rouge">.docker/config.json</code>.</p>

<p><strong>This was tested with a private docker repository as of 26 June with Kubernetes version v0.19.3.
It should also work for a private registry such as quay.io, but that has not been tested.</strong></p>

<h3 id="pre-pulling-images">Pre-pulling Images</h3>

<p><strong>Note:</strong> if you are running on Google Container Engine (GKE), there will already be a <code class="highlighter-rouge">.dockercfg</code> on each node
with credentials for Google Container Registry.  You cannot use this approach.</p>

<p><strong>Note:</strong> this approach is suitable if you can control node configuration.  It
will not work reliably on GCE, and any other cloud provider that does automatic
node replacement.</p>

<p>By default, the kubelet will try to pull each image from the specified registry.
However, if the <code class="highlighter-rouge">imagePullPolicy</code> property of the container is set to <code class="highlighter-rouge">IfNotPresent</code> or <code class="highlighter-rouge">Never</code>,
then a local image is used (preferentially or exclusively, respectively).</p>

<p>If you want to rely on pre-pulled images as a substitute for registry authentication,
you must ensure all nodes in the cluster have the same pre-pulled images.</p>

<p>This can be used to preload certain images for speed or as an alternative to authenticating to a private registry.</p>

<p>All pods will have read access to any pre-pulled images.</p>

<h3 id="specifying-imagepullsecrets-on-a-pod">Specifying ImagePullSecrets on a Pod</h3>

<p><strong>Note:</strong> This approach is currently the recommended approach for GKE, GCE, and any cloud-providers
where node creation is automated.</p>

<p>Kubernetes supports specifying registry keys on a pod.</p>

<h4 id="creating-a-secret-with-a-docker-config">Creating a Secret with a Docker Config</h4>

<p>Run the following command, substituting the appropriate uppercase values:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl create secret docker-registry myregistrykey <span class="nt">--docker-server</span><span class="o">=</span>DOCKER_REGISTRY_SERVER <span class="nt">--docker-username</span><span class="o">=</span>DOCKER_USER <span class="nt">--docker-password</span><span class="o">=</span>DOCKER_PASSWORD <span class="nt">--docker-email</span><span class="o">=</span>DOCKER_EMAIL
secret <span class="s2">"myregistrykey"</span> created.
</code></pre></div></div>

<p>If you need access to multiple registries, you can create one secret for each registry.
Kubelet will merge any <code class="highlighter-rouge">imagePullSecrets</code> into a single virtual <code class="highlighter-rouge">.docker/config.json</code>
when pulling images for your Pods.</p>

<p>Pods can only reference image pull secrets in their own namespace,
so this process needs to be done one time per namespace.</p>

<h5 id="bypassing-kubectl-create-secrets">Bypassing kubectl create secrets</h5>

<p>If for some reason you need multiple items in a single <code class="highlighter-rouge">.docker/config.json</code> or need
control not given by the above command, then you can <a href="/docs/user-guide/secrets/#creating-a-secret-manually">create a secret using
json or yaml</a>.</p>

<p>Be sure to:</p>

<ul>
  <li>set the name of the data item to <code class="highlighter-rouge">.dockerconfigjson</code></li>
  <li>base64 encode the docker file and paste that string, unbroken
as the value for field <code class="highlighter-rouge">data[".dockerconfigjson"]</code></li>
  <li>set <code class="highlighter-rouge">type</code> to <code class="highlighter-rouge">kubernetes.io/dockerconfigjson</code></li>
</ul>

<p>Example:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Secret</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">myregistrykey</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">awesomeapps</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="s">.dockerconfigjson</span><span class="pi">:</span> <span class="s">UmVhbGx5IHJlYWxseSByZWVlZWVlZWVlZWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGx5eXl5eXl5eXl5eXl5eXl5eXl5eSBsbGxsbGxsbGxsbGxsbG9vb29vb29vb29vb29vb29vb29vb29vb29vb25ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubmdnZ2dnZ2dnZ2dnZ2dnZ2dnZ2cgYXV0aCBrZXlzCg==</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">kubernetes.io/dockerconfigjson</span>
</code></pre></div></div>

<p>If you get the error message <code class="highlighter-rouge">error: no objects passed to create</code>, it may mean the base64 encoded string is invalid.
If you get an error message like <code class="highlighter-rouge">Secret "myregistrykey" is invalid: data[.dockerconfigjson]: invalid value ...</code>, it means
the data was successfully un-base64 encoded, but could not be parsed as a <code class="highlighter-rouge">.docker/config.json</code> file.</p>

<h4 id="referring-to-an-imagepullsecrets-on-a-pod">Referring to an imagePullSecrets on a Pod</h4>

<p>Now, you can create pods which reference that secret by adding an <code class="highlighter-rouge">imagePullSecrets</code>
section to a pod definition.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">foo</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">awesomeapps</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">foo</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">janedoe/awesomeapp:v1</span>
  <span class="na">imagePullSecrets</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">myregistrykey</span>
</code></pre></div></div>

<p>This needs to be done for each pod that is using a private registry.</p>

<p>However, setting of this field can be automated by setting the imagePullSecrets
in a <a href="/docs/user-guide/service-accounts">serviceAccount</a> resource.</p>

<p>You can use this in conjunction with a per-node <code class="highlighter-rouge">.docker/config.json</code>.  The credentials
will be merged.  This approach will work on Google Container Engine (GKE).</p>

<h3 id="use-cases">Use Cases</h3>

<p>There are a number of solutions for configuring private registries.  Here are some
common use cases and suggested solutions.</p>

<ol>
  <li>Cluster running only non-proprietary (e.g. open-source) images.  No need to hide images.
    <ul>
      <li>Use public images on the Docker hub.
        <ul>
          <li>No configuration required.</li>
          <li>On GCE/GKE, a local mirror is automatically used for improved speed and availability.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Cluster running some proprietary images which should be hidden to those outside the company, but
visible to all cluster users.
    <ul>
      <li>Use a hosted private <a href="https://docs.docker.com/registry/">Docker registry</a>.
        <ul>
          <li>It may be hosted on the <a href="https://hub.docker.com/account/signup/">Docker Hub</a>, or elsewhere.</li>
          <li>Manually configure .docker/config.json on each node as described above.</li>
        </ul>
      </li>
      <li>Or, run an internal private registry behind your firewall with open read access.
        <ul>
          <li>No Kubernetes configuration is required.</li>
        </ul>
      </li>
      <li>Or, when on GCE/GKE, use the project’s Google Container Registry.
        <ul>
          <li>It will work better with cluster autoscaling than manual node configuration.</li>
        </ul>
      </li>
      <li>Or, on a cluster where changing the node configuration is inconvenient, use <code class="highlighter-rouge">imagePullSecrets</code>.</li>
    </ul>
  </li>
  <li>Cluster with a proprietary images, a few of which require stricter access control.
    <ul>
      <li>Ensure <a href="/docs/admin/admission-controllers/#alwayspullimages">AlwaysPullImages admission controller</a> is active. Otherwise, all Pods potentially have access to all images.</li>
      <li>Move sensitive data into a “Secret” resource, instead of packaging it in an image.</li>
    </ul>
  </li>
  <li>A multi-tenant cluster where each tenant needs own private registry.
    <ul>
      <li>Ensure <a href="/docs/admin/admission-controllers/#alwayspullimages">AlwaysPullImages admission controller</a> is active. Otherwise, all Pods of all tenants potentially have access to all images.</li>
      <li>Run a private registry with authorization required.</li>
      <li>Generate registry credential for each tenant, put into secret, and populate secret to each tenant namespace.</li>
      <li>The tenant adds that secret to imagePullSecrets of each namespace.</li>
    </ul>
  </li>
</ol>



        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/concepts/containers/images.md?pixel" alt="Analytics" /></a></p>
        
	
        <script type="text/javascript">
            PDRTJS_settings_8345992 = {
                "id" : "8345992",
                "unique_id" : "/docs/concepts/containers/images/",
                "title" : "Images",
                "permalink" : "http://kubernetes.github.io/docs/concepts/containers/images/"
            };
            (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
        <a href="" onclick="window.open('https://github.com/kubernetes/kubernetes.github.io/issues/new?title=Issue%20with%20' +
        'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
	
        
          <a href="/editdocs#docs/concepts/containers/images.md" class="button issue">Edit this Page</a>
        
    
    </div>
</section>

<footer>
    <main class="light-text">
        <nav>
            <a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a>
            <a href="/docs/home/">Documentation</a>
            <a href="http://blog.kubernetes.io/">Blog</a>
            <a href="/partners/">Partners</a>
            <a href="/community/">Community</a>
            <a href="/case-studies/">Case Studies</a>
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                <a href="/docs/setup/pick-right-solution/" class="button">Get Kubernetes</a>
                <a href="https://github.com/kubernetes/kubernetes" class="button">Contribute</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2017 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2017 The Linux Foundation&reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our Trademark Usage page: <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">https://www.linuxfoundation.org/trademark-usage</a>
        </div>
    </main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
.cse .gsc-control-cse, .gsc-control-cse, {
    padding: 0;
}
  .gsc-control-cse table, .gsc-control-cse-en table {
      margin:0px !important;
  }
  .gsc-above-wrapper-area {
      border-bottom: 0;
  }
</style>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36037335-10', 'auto');
ga('send', 'pageview');

// hide docs nav area if no nav is present, or if nav only contains a link to the current page
(function () {
    window.addEventListener('DOMContentLoaded', init)

        // play nice with our neighbors
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
            var container = toc.querySelector('.container')

                // container is built dynamically, so it may not be present on the first runloop
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>

<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
    <!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->


</body>
</html>
