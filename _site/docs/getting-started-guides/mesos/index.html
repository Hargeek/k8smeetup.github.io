
  
    
    

  

  
    
    

  

  
    

<!Doctype html>
<html id="docs" class="Setup">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono">
    <link rel="stylesheet" type="text/css" href="/css/styles.css"><!-- default styles.css on -->
    <link rel="stylesheet" type="text/css" href="/css/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="/css/sweetalert.css">
    <link rel="stylesheet" type="text/css" href="/css/callouts.css">
    <link rel="stylesheet" type="text/css" href="/css/custom-jekyll/tags.css">
    
    
    <!-- no custom css detected -->

    
    <meta name="description" content="Kubernetes on Mesos" />
    

    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/jquery-ui.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/sweetalert.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/custom-jekyll/tags.js"></script>
    <!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Kubernetes on Mesos | Kubernetes</title>
<meta property="og:title" content="Kubernetes on Mesos" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Production-Grade Container Orchestration" />
<meta property="og:description" content="Production-Grade Container Orchestration" />
<link rel="canonical" href="http://0.0.0.0:4000/docs/getting-started-guides/mesos/" />
<meta property="og:url" content="http://0.0.0.0:4000/docs/getting-started-guides/mesos/" />
<meta property="og:site_name" content="Kubernetes" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@kubernetesio" />
<script type="application/ld+json">
{"name":null,"description":"Production-Grade Container Orchestration","author":null,"@type":"WebPage","url":"http://0.0.0.0:4000/docs/getting-started-guides/mesos/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/images/favicon.png"}},"image":null,"headline":"Kubernetes on Mesos","dateModified":null,"datePublished":null,"sameAs":null,"mainEntityOfPage":null,"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>

<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            <li><a href="/docs/home/">Documentation</a></li>
            <li><a href="http://blog.kubernetes.io/">Blog</a></li>
            <li><a href="/partners/">Partners</a></li>
            <li><a href="/community/">Community</a></li>
            <li><a href="/case-studies/">Case Studies</a></li>
            <li>
                <a href="#">
                    v1.8 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                  <li><a href="https://kubernetes.io/docs/home/">v1.8</a></li>
                
                  <li><a href="https://v1-7.docs.kubernetes.io/docs/home/">v1.7</a></li>
                
                  <li><a href="https://v1-6.docs.kubernetes.io/docs/home/">v1.6</a></li>
                
                  <li><a href="https://v1-5.docs.kubernetes.io/docs/">v1.5</a></li>
                
                  <li><a href="https://v1-4.docs.kubernetes.io/docs/">v1.4</a></li>
                
                </ul>
              </li>
            </li>
        </ul>
        <!-- <a href="/docs/home" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a> -->
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
        <div class="nav-box">
            <h3><a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a></h3>
            <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
            <p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
        </div>
        <div class="nav-box">
            <h3><a href="/community/">Community</a></h3>
            <p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
        </div>
        <div class="nav-box">
            <h3><a href="http://blog.kubernetes.io">Blog</a></h3>
            <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
        </div>
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Setup</h1>
  <h5>Instructions for setting up a Kubernetes cluster.</h5>
  <div id="vendorStrip" class="light-text">
    <ul>
      <li><a href="/docs/home/" >HOME</a></li>
      <li><a href="/docs/setup/" class="YAH">SETUP</a></li>
      <li><a href="/docs/concepts/" >CONCEPTS</a></li>
      <li><a href="/docs/tasks/" >TASKS</a></li>
      <li><a href="/docs/tutorials/" >TUTORIALS</a></li>
      <li><a href="/docs/reference/" >REFERENCE</a></li>
    </ul>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)" autofocus="autofocus">
    </div>
  </div>
</section>




<section id="encyclopedia">
  <div id="docsToc">
        <div class="pi-accordion">
          
  

    

    
      <a class="item" data-title="Setup" href="/docs/setup/"></a>
    
  

  

    

    
      <a class="item" data-title="Picking the Right Solution" href="/docs/setup/pick-right-solution/"></a>
    
  

  
    <div class="item" data-title="Independent Solutions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Running Kubernetes Locally via Minikube" href="/docs/getting-started-guides/minikube/"></a>
    
  

  
    <div class="item" data-title="Bootstrapping Clusters with kubeadm">
      <div class="container">
        
  

    

    
      <a class="item" data-title="安装 kubeadm" href="/docs/setup/independent/install-kubeadm/"></a>
    
  

  

    

    
      <a class="item" data-title="Using kubeadm to Create a Cluster" href="/docs/setup/independent/create-cluster-kubeadm/"></a>
    
  

  

    

    
      <a class="item" data-title="Troubleshooting kubeadm" href="/docs/setup/independent/troubleshooting-kubeadm/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="从零开始搭建自定义集群" href="/docs/getting-started-guides/scratch/"></a>
    
  

  

    

    
      <a class="item" data-title="Deprecated Alternatives" href="/docs/getting-started-guides/alternatives/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Hosted Solutions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Running Kubernetes on Google Kubernetes Engine" href="https://cloud.google.com/kubernetes-engine/docs/before-you-begin/"></a>
    
  

  

    

    
      <a class="item" data-title="Running Kubernetes on Azure Container Service" href="https://docs.microsoft.com/en-us/azure/container-service/container-service-kubernetes-walkthrough"></a>
    
  

  

    

    
      <a class="item" data-title="Running Kubernetes on IBM Cloud Container Service" href="https://console.bluemix.net/docs/containers/container_index.html"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Turn-key Cloud Solutions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="在 Google 计算引擎上运行 Kubernetes" href="/docs/getting-started-guides/gce/"></a>
    
  

  

    

    
      <a class="item" data-title="Running Kubernetes on AWS EC2" href="/docs/getting-started-guides/aws/"></a>
    
  

  

    

    
      <a class="item" data-title="在 Azure 上运行 Kubernetes" href="/docs/getting-started-guides/azure/"></a>
    
  

  

    

    
      <a class="item" data-title="Running Kubernetes on Alibaba Cloud" href="/docs/getting-started-guides/alibaba-cloud/"></a>
    
  

  

    

    
      <a class="item" data-title="Running Kubernetes on CenturyLink Cloud" href="/docs/getting-started-guides/clc/"></a>
    
  

  

    

    
      <a class="item" data-title="Running Kubernetes on IBM Cloud" href="https://github.com/patrocinio/kubernetes-softlayer"></a>
    
  

  

    

    
      <a class="item" data-title="Running Kubernetes on Multiple Clouds with Stackpoint.io" href="/docs/getting-started-guides/stackpoint/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Custom Solutions">
      <div class="container">
        
  
    <div class="item" data-title="Custom Cloud Solutions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="CoreOS on AWS or GCE" href="/docs/getting-started-guides/coreos/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes on Ubuntu" href="/docs/getting-started-guides/ubuntu/"></a>
    
  

  

    

    
      <a class="item" data-title="概览" href="/docs/getting-started-guides/kops/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Kubespray 在基础设施或云平台上安装 Kubernetes" href="/docs/getting-started-guides/kubespray/"></a>
    
  

  

    

    
  


      </div>
    </div>
  

  
    <div class="item" data-title="On-Premise VMs">
      <div class="container">
        
  

    

    
      <a class="item" data-title="CoreOS on AWS or GCE" href="/docs/getting-started-guides/coreos/"></a>
    
  

  

    

    
      <a class="item" data-title="Cloudstack" href="/docs/getting-started-guides/cloudstack/"></a>
    
  

  

    

    
      <a class="item" data-title="VMware vSphere" href="/docs/getting-started-guides/vsphere/"></a>
    
  

  

    

    
      <a class="item" data-title="VMware Photon Controller" href="/docs/getting-started-guides/photon-controller/"></a>
    
  

  

    

    
      <a class="item" data-title="DCOS" href="/docs/getting-started-guides/dcos/"></a>
    
  

  

    

    
      <a class="item" data-title="CoreOS on libvirt" href="/docs/getting-started-guides/libvirt-coreos/"></a>
    
  

  

    

    
      <a class="item" data-title="oVirt" href="/docs/getting-started-guides/ovirt/"></a>
    
  

  

    

    
      <a class="item" data-title="OpenStack Heat" href="/docs/getting-started-guides/openstack-heat/"></a>
    
  

  
    <div class="item" data-title="rkt">
      <div class="container">
        
  

    

    
      <a class="item" data-title="通过 rkt 运行 Kubernetes" href="/docs/getting-started-guides/rkt/"></a>
    
  

  

    

    
      <a class="item" data-title="Known Issues when Using rkt" href="/docs/getting-started-guides/rkt/notes/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="Kubernetes on Mesos" href="/docs/getting-started-guides/mesos/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes on Mesos on Docker" href="/docs/getting-started-guides/mesos-docker/"></a>
    
  

  
    <div class="item" data-title="Bare Metal">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Offline" href="/docs/getting-started-guides/coreos/bare_metal_offline/"></a>
    
  

  

    

    
      <a class="item" data-title="Fedora via Ansible" href="/docs/getting-started-guides/fedora/fedora_ansible_config/"></a>
    
  

  

    

    
      <a class="item" data-title="Fedora (Single Node)" href="/docs/getting-started-guides/fedora/fedora_manual_config/"></a>
    
  

  

    

    
      <a class="item" data-title="Fedora (Multi Node)" href="/docs/getting-started-guides/fedora/flannel_multi_node_cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="CentOS" href="/docs/getting-started-guides/centos/centos_manual_config/"></a>
    
  

  

    

    
      <a class="item" data-title="CoreOS on AWS or GCE" href="/docs/getting-started-guides/coreos/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes on Ubuntu" href="/docs/getting-started-guides/ubuntu/"></a>
    
  

  
    <div class="item" data-title="Ubuntu">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Kubernetes on Ubuntu" href="/docs/getting-started-guides/ubuntu/"></a>
    
  

  

    

    
      <a class="item" data-title="Validation - End-to-end Testing" href="/docs/getting-started-guides/ubuntu/validation/"></a>
    
  

  

    

    
      <a class="item" data-title="备份" href="/docs/getting-started-guides/ubuntu/backups/"></a>
    
  

  

    

    
      <a class="item" data-title="Upgrades" href="/docs/getting-started-guides/ubuntu/upgrades/"></a>
    
  

  

    

    
      <a class="item" data-title="Scaling" href="/docs/getting-started-guides/ubuntu/scaling/"></a>
    
  

  

    

    
      <a class="item" data-title="Setting up Kubernetes with Juju" href="/docs/getting-started-guides/ubuntu/installation/"></a>
    
  

  

    

    
      <a class="item" data-title="监控" href="/docs/getting-started-guides/ubuntu/monitoring/"></a>
    
  

  

    

    
      <a class="item" data-title="Networking" href="/docs/getting-started-guides/ubuntu/networking/"></a>
    
  

  

    

    
      <a class="item" data-title="Security Considerations" href="/docs/getting-started-guides/ubuntu/security/"></a>
    
  

  

    

    
      <a class="item" data-title="Storage" href="/docs/getting-started-guides/ubuntu/storage/"></a>
    
  

  

    

    
      <a class="item" data-title="Troubleshooting" href="/docs/getting-started-guides/ubuntu/troubleshooting/"></a>
    
  

  

    

    
      <a class="item" data-title="Decommissioning" href="/docs/getting-started-guides/ubuntu/decommissioning/"></a>
    
  

  

    

    
      <a class="item" data-title="Operational Considerations" href="/docs/getting-started-guides/ubuntu/operational-considerations/"></a>
    
  

  

    

    
      <a class="item" data-title="Glossary and Terminology" href="/docs/getting-started-guides/ubuntu/glossary/"></a>
    
  

  

    

    
      <a class="item" data-title="Local Kubernetes development with LXD" href="/docs/getting-started-guides/ubuntu/local/"></a>
    
  

  

    

    
      <a class="item" data-title="日志" href="/docs/getting-started-guides/ubuntu/logging/"></a>
    
  


      </div>
    </div>
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="Windows Server 容器" href="/docs/getting-started-guides/windows/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="Validate Node Setup" href="/docs/admin/node-conformance/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="安装扩展（Addons）" href="/docs/concepts/cluster-administration/addons/"></a>
    
  

  

    

    
      <a class="item" data-title="Configuring Kubernetes with Salt" href="/docs/admin/salt/"></a>
    
  

  

    

    
      <a class="item" data-title="搭建大型集群" href="/docs/admin/cluster-large/"></a>
    
  

  

    

    
      <a class="item" data-title="Running in Multiple Zones" href="/docs/admin/multiple-zones/"></a>
    
  

  

    

    
      <a class="item" data-title="构建高可用集群" href="/docs/admin/high-availability/"></a>
    
  

  

    

    
      <a class="item" data-title="下载或构建 Kubernetes" href="/docs/getting-started-guides/binary_release/"></a>
    
  


        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
  </div> <!-- /docsToc -->

  <div id="docsContent">
        <p><a href="/editdocs#docs/getting-started-guides/mesos/index.md" id="editPageButton">Edit This Page</a></p>

        
          <h1>Kubernetes on Mesos</h1>
        

        <ul id="markdown-toc">
  <li><a href="#about-kubernetes-on-mesos" id="markdown-toc-about-kubernetes-on-mesos">About Kubernetes on Mesos</a>    <ul>
      <li><a href="#prerequisites" id="markdown-toc-prerequisites">Prerequisites</a></li>
      <li><a href="#deploy-kubernetes-mesos" id="markdown-toc-deploy-kubernetes-mesos">Deploy Kubernetes-Mesos</a></li>
      <li><a href="#deploy-etcd" id="markdown-toc-deploy-etcd">Deploy etcd</a></li>
      <li><a href="#start-kubernetes-mesos-services" id="markdown-toc-start-kubernetes-mesos-services">Start Kubernetes-Mesos Services</a>        <ul>
          <li><a href="#validate-km-services" id="markdown-toc-validate-km-services">Validate KM Services</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#spin-up-a-pod" id="markdown-toc-spin-up-a-pod">Spin up a pod</a></li>
  <li><a href="#launching-kube-dns" id="markdown-toc-launching-kube-dns">Launching kube-dns</a></li>
  <li><a href="#support-level" id="markdown-toc-support-level">Support Level</a></li>
  <li><a href="#what-next" id="markdown-toc-what-next">What next?</a></li>
</ul>

<h2 id="about-kubernetes-on-mesos">About Kubernetes on Mesos</h2>

<p>Mesos allows dynamic sharing of cluster resources between Kubernetes and other first-class Mesos frameworks such as <a href="https://docs.mesosphere.com/latest/usage/service-guides/hdfs/">HDFS</a>, <a href="https://docs.mesosphere.com/latest/usage/service-guides/spark/">Spark</a>, and <a href="https://mesos.github.io/chronos/docs/getting-started.html">Chronos</a>.
Mesos also ensures applications from different frameworks running on your cluster are isolated and that resources are allocated fairly among them.</p>

<p>Mesos clusters can be deployed on nearly every IaaS cloud provider infrastructure or in your own physical datacenter. Kubernetes on Mesos runs on-top of that and therefore allows you to easily move Kubernetes workloads from one of these environments to the other.</p>

<p>This tutorial will walk you through setting up Kubernetes on a Mesos cluster.
It provides a step by step walk through of adding Kubernetes to a Mesos cluster and starting your first pod with an nginx webserver.</p>

<p><strong>NOTE:</strong> There are <a href="https://github.com/kubernetes-incubator/kube-mesos-framework/blob/master/docs/issues.md">known issues with the current implementation</a> and support for centralized logging and monitoring is not yet available.
Please <a href="https://github.com/mesosphere/kubernetes-mesos/issues">file an issue against the kubernetes-mesos project</a> if you have problems completing the steps below.</p>

<p>Further information is available in the Kubernetes on Mesos <a href="https://github.com/kubernetes-incubator/kube-mesos-framework/blob/master/README.md">contrib directory</a>.</p>

<h3 id="prerequisites">Prerequisites</h3>

<ul>
  <li>Understanding of <a href="http://mesos.apache.org/">Apache Mesos</a></li>
  <li>A running <a href="https://dcos.io/docs/latest/administration/installing/cloud/gce/">Mesos cluster on Google Compute Engine</a></li>
  <li>A <a href="http://open.mesosphere.com/getting-started/cloud/google/mesosphere/#vpn-setup">VPN connection</a> to the cluster</li>
  <li>A machine in the cluster which should become the Kubernetes <em>master node</em> with:
    <ul>
      <li>Go (see <a href="https://git.k8s.io/community/contributors/devel/development.md">here</a> for required versions)</li>
      <li>make (i.e. build-essential)</li>
      <li>Docker</li>
    </ul>
  </li>
</ul>

<p><strong>Note</strong>: You <em>can</em>, but you <em>don’t have to</em> deploy Kubernetes-Mesos on the same machine the Mesos master is running on.</p>

<h3 id="deploy-kubernetes-mesos">Deploy Kubernetes-Mesos</h3>

<p>Log into the future Kubernetes <em>master node</em> over SSH, replacing the placeholder below with the correct IP address.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh jclouds@<span class="k">${</span><span class="nv">ip_address_of_master_node</span><span class="k">}</span>
</code></pre></div></div>

<p>Build Kubernetes-Mesos.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/kubernetes-incubator/kube-mesos-framework
<span class="nb">cd </span>kube-mesos-framework
make
</code></pre></div></div>

<p>Set some environment variables.
The internal IP address of the master may be obtained via <code class="highlighter-rouge">hostname -i</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">KUBERNETES_MASTER_IP</span><span class="o">=</span><span class="k">$(</span>hostname <span class="nt">-i</span><span class="k">)</span>
<span class="nb">export </span><span class="nv">KUBERNETES_MASTER</span><span class="o">=</span>http://<span class="k">${</span><span class="nv">KUBERNETES_MASTER_IP</span><span class="k">}</span>:8888
</code></pre></div></div>

<p>Note that KUBERNETES_MASTER is used as the api endpoint. If you have existing <code class="highlighter-rouge">~/.kube/config</code> and point to another endpoint, you need to add option <code class="highlighter-rouge">--server=${KUBERNETES_MASTER}</code> to kubectl in later steps.</p>

<h3 id="deploy-etcd">Deploy etcd</h3>

<p>Start etcd and verify that it is running:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker run <span class="nt">-d</span> <span class="nt">--hostname</span> <span class="k">$(</span>uname <span class="nt">-n</span><span class="k">)</span> <span class="nt">--name</span> etcd <span class="se">\</span>
  <span class="nt">-p</span> 4001:4001 <span class="nt">-p</span> 7001:7001 quay.io/coreos/etcd:v2.2.1 <span class="se">\</span>
  <span class="nt">--listen-client-urls</span> http://0.0.0.0:4001 <span class="se">\</span>
  <span class="nt">--advertise-client-urls</span> http://<span class="k">${</span><span class="nv">KUBERNETES_MASTER_IP</span><span class="k">}</span>:4001
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>docker ps
CONTAINER ID   IMAGE                        COMMAND   CREATED   STATUS   PORTS                NAMES
fd7bac9e2301   quay.io/coreos/etcd:v2.2.1   <span class="s2">"/etcd"</span>   5s ago    Up 3s    2379/tcp, 2380/...   etcd
</code></pre></div></div>

<p>It’s also a good idea to ensure your etcd instance is reachable by testing it</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-L</span> http://<span class="k">${</span><span class="nv">KUBERNETES_MASTER_IP</span><span class="k">}</span>:4001/v2/keys/
</code></pre></div></div>

<p>If connectivity is OK, you will see an output of the available keys in etcd (if any).</p>

<h3 id="start-kubernetes-mesos-services">Start Kubernetes-Mesos Services</h3>

<p>Update your PATH to more easily run the Kubernetes-Mesos binaries:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">/_output/local/go/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
</code></pre></div></div>

<p>Identify your Mesos master: depending on your Mesos installation this is either a <code class="highlighter-rouge">host:port</code> like <code class="highlighter-rouge">mesos-master:5050</code> or a ZooKeeper URL like <code class="highlighter-rouge">zk://zookeeper:2181/mesos</code>.
In order to let Kubernetes survive Mesos master changes, the ZooKeeper URL is recommended for production environments.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">MESOS_MASTER</span><span class="o">=</span>&lt;host:port or zk:// url&gt;
</code></pre></div></div>

<p>Create a cloud config file <code class="highlighter-rouge">mesos-cloud.conf</code> in the current directory with the following contents:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> &gt;mesos-cloud.conf
[mesos-cloud]
        mesos-master        = </span><span class="k">${</span><span class="nv">MESOS_MASTER</span><span class="k">}</span><span class="sh">
</span><span class="no">EOF
</span></code></pre></div></div>

<p>Now start the kubernetes-mesos API server, controller manager, and scheduler on the master node:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>km apiserver <span class="se">\</span>
  <span class="nt">--address</span><span class="o">=</span><span class="k">${</span><span class="nv">KUBERNETES_MASTER_IP</span><span class="k">}</span> <span class="se">\</span>
  <span class="nt">--etcd-servers</span><span class="o">=</span>http://<span class="k">${</span><span class="nv">KUBERNETES_MASTER_IP</span><span class="k">}</span>:4001 <span class="se">\</span>
  <span class="nt">--service-cluster-ip-range</span><span class="o">=</span>10.10.10.0/24 <span class="se">\</span>
  <span class="nt">--port</span><span class="o">=</span>8888 <span class="se">\</span>
  <span class="nt">--cloud-provider</span><span class="o">=</span>mesos <span class="se">\</span>
  <span class="nt">--cloud-config</span><span class="o">=</span>mesos-cloud.conf <span class="se">\</span>
  <span class="nt">--secure-port</span><span class="o">=</span>0 <span class="se">\</span>
  <span class="nt">--v</span><span class="o">=</span>1 <span class="o">&gt;</span>apiserver.log 2&gt;&amp;1 &amp;

<span class="nv">$ </span>km controller-manager <span class="se">\</span>
  <span class="nt">--master</span><span class="o">=</span><span class="k">${</span><span class="nv">KUBERNETES_MASTER_IP</span><span class="k">}</span>:8888 <span class="se">\</span>
  <span class="nt">--cloud-provider</span><span class="o">=</span>mesos <span class="se">\</span>
  <span class="nt">--cloud-config</span><span class="o">=</span>./mesos-cloud.conf  <span class="se">\</span>
  <span class="nt">--v</span><span class="o">=</span>1 <span class="o">&gt;</span>controller.log 2&gt;&amp;1 &amp;

<span class="nv">$ </span>km scheduler <span class="se">\</span>
  <span class="nt">--address</span><span class="o">=</span><span class="k">${</span><span class="nv">KUBERNETES_MASTER_IP</span><span class="k">}</span> <span class="se">\</span>
  <span class="nt">--mesos-master</span><span class="o">=</span><span class="k">${</span><span class="nv">MESOS_MASTER</span><span class="k">}</span> <span class="se">\</span>
  <span class="nt">--etcd-servers</span><span class="o">=</span>http://<span class="k">${</span><span class="nv">KUBERNETES_MASTER_IP</span><span class="k">}</span>:4001 <span class="se">\</span>
  <span class="nt">--mesos-user</span><span class="o">=</span>root <span class="se">\</span>
  <span class="nt">--api-servers</span><span class="o">=</span><span class="k">${</span><span class="nv">KUBERNETES_MASTER_IP</span><span class="k">}</span>:8888 <span class="se">\</span>
  <span class="nt">--cluster-dns</span><span class="o">=</span>10.10.10.10 <span class="se">\</span>
  <span class="nt">--cluster-domain</span><span class="o">=</span>cluster.local <span class="se">\</span>
  <span class="nt">--v</span><span class="o">=</span>2 <span class="o">&gt;</span>scheduler.log 2&gt;&amp;1 &amp;
</code></pre></div></div>

<p>Disown your background jobs so that they’ll stay running if you log out.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">disown</span> <span class="nt">-a</span>
</code></pre></div></div>

<h4 id="validate-km-services">Validate KM Services</h4>

<p>Interact with the kubernetes-mesos framework via <code class="highlighter-rouge">kubectl</code>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get pods
NAME      READY     STATUS    RESTARTS   AGE
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># NOTE: your service IPs will likely differ</span>
<span class="nv">$ </span>kubectl get services
NAME             CLUSTER-IP       EXTERNAL-IP     PORT<span class="o">(</span>S<span class="o">)</span>        AGE
k8sm-scheduler   10.10.10.113     &lt;none&gt;          10251/TCP      1d
kubernetes       10.10.10.1       &lt;none&gt;          443/TCP        1d
</code></pre></div></div>

<p>Lastly, look for Kubernetes in the Mesos web GUI by pointing your browser to
<code class="highlighter-rouge">http://&lt;mesos-master-ip:port&gt;</code>. Make sure you have an active VPN connection.
Go to the Frameworks tab, and look for an active framework named “Kubernetes”.</p>

<h2 id="spin-up-a-pod">Spin up a pod</h2>

<p>Write a JSON pod description to a local file:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOPOD</span><span class="sh"> &gt;nginx.yaml
</span></code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="s">80</span>
<span class="s">EOPOD</span>
</code></pre></div></div>

<p>Send the pod description to Kubernetes using the <code class="highlighter-rouge">kubectl</code> CLI:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl create <span class="nt">-f</span> ./nginx.yaml
pod <span class="s2">"nginx"</span> created
</code></pre></div></div>

<p>Wait a minute or two while <code class="highlighter-rouge">dockerd</code> downloads the image layers from the internet.
We can use the <code class="highlighter-rouge">kubectl</code> interface to monitor the status of our pod:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get pods
NAME      READY     STATUS    RESTARTS   AGE
nginx     1/1       Running   0          14s
</code></pre></div></div>

<p>Verify that the pod task is running in the Mesos web GUI. Click on the
Kubernetes framework. The next screen should show the running Mesos task that
started the Kubernetes pod.</p>

<h2 id="launching-kube-dns">Launching kube-dns</h2>

<p>Kube-dns is an addon for Kubernetes which adds DNS-based service discovery to the cluster. For a detailed explanation see <a href="https://releases.k8s.io/master/cluster/addons/dns/README.md">DNS in Kubernetes</a>.</p>

<p>The kube-dns addon runs as a pod inside the cluster. The pod consists of three co-located containers:</p>

<ul>
  <li>a local etcd instance</li>
  <li>the <a href="https://git.k8s.io/kubernetes/cluster/addons/dns/README.md#kube-dns">kube-dns</a> DNS server</li>
</ul>

<p>We assume that kube-dns will use</p>

<ul>
  <li>the service IP <code class="highlighter-rouge">10.10.10.10</code></li>
  <li>and the <code class="highlighter-rouge">cluster.local</code> domain.</li>
</ul>

<p>Note that we have passed these two values already as parameter to the apiserver above.</p>

<p>A template for a replication controller spinning up the pod with the 3 containers can be found at <a href="https://git.k8s.io/kubernetes/cluster/addons/dns/kubedns-controller.yaml.in">cluster/addons/dns/kubedns-controller.yaml.in</a> in the repository. The following steps are necessary in order to get a valid replication controller yaml file:</p>

<ul>
  <li>replace <code class="highlighter-rouge">{{ pillar['dns_replicas'] }}</code>  with <code class="highlighter-rouge">1</code></li>
  <li>replace <code class="highlighter-rouge">{{ pillar['dns_domain'] }}</code> with <code class="highlighter-rouge">cluster.local.</code></li>
  <li>add <code class="highlighter-rouge">--kube_master_url=${KUBERNETES_MASTER}</code> parameter to the kube2sky container command.</li>
</ul>

<p>In addition the service template at <a href="https://git.k8s.io/kubernetes/cluster/addons/dns/kubedns-controller.yaml.in">cluster/addons/dns/kubedns-controller.yaml.in</a> needs the following replacement:</p>

<ul>
  <li><code class="highlighter-rouge">{{ pillar['dns_server'] }}</code> with <code class="highlighter-rouge">10.10.10.10</code>.</li>
</ul>

<p>To do this automatically:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sed <span class="nt">-e</span> <span class="s2">"s/{{ pillar</span><span class="se">\[</span><span class="s2">'dns_replicas'</span><span class="se">\]</span><span class="s2"> }}/1/g;"</span><span class="se">\</span>
<span class="s2">"s,</span><span class="se">\(</span><span class="s2">command = </span><span class="se">\"</span><span class="s2">/kube2sky</span><span class="se">\"\)</span><span class="s2">,</span><span class="se">\\</span><span class="s2">1</span><span class="se">\\</span><span class="s2">"</span><span class="s1">$'</span><span class="se">\n</span><span class="s1">'</span><span class="s2">"        - --kube_master_url=</span><span class="k">${</span><span class="nv">KUBERNETES_MASTER</span><span class="k">}</span><span class="s2">,;"</span><span class="se">\</span>
<span class="s2">"s/{{ pillar</span><span class="se">\[</span><span class="s2">'dns_domain'</span><span class="se">\]</span><span class="s2"> }}/cluster.local/g"</span> <span class="se">\</span>
  cluster/addons/dns/kubedns-controller.yaml.in <span class="o">&gt;</span> kubedns-controller.yaml
sed <span class="nt">-e</span> <span class="s2">"s/{{ pillar</span><span class="se">\[</span><span class="s2">'dns_server'</span><span class="se">\]</span><span class="s2"> }}/10.10.10.10/g"</span> <span class="se">\</span>
  cluster/addons/dns/kubedns-svc.yaml.in <span class="o">&gt;</span> kubedns-svc.yaml
</code></pre></div></div>

<p>Now the kube-dns pod and service are ready to be launched:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create <span class="nt">-f</span> ./kubedns-controller.yaml
kubectl create <span class="nt">-f</span> ./kubedns-svc.yaml
</code></pre></div></div>

<p>Check with <code class="highlighter-rouge">kubectl get pods --namespace=kube-system</code> that 3/3 containers of the pods are eventually up and running. Note that the kube-dns pods run in the <code class="highlighter-rouge">kube-system</code> namespace, not in  <code class="highlighter-rouge">default</code>.</p>

<p>To check that the new DNS service in the cluster works, we start a busybox pod and use that to do a DNS lookup. First create the <code class="highlighter-rouge">busybox.yaml</code> pod spec:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> &gt;busybox.yaml
</span></code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">busybox</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">default</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">busybox</span>
    <span class="na">command</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">sleep</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3600"</span>
    <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">busybox</span>
  <span class="na">restartPolicy</span><span class="pi">:</span> <span class="s">Always</span>
<span class="s">EOF</span>
</code></pre></div></div>

<p>Then start the pod:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create <span class="nt">-f</span> ./busybox.yaml
</code></pre></div></div>

<p>When the pod is up and running, start a lookup for the Kubernetes master service, made available on 10.10.10.1 by default:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl  <span class="nb">exec </span>busybox <span class="nt">--</span> nslookup kubernetes
</code></pre></div></div>

<p>If everything works fine, you will get this output:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Server:    10.10.10.10
Address 1: 10.10.10.10

Name:      kubernetes
Address 1: 10.10.10.1
</code></pre></div></div>

<h2 id="support-level">Support Level</h2>

<table>
  <thead>
    <tr>
      <th>IaaS Provider</th>
      <th>Config. Mgmt</th>
      <th>OS</th>
      <th>Networking</th>
      <th>Docs</th>
      <th>Conforms</th>
      <th>Support Level</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Mesos/GCE</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td><a href="/docs/getting-started-guides/mesos/">docs</a></td>
      <td> </td>
      <td>Community (<a href="https://github.com/mesosphere/kubernetes-mesos/blob/master/AUTHORS.md">Kubernetes-Mesos Authors</a>)</td>
    </tr>
  </tbody>
</table>

<p>For support level information on all solutions, see the <a href="/docs/getting-started-guides/#table-of-solutions/">Table of solutions</a> chart.</p>

<h2 id="what-next">What next?</h2>

<p>Try out some of the standard <a href="https://github.com/kubernetes/examples/tree/master/">Kubernetes examples</a>.</p>

<p>Read about Kubernetes on Mesos’ architecture in the <a href="https://github.com/kubernetes-incubator/kube-mesos-framework/blob/master/README.md">contrib directory</a>.</p>

<p><strong>NOTE:</strong> Some examples require Kubernetes DNS to be installed on the cluster.
Future work will add instructions to this guide to enable support for Kubernetes DNS.</p>

<p><strong>NOTE:</strong> Please be aware that there are <a href="https://github.com/kubernetes-incubator/kube-mesos-framework/blob/master/docs/issues.md">known issues with the current Kubernetes-Mesos implementation</a>.</p>



        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/getting-started-guides/mesos/index.md?pixel" alt="Analytics" /></a></p>
        
	
        <script type="text/javascript">
            PDRTJS_settings_8345992 = {
                "id" : "8345992",
                "unique_id" : "/docs/getting-started-guides/mesos/",
                "title" : "Kubernetes on Mesos",
                "permalink" : "http://kubernetes.github.io/docs/getting-started-guides/mesos/"
            };
            (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
        <a href="" onclick="window.open('https://github.com/kubernetes/kubernetes.github.io/issues/new?title=Issue%20with%20' +
        'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
	
        
          <a href="/editdocs#docs/getting-started-guides/mesos/index.md" class="button issue">Edit this Page</a>
        
    
    </div>
</section>

<footer>
    <main class="light-text">
        <nav>
            <a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a>
            <a href="/docs/home/">Documentation</a>
            <a href="http://blog.kubernetes.io/">Blog</a>
            <a href="/partners/">Partners</a>
            <a href="/community/">Community</a>
            <a href="/case-studies/">Case Studies</a>
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                <a href="/docs/setup/pick-right-solution/" class="button">Get Kubernetes</a>
                <a href="https://github.com/kubernetes/kubernetes" class="button">Contribute</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2017 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2017 The Linux Foundation&reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our Trademark Usage page: <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">https://www.linuxfoundation.org/trademark-usage</a>
        </div>
    </main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
.cse .gsc-control-cse, .gsc-control-cse, {
    padding: 0;
}
  .gsc-control-cse table, .gsc-control-cse-en table {
      margin:0px !important;
  }
  .gsc-above-wrapper-area {
      border-bottom: 0;
  }
</style>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36037335-10', 'auto');
ga('send', 'pageview');

// hide docs nav area if no nav is present, or if nav only contains a link to the current page
(function () {
    window.addEventListener('DOMContentLoaded', init)

        // play nice with our neighbors
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
            var container = toc.querySelector('.container')

                // container is built dynamically, so it may not be present on the first runloop
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>

<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
    <!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->


</body>
</html>
