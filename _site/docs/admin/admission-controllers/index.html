
  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    

<!Doctype html>
<html id="docs" class="Reference Documentation">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono">
    <link rel="stylesheet" type="text/css" href="/css/styles.css"><!-- default styles.css on -->
    <link rel="stylesheet" type="text/css" href="/css/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="/css/sweetalert.css">
    <link rel="stylesheet" type="text/css" href="/css/callouts.css">
    <link rel="stylesheet" type="text/css" href="/css/custom-jekyll/tags.css">
    
    
    <!-- no custom css detected -->

    
    <meta name="description" content="Using Admission Controllers" />
    

    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/jquery-ui.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/sweetalert.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/custom-jekyll/tags.js"></script>
    <!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Using Admission Controllers | Kubernetes</title>
<meta property="og:title" content="Using Admission Controllers" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Production-Grade Container Orchestration" />
<meta property="og:description" content="Production-Grade Container Orchestration" />
<link rel="canonical" href="http://0.0.0.0:4000/docs/admin/admission-controllers/" />
<meta property="og:url" content="http://0.0.0.0:4000/docs/admin/admission-controllers/" />
<meta property="og:site_name" content="Kubernetes" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@kubernetesio" />
<script type="application/ld+json">
{"name":null,"description":"Production-Grade Container Orchestration","author":null,"@type":"WebPage","url":"http://0.0.0.0:4000/docs/admin/admission-controllers/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/images/favicon.png"}},"image":null,"headline":"Using Admission Controllers","dateModified":null,"datePublished":null,"sameAs":null,"mainEntityOfPage":null,"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>

<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            <li><a href="/docs/home/">Documentation</a></li>
            <li><a href="http://blog.kubernetes.io/">Blog</a></li>
            <li><a href="/partners/">Partners</a></li>
            <li><a href="/community/">Community</a></li>
            <li><a href="/case-studies/">Case Studies</a></li>
            <li>
                <a href="#">
                    v1.8 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                  <li><a href="https://kubernetes.io/docs/home/">v1.8</a></li>
                
                  <li><a href="https://v1-7.docs.kubernetes.io/docs/home/">v1.7</a></li>
                
                  <li><a href="https://v1-6.docs.kubernetes.io/docs/home/">v1.6</a></li>
                
                  <li><a href="https://v1-5.docs.kubernetes.io/docs/">v1.5</a></li>
                
                  <li><a href="https://v1-4.docs.kubernetes.io/docs/">v1.4</a></li>
                
                </ul>
              </li>
            </li>
        </ul>
        <!-- <a href="/docs/home" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a> -->
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
        <div class="nav-box">
            <h3><a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a></h3>
            <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
            <p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
        </div>
        <div class="nav-box">
            <h3><a href="/community/">Community</a></h3>
            <p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
        </div>
        <div class="nav-box">
            <h3><a href="http://blog.kubernetes.io">Blog</a></h3>
            <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
        </div>
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Reference Documentation</h1>
  <h5>Design docs, concept definitions, and references for APIs and CLIs.</h5>
  <div id="vendorStrip" class="light-text">
    <ul>
      <li><a href="/docs/home/" >HOME</a></li>
      <li><a href="/docs/setup/" >SETUP</a></li>
      <li><a href="/docs/concepts/" >CONCEPTS</a></li>
      <li><a href="/docs/tasks/" >TASKS</a></li>
      <li><a href="/docs/tutorials/" >TUTORIALS</a></li>
      <li><a href="/docs/reference/" class="YAH">REFERENCE</a></li>
    </ul>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)" autofocus="autofocus">
    </div>
  </div>
</section>




<section id="encyclopedia">
  <div id="docsToc">
        <div class="pi-accordion">
          
  

    

    
      <a class="item" data-title="Reference Documentation" href="/docs/reference/"></a>
    
  

  

    

    
      <a class="item" data-title="Standardized Glossary" href="/docs/reference/glossary/"></a>
    
  

  
    <div class="item" data-title="Using the API">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Kubernetes API Overview" href="/docs/reference/api-overview/"></a>
    
  

  

    

    
      <a class="item" data-title="Client Libraries" href="/docs/reference/client-libraries/"></a>
    
  

  
    <div class="item" data-title="Accessing the API">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Kubernetes API的访问控制" href="/docs/admin/accessing-the-api/"></a>
    
  

  

    

    
      <a class="item" data-title="身份认证" href="/docs/admin/authentication/"></a>
    
  

  

    

    
      <a class="item" data-title="使用启动引导令牌（Bootstrap Tokens）认证" href="/docs/admin/bootstrap-tokens/"></a>
    
  

  

    

    
      <a class="item" data-title="Using Admission Controllers" href="/docs/admin/admission-controllers/"></a>
    
  

  

    

    
      <a class="item" data-title="Dynamic Admission Control" href="/docs/admin/extensible-admission-controllers/"></a>
    
  

  

    

    
      <a class="item" data-title="管理服务帐号（Service Accounts）" href="/docs/admin/service-accounts-admin/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Authorization">
      <div class="container">
        
  

    

    
      <a class="item" data-title="概述" href="/docs/admin/authorization/"></a>
    
  

  

    

    
      <a class="item" data-title="ABAC 模式" href="/docs/admin/authorization/abac/"></a>
    
  

  

    

    
      <a class="item" data-title="Using RBAC Authorization" href="/docs/admin/authorization/rbac/"></a>
    
  

  

    

    
      <a class="item" data-title="Using Node Authorization" href="/docs/admin/authorization/node/"></a>
    
  

  

    

    
      <a class="item" data-title="Webhook Mode" href="/docs/admin/authorization/webhook/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="Kubernetes Deprecation Policy" href="/docs/reference/deprecation-policy/"></a>
    
  

  

    

    
      <a class="item" data-title="Workloads API changes in versions 1.8 and 1.9" href="/docs/reference/workloads-18-19/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="API Reference">
      <div class="container">
        
  

    

    
      <a class="item" data-title="v1.8" href="/docs/api-reference/v1.8/"></a>
    
  

  

    

    
      <a class="item" data-title="知名标签（Label）、注解（Annotation）和 Taints" href="/docs/reference/labels-annotations-taints/"></a>
    
  

  
    <div class="item" data-title="OpenAPI and Swagger">
      <div class="container">
        
  

    

    
      <a class="item" data-title="OpenAPI Spec" href="https://git.k8s.io/kubernetes/api/openapi-spec/"></a>
    
  

  

    

    
      <a class="item" data-title="Swagger Spec" href="https://git.k8s.io/kubernetes/api/swagger-spec/"></a>
    
  


      </div>
    </div>
  


      </div>
    </div>
  

  
    <div class="item" data-title="Federation API">
      <div class="container">
        
  

    

    
      <a class="item" data-title="v1 Operations" href="/docs/reference/federation/v1/operations/"></a>
    
  

  

    

    
      <a class="item" data-title="v1 Model Definitions" href="/docs/reference/federation/v1/definitions/"></a>
    
  

  

    

    
  

  

    

    
  

  

    

    
      <a class="item" data-title="extensions/v1beta1 Operations" href="/docs/reference/federation/extensions/v1beta1/operations/"></a>
    
  

  

    

    
      <a class="item" data-title="extensions/v1beta1 Model Definitions" href="/docs/reference/federation/extensions/v1beta1/definitions/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="kubectl CLI">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Overview of kubectl" href="/docs/reference/kubectl/overview/"></a>
    
  

  

    

    
      <a class="item" data-title="kubectl" href="/docs/reference/generated/kubectl/kubectl-options/"></a>
    
  

  

    

    
      <a class="item" data-title="kubectl Commands" href="/docs/reference/generated/kubectl/kubectl-commands.html"></a>
    
  

  

    

    
      <a class="item" data-title="kubectl for Docker Users" href="/docs/reference/kubectl/docker-cli-to-kubectl/"></a>
    
  

  

    

    
      <a class="item" data-title="kubectl Usage Conventions" href="/docs/reference/kubectl/conventions/"></a>
    
  

  

    

    
      <a class="item" data-title="JSONPath Support" href="/docs/reference/kubectl/jsonpath/"></a>
    
  

  

    

    
      <a class="item" data-title="kubectl Cheat Sheet" href="/docs/reference/kubectl/cheatsheet/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Setup Tools Reference">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Kubeadm" href="/docs/reference/generated/kubeadm/"></a>
    
  

  
    <div class="item" data-title="Kubefed">
      <div class="container">
        
  

    

    
      <a class="item" data-title="kubefed" href="/docs/reference/generated/kubefed/"></a>
    
  

  

    

    
      <a class="item" data-title="kubefed options" href="/docs/reference/generated/kubefed_options/"></a>
    
  

  

    

    
      <a class="item" data-title="kubefed init" href="/docs/reference/generated/kubefed_init/"></a>
    
  

  

    

    
      <a class="item" data-title="kubefed join" href="/docs/reference/generated/kubefed_join/"></a>
    
  

  

    

    
      <a class="item" data-title="kubefed unjoin" href="/docs/reference/generated/kubefed_unjoin/"></a>
    
  

  

    

    
      <a class="item" data-title="kubefed version" href="/docs/reference/generated/kubefed_version/"></a>
    
  


      </div>
    </div>
  


      </div>
    </div>
  

  
    <div class="item" data-title="Command-line Tools Reference">
      <div class="container">
        
  

    

    
      <a class="item" data-title="kubelet" href="/docs/reference/generated/kubelet/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubelet 认证/授权" href="/docs/admin/kubelet-authentication-authorization/"></a>
    
  

  

    

    
      <a class="item" data-title="kube-apiserver" href="/docs/reference/generated/kube-apiserver/"></a>
    
  

  

    

    
      <a class="item" data-title="kube-controller-manager" href="/docs/reference/generated/kube-controller-manager/"></a>
    
  

  

    

    
      <a class="item" data-title="kube-proxy" href="/docs/reference/generated/kube-proxy/"></a>
    
  

  

    

    
      <a class="item" data-title="kube-scheduler" href="/docs/reference/generated/kube-scheduler/"></a>
    
  

  

    

    
      <a class="item" data-title="TLS 引导程序" href="/docs/admin/kubelet-tls-bootstrapping/"></a>
    
  

  

    

    
      <a class="item" data-title="cloud-controller-manager" href="/docs/reference/generated/cloud-controller-manager/"></a>
    
  

  

    

    
      <a class="item" data-title="federation-apiserver" href="/docs/reference/generated/federation-apiserver/"></a>
    
  

  

    

    
      <a class="item" data-title="federation-controller-manager" href="/docs/reference/generated/federation-controller-manager/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Kubernetes Design Docs">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Kubernetes Architecture" href="https://git.k8s.io/community/contributors/design-proposals/architecture/architecture.md"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes Design Overview" href="https://github.com/kubernetes/kubernetes/tree/release-1.6/docs/design"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes Identity and Access Management" href="https://git.k8s.io/community/contributors/design-proposals/auth/access.md"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes OpenVSwitch GRE/VxLAN 网络" href="/docs/admin/ovs-networking/"></a>
    
  

  

    

    
      <a class="item" data-title="Security Contexts" href="https://git.k8s.io/community/contributors/design-proposals/auth/security_context.md"></a>
    
  

  

    

    
      <a class="item" data-title="Security in Kubernetes" href="https://git.k8s.io/community/contributors/design-proposals/auth/security.md"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Kubernetes Issues and Security">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Kubernetes Issue Tracker on GitHub" href="https://github.com/kubernetes/kubernetes/issues/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes Security and Disclosure Information" href="/security/"></a>
    
  


      </div>
    </div>
  


        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
  </div> <!-- /docsToc -->

  <div id="docsContent">
        <p><a href="/editdocs#docs/admin/admission-controllers.md" id="editPageButton">Edit This Page</a></p>

        
          <h1>Using Admission Controllers</h1>
        

        <ul id="markdown-toc">
  <li><a href="#what-are-they" id="markdown-toc-what-are-they">What are they?</a></li>
  <li><a href="#why-do-i-need-them" id="markdown-toc-why-do-i-need-them">Why do I need them?</a></li>
  <li><a href="#how-do-i-turn-on-an-admission-control-plug-in" id="markdown-toc-how-do-i-turn-on-an-admission-control-plug-in">How do I turn on an admission control plug-in?</a></li>
  <li><a href="#what-does-each-plug-in-do" id="markdown-toc-what-does-each-plug-in-do">What does each plug-in do?</a>    <ul>
      <li><a href="#alwaysadmit" id="markdown-toc-alwaysadmit">AlwaysAdmit</a></li>
      <li><a href="#alwayspullimages" id="markdown-toc-alwayspullimages">AlwaysPullImages</a></li>
      <li><a href="#alwaysdeny" id="markdown-toc-alwaysdeny">AlwaysDeny</a></li>
      <li><a href="#denyexeconprivileged-deprecated" id="markdown-toc-denyexeconprivileged-deprecated">DenyExecOnPrivileged (deprecated)</a></li>
      <li><a href="#denyescalatingexec" id="markdown-toc-denyescalatingexec">DenyEscalatingExec</a></li>
      <li><a href="#imagepolicywebhook" id="markdown-toc-imagepolicywebhook">ImagePolicyWebhook</a>        <ul>
          <li><a href="#configuration-file-format" id="markdown-toc-configuration-file-format">Configuration File Format</a></li>
          <li><a href="#request-payloads" id="markdown-toc-request-payloads">Request Payloads</a></li>
          <li><a href="#extending-with-annotations" id="markdown-toc-extending-with-annotations">Extending with Annotations</a></li>
        </ul>
      </li>
      <li><a href="#serviceaccount" id="markdown-toc-serviceaccount">ServiceAccount</a></li>
      <li><a href="#securitycontextdeny" id="markdown-toc-securitycontextdeny">SecurityContextDeny</a></li>
      <li><a href="#resourcequota" id="markdown-toc-resourcequota">ResourceQuota</a></li>
      <li><a href="#limitranger" id="markdown-toc-limitranger">LimitRanger</a></li>
      <li><a href="#initialresources-experimental" id="markdown-toc-initialresources-experimental">InitialResources (experimental)</a></li>
      <li><a href="#namespacelifecycle" id="markdown-toc-namespacelifecycle">NamespaceLifecycle</a></li>
      <li><a href="#defaultstorageclass" id="markdown-toc-defaultstorageclass">DefaultStorageClass</a></li>
      <li><a href="#defaulttolerationseconds" id="markdown-toc-defaulttolerationseconds">DefaultTolerationSeconds</a></li>
      <li><a href="#podnodeselector" id="markdown-toc-podnodeselector">PodNodeSelector</a>        <ul>
          <li><a href="#configuration-file-format-1" id="markdown-toc-configuration-file-format-1">Configuration File Format</a></li>
          <li><a href="#configuration-annotation-format" id="markdown-toc-configuration-annotation-format">Configuration Annotation Format</a></li>
        </ul>
      </li>
      <li><a href="#podsecuritypolicy" id="markdown-toc-podsecuritypolicy">PodSecurityPolicy</a></li>
      <li><a href="#noderestriction" id="markdown-toc-noderestriction">NodeRestriction</a></li>
    </ul>
  </li>
  <li><a href="#is-there-a-recommended-set-of-plug-ins-to-use" id="markdown-toc-is-there-a-recommended-set-of-plug-ins-to-use">Is there a recommended set of plug-ins to use?</a></li>
</ul>

<h2 id="what-are-they">What are they?</h2>

<p>An admission control plug-in is a piece of code that intercepts requests to the Kubernetes
API server prior to persistence of the object, but after the request is authenticated
and authorized.  The plug-in code is in the API server process
and must be compiled into the binary in order to be used at this time.</p>

<p>Each admission control plug-in is run in sequence before a request is accepted into the cluster.  If
any of the plug-ins in the sequence reject the request, the entire request is rejected immediately
and an error is returned to the end-user.</p>

<p>Admission control plug-ins may mutate the incoming object in some cases to apply system configured
defaults.  In addition, admission control plug-ins may mutate related resources as part of request
processing to do things like increment quota usage.</p>

<h2 id="why-do-i-need-them">Why do I need them?</h2>

<p>Many advanced features in Kubernetes require an admission control plug-in to be enabled in order
to properly support the feature.  As a result, a Kubernetes API server that is not properly
configured with the right set of admission control plug-ins is an incomplete server and will not
support all the features you expect.</p>

<h2 id="how-do-i-turn-on-an-admission-control-plug-in">How do I turn on an admission control plug-in?</h2>

<p>The Kubernetes API server supports a flag, <code class="highlighter-rouge">admission-control</code> that takes a comma-delimited,
ordered list of admission control choices to invoke prior to modifying objects in the cluster.</p>

<h2 id="what-does-each-plug-in-do">What does each plug-in do?</h2>

<h3 id="alwaysadmit">AlwaysAdmit</h3>

<p>Use this plugin by itself to pass-through all requests.</p>

<h3 id="alwayspullimages">AlwaysPullImages</h3>

<p>This plug-in modifies every new Pod to force the image pull policy to Always. This is useful in a
multitenant cluster so that users can be assured that their private images can only be used by those
who have the credentials to pull them. Without this plug-in, once an image has been pulled to a
node, any pod from any user can use it simply by knowing the image’s name (assuming the Pod is
scheduled onto the right node), without any authorization check against the image. When this plug-in
is enabled, images are always pulled prior to starting containers, which means valid credentials are
required.</p>

<h3 id="alwaysdeny">AlwaysDeny</h3>

<p>Rejects all requests.  Used for testing.</p>

<h3 id="denyexeconprivileged-deprecated">DenyExecOnPrivileged (deprecated)</h3>

<p>This plug-in will intercept all requests to exec a command in a pod if that pod has a privileged container.</p>

<p>If your cluster supports privileged containers, and you want to restrict the ability of end-users to exec
commands in those containers, we strongly encourage enabling this plug-in.</p>

<p>This functionality has been merged into <a href="#denyescalatingexec">DenyEscalatingExec</a>.</p>

<h3 id="denyescalatingexec">DenyEscalatingExec</h3>

<p>This plug-in will deny exec and attach commands to pods that run with escalated privileges that
allow host access.  This includes pods that run as privileged, have access to the host IPC namespace, and
have access to the host PID namespace.</p>

<p>If your cluster supports containers that run with escalated privileges, and you want to
restrict the ability of end-users to exec commands in those containers, we strongly encourage
enabling this plug-in.</p>

<h3 id="imagepolicywebhook">ImagePolicyWebhook</h3>

<p>The ImagePolicyWebhook plug-in allows a backend webhook to make admission decisions. You enable this plug-in by setting the admission-control option as follows:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">--admission-control</span><span class="o">=</span>ImagePolicyWebhook
</code></pre></div></div>

<h4 id="configuration-file-format">Configuration File Format</h4>
<p>ImagePolicyWebhook uses the admission config file <code class="highlighter-rouge">--admission-control-config-file</code> to set configuration options for the behavior of the backend. This file may be json or yaml and has the following format:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="s2">"imagePolicy"</span><span class="p">:</span> <span class="p">{</span>
     <span class="s2">"kubeConfigFile"</span><span class="p">:</span> <span class="s2">"path/to/kubeconfig/for/backend"</span><span class="p">,</span>
     <span class="s2">"allowTTL"</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>           <span class="c1">// time in s to cache approval</span>
     <span class="s2">"denyTTL"</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>            <span class="c1">// time in s to cache denial</span>
     <span class="s2">"retryBackoff"</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>      <span class="c1">// time in ms to wait between retries</span>
     <span class="s2">"defaultAllow"</span><span class="p">:</span> <span class="kc">true</span>      <span class="c1">// determines behavior if the webhook backend fails</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The config file must reference a <a href="/docs/concepts/cluster-administration/authenticate-across-clusters-kubeconfig/">kubeconfig</a> formatted file which sets up the connection to the backend. It is required that the backend communicate over TLS.</p>

<p>The kubeconfig file’s cluster field must point to the remote service, and the user field must contain the returned authorizer.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># clusters refers to the remote service.</span>
<span class="na">clusters</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">name-of-remote-imagepolicy-service</span>
  <span class="na">cluster</span><span class="pi">:</span>
    <span class="na">certificate-authority</span><span class="pi">:</span> <span class="s">/path/to/ca.pem</span>    <span class="c1"># CA for verifying the remote service.</span>
    <span class="na">server</span><span class="pi">:</span> <span class="s">https://images.example.com/policy</span> <span class="c1"># URL of remote service to query. Must use 'https'.</span>

<span class="c1"># users refers to the API server's webhook configuration.</span>
<span class="na">users</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">name-of-api-server</span>
  <span class="na">user</span><span class="pi">:</span>
    <span class="na">client-certificate</span><span class="pi">:</span> <span class="s">/path/to/cert.pem</span> <span class="c1"># cert for the webhook plugin to use</span>
    <span class="na">client-key</span><span class="pi">:</span> <span class="s">/path/to/key.pem</span>          <span class="c1"># key matching the cert</span>
</code></pre></div></div>
<p>For additional HTTP configuration, refer to the <a href="/docs/concepts/cluster-administration/authenticate-across-clusters-kubeconfig/">kubeconfig</a> documentation.</p>

<h4 id="request-payloads">Request Payloads</h4>

<p>When faced with an admission decision, the API Server POSTs a JSON serialized api.imagepolicy.v1alpha1.ImageReview object describing the action. This object contains fields describing the containers being admitted, as well as any pod annotations that match <code class="highlighter-rouge">*.image-policy.k8s.io/*</code>.</p>

<p>Note that webhook API objects are subject to the same versioning compatibility rules as other Kubernetes API objects. Implementers should be aware of looser compatibility promises for alpha objects and check the “apiVersion” field of the request to ensure correct deserialization. Additionally, the API Server must enable the imagepolicy.k8s.io/v1alpha1 API extensions group (<code class="highlighter-rouge">--runtime-config=imagepolicy.k8s.io/v1alpha1=true</code>).</p>

<p>An example request body:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{  
  "apiVersion":"imagepolicy.k8s.io/v1alpha1",
  "kind":"ImageReview",
  "spec":{  
    "containers":[  
      {  
        "image":"myrepo/myimage:v1"
      },
      {  
        "image":"myrepo/myimage@sha256:beb6bd6a68f114c1dc2ea4b28db81bdf91de202a9014972bec5e4d9171d90ed"
      }
    ],
    "annotations":[  
      "mycluster.image-policy.k8s.io/ticket-1234": "break-glass"
    ],
    "namespace":"mynamespace"
  }
}
</code></pre></div></div>

<p>The remote service is expected to fill the ImageReviewStatus field of the request and respond to either allow or disallow access. The response body’s “spec” field is ignored and may be omitted. A permissive response would return:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "apiVersion": "imagepolicy.k8s.io/v1alpha1",
  "kind": "ImageReview",
  "status": {
    "allowed": true
  }
}
</code></pre></div></div>

<p>To disallow access, the service would return:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "apiVersion": "imagepolicy.k8s.io/v1alpha1",
  "kind": "ImageReview",
  "status": {
    "allowed": false,
    "reason": "image currently blacklisted"
  }
}
</code></pre></div></div>

<p>For further documentation refer to the <code class="highlighter-rouge">imagepolicy.v1alpha1</code> API objects and <code class="highlighter-rouge">plugin/pkg/admission/imagepolicy/admission.go</code>.</p>

<h4 id="extending-with-annotations">Extending with Annotations</h4>

<p>All annotations on a Pod that match <code class="highlighter-rouge">*.image-policy.k8s.io/*</code> are sent to the webhook. Sending annotations allows users who are aware of the image policy backend to send extra information to it, and for different backends implementations to accept different information.</p>

<p>Examples of information you might put here are:</p>

<ul>
  <li>request to “break glass” to override a policy, in case of emergency.</li>
  <li>a ticket number from a ticket system that documents the break-glass request</li>
  <li>provide a hint to the policy server as to the imageID of the image being provided, to save it a lookup</li>
</ul>

<p>In any case, the annotations are provided by the user and are not validated by Kubernetes in any way. In the future, if an annotation is determined to be widely useful, it may be promoted to a named field of ImageReviewSpec.</p>

<h3 id="serviceaccount">ServiceAccount</h3>

<p>This plug-in implements automation for <a href="/docs/user-guide/service-accounts">serviceAccounts</a>.
We strongly recommend using this plug-in if you intend to make use of Kubernetes <code class="highlighter-rouge">ServiceAccount</code> objects.</p>

<h3 id="securitycontextdeny">SecurityContextDeny</h3>

<p>This plug-in will deny any pod that attempts to set certain escalating <a href="/docs/user-guide/security-context">SecurityContext</a> fields. This should be enabled if a cluster doesn’t utilize <a href="/docs/user-guide/pod-security-policy">pod security policies</a> to restrict the set of values a security context can take.</p>

<h3 id="resourcequota">ResourceQuota</h3>

<p>This plug-in will observe the incoming request and ensure that it does not violate any of the constraints
enumerated in the <code class="highlighter-rouge">ResourceQuota</code> object in a <code class="highlighter-rouge">Namespace</code>.  If you are using <code class="highlighter-rouge">ResourceQuota</code>
objects in your Kubernetes deployment, you MUST use this plug-in to enforce quota constraints.</p>

<p>See the <a href="https://git.k8s.io/community/contributors/design-proposals/admission_control_resource_quota.md">resourceQuota design doc</a> and the <a href="/docs/concepts/policy/resource-quotas/">example of Resource Quota</a> for more details.</p>

<p>It is strongly encouraged that this plug-in is configured last in the sequence of admission control plug-ins.  This is
so that quota is not prematurely incremented only for the request to be rejected later in admission control.</p>

<h3 id="limitranger">LimitRanger</h3>

<p>This plug-in will observe the incoming request and ensure that it does not violate any of the constraints
enumerated in the <code class="highlighter-rouge">LimitRange</code> object in a <code class="highlighter-rouge">Namespace</code>.  If you are using <code class="highlighter-rouge">LimitRange</code> objects in
your Kubernetes deployment, you MUST use this plug-in to enforce those constraints. LimitRanger can also
be used to apply default resource requests to Pods that don’t specify any; currently, the default LimitRanger
applies a 0.1 CPU requirement to all Pods in the <code class="highlighter-rouge">default</code> namespace.</p>

<p>See the <a href="https://git.k8s.io/community/contributors/design-proposals/admission_control_limit_range.md">limitRange design doc</a> and the <a href="/docs/tasks/configure-pod-container/limit-range/">example of Limit Range</a> for more details.</p>

<h3 id="initialresources-experimental">InitialResources (experimental)</h3>

<p>This plug-in observes pod creation requests. If a container omits compute resource requests and limits,
then the plug-in auto-populates a compute resource request based on historical usage of containers running the same image.
If there is not enough data to make a decision the Request is left unchanged.
When the plug-in sets a compute resource request, it annotates the pod with information on what compute resources it auto-populated.</p>

<p>See the <a href="https://git.k8s.io/community/contributors/design-proposals/initial-resources.md">InitialResouces proposal</a> for more details.</p>

<h3 id="namespacelifecycle">NamespaceLifecycle</h3>

<p>This plug-in enforces that a <code class="highlighter-rouge">Namespace</code> that is undergoing termination cannot have new objects created in it,
and ensures that requests in a non-existent <code class="highlighter-rouge">Namespace</code> are rejected.</p>

<p>A <code class="highlighter-rouge">Namespace</code> deletion kicks off a sequence of operations that remove all objects (pods, services, etc.) in that
namespace.  In order to enforce integrity of that process, we strongly recommend running this plug-in.</p>

<h3 id="defaultstorageclass">DefaultStorageClass</h3>

<p>This plug-in observes creation of <code class="highlighter-rouge">PersistentVolumeClaim</code> objects that do not request any specific storage class
and automatically adds a default storage class to them.
This way, users that do not request any special storage class do no need to care about them at all and they
will get the default one.</p>

<p>This plug-in does not do anything when no default storage class is configured. When more than one storage
class is marked as default, it rejects any creation of <code class="highlighter-rouge">PersistentVolumeClaim</code> with an error and administrator
must revisit <code class="highlighter-rouge">StorageClass</code> objects and mark only one as default.
This plugin ignores any <code class="highlighter-rouge">PersistentVolumeClaim</code> updates, it acts only on creation.</p>

<p>See <a href="/docs/user-guide/persistent-volumes">persistent volume</a> documentation about persistent volume claims and
storage classes and how to mark a storage class as default.</p>

<h3 id="defaulttolerationseconds">DefaultTolerationSeconds</h3>

<p>This plug-in sets the default forgiveness toleration for pods, which have no forgiveness tolerations, to tolerate
the taints <code class="highlighter-rouge">notready:NoExecute</code> and <code class="highlighter-rouge">unreachable:NoExecute</code> for 5 minutes.</p>

<h3 id="podnodeselector">PodNodeSelector</h3>

<p>This plug-in defaults and limits what node selectors may be used within a namespace by reading a namespace annotation and a global configuration.</p>

<h4 id="configuration-file-format-1">Configuration File Format</h4>
<p>PodNodeSelector uses the admission config file <code class="highlighter-rouge">--admission-control-config-file</code> to set configuration options for the behavior of the backend.</p>

<p>Note that the configuration file format will move to a versioned file in a future release.</p>

<p>This file may be json or yaml and has the following format:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">podNodeSelectorPluginConfig</span><span class="pi">:</span>
 <span class="na">clusterDefaultNodeSelector</span><span class="pi">:</span> <span class="s">&lt;node-selectors-labels&gt;</span>
 <span class="na">namespace1</span><span class="pi">:</span> <span class="s">&lt;node-selectors-labels&gt;</span>
 <span class="na">namespace2</span><span class="pi">:</span> <span class="s">&lt;node-selectors-labels&gt;</span>
</code></pre></div></div>

<h4 id="configuration-annotation-format">Configuration Annotation Format</h4>
<p>PodNodeSelector uses the annotation key <code class="highlighter-rouge">scheduler.alpha.kubernetes.io/node-selector</code> to assign node selectors to namespaces.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Namespace</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="s">scheduler.alpha.kubernetes.io/node-selector</span><span class="pi">:</span> <span class="s">&lt;node-selectors-labels&gt;</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">namespace3</span>
</code></pre></div></div>

<h3 id="podsecuritypolicy">PodSecurityPolicy</h3>

<p>This plug-in acts on creation and modification of the pod and determines if it should be admitted
based on the requested security context and the available Pod Security Policies.</p>

<p>For Kubernetes &lt; 1.6.0, the API Server must enable the extensions/v1beta1/podsecuritypolicy API
extensions group (<code class="highlighter-rouge">--runtime-config=extensions/v1beta1/podsecuritypolicy=true</code>).</p>

<p>See also <a href="/docs/concepts/policy/pod-security-policy/">Pod Security Policy documentation</a>
for more information.</p>

<h3 id="noderestriction">NodeRestriction</h3>

<p>This plug-in limits the <code class="highlighter-rouge">Node</code> and <code class="highlighter-rouge">Pod</code> objects a kubelet can modify. In order to be limited by this admission plugin,
kubelets must use credentials in the <code class="highlighter-rouge">system:nodes</code> group, with a username in the form <code class="highlighter-rouge">system:node:&lt;nodeName&gt;</code>. 
Such kubelets will only be allowed to modify their own <code class="highlighter-rouge">Node</code> API object, and only modify <code class="highlighter-rouge">Pod</code> API objects that are bound to their node.
Future versions may add additional restrictions to ensure kubelets have the minimal set of permissions required to operate correctly.</p>

<h2 id="is-there-a-recommended-set-of-plug-ins-to-use">Is there a recommended set of plug-ins to use?</h2>

<p>Yes.
For Kubernetes &gt;= 1.6.0, we strongly recommend running the following set of admission control plug-ins (order matters):</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">--admission-control</span><span class="o">=</span>NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeLabel,DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds
</code></pre></div></div>

<p>For Kubernetes &gt;= 1.4.0, we strongly recommend running the following set of admission control plug-ins (order matters):</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">--admission-control</span><span class="o">=</span>NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota
</code></pre></div></div>

<p>For Kubernetes &gt;= 1.2.0, we strongly recommend running the following set of admission control plug-ins (order matters):</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">--admission-control</span><span class="o">=</span>NamespaceLifecycle,LimitRanger,ServiceAccount,ResourceQuota
</code></pre></div></div>

<p>For Kubernetes &gt;= 1.0.0, we strongly recommend running the following set of admission control plug-ins (order matters):</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">--admission-control</span><span class="o">=</span>NamespaceLifecycle,LimitRanger,SecurityContextDeny,ServiceAccount,PersistentVolumeLabel,ResourceQuota
</code></pre></div></div>


        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/admin/admission-controllers.md?pixel" alt="Analytics" /></a></p>
        
	
        <script type="text/javascript">
            PDRTJS_settings_8345992 = {
                "id" : "8345992",
                "unique_id" : "/docs/admin/admission-controllers/",
                "title" : "Using Admission Controllers",
                "permalink" : "http://kubernetes.github.io/docs/admin/admission-controllers/"
            };
            (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
        <a href="" onclick="window.open('https://github.com/kubernetes/kubernetes.github.io/issues/new?title=Issue%20with%20' +
        'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
	
        
          <a href="/editdocs#docs/admin/admission-controllers.md" class="button issue">Edit this Page</a>
        
    
    </div>
</section>

<footer>
    <main class="light-text">
        <nav>
            <a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a>
            <a href="/docs/home/">Documentation</a>
            <a href="http://blog.kubernetes.io/">Blog</a>
            <a href="/partners/">Partners</a>
            <a href="/community/">Community</a>
            <a href="/case-studies/">Case Studies</a>
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                <a href="/docs/setup/pick-right-solution/" class="button">Get Kubernetes</a>
                <a href="https://github.com/kubernetes/kubernetes" class="button">Contribute</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2017 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2017 The Linux Foundation&reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our Trademark Usage page: <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">https://www.linuxfoundation.org/trademark-usage</a>
        </div>
    </main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
.cse .gsc-control-cse, .gsc-control-cse, {
    padding: 0;
}
  .gsc-control-cse table, .gsc-control-cse-en table {
      margin:0px !important;
  }
  .gsc-above-wrapper-area {
      border-bottom: 0;
  }
</style>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36037335-10', 'auto');
ga('send', 'pageview');

// hide docs nav area if no nav is present, or if nav only contains a link to the current page
(function () {
    window.addEventListener('DOMContentLoaded', init)

        // play nice with our neighbors
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
            var container = toc.querySelector('.container')

                // container is built dynamically, so it may not be present on the first runloop
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>

<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
    <!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->


</body>
</html>
