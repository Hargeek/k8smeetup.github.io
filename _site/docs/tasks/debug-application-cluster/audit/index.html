
  
    
    

  

  
    
    

  

  
    
    

  

  
    

<!Doctype html>
<html id="docs" class="Tasks">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono">
    <link rel="stylesheet" type="text/css" href="/css/styles.css"><!-- default styles.css on -->
    <link rel="stylesheet" type="text/css" href="/css/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="/css/sweetalert.css">
    <link rel="stylesheet" type="text/css" href="/css/callouts.css">
    <link rel="stylesheet" type="text/css" href="/css/custom-jekyll/tags.css">
    
    
    <!-- no custom css detected -->

    
    <meta name="description" content="Auditing" />
    

    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/jquery-ui.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/sweetalert.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/custom-jekyll/tags.js"></script>
    <!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Auditing | Kubernetes</title>
<meta property="og:title" content="Auditing" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Production-Grade Container Orchestration" />
<meta property="og:description" content="Production-Grade Container Orchestration" />
<link rel="canonical" href="http://0.0.0.0:4000/docs/tasks/debug-application-cluster/audit/" />
<meta property="og:url" content="http://0.0.0.0:4000/docs/tasks/debug-application-cluster/audit/" />
<meta property="og:site_name" content="Kubernetes" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@kubernetesio" />
<script type="application/ld+json">
{"name":null,"description":"Production-Grade Container Orchestration","author":null,"@type":"WebPage","url":"http://0.0.0.0:4000/docs/tasks/debug-application-cluster/audit/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/images/favicon.png"}},"image":null,"headline":"Auditing","dateModified":null,"datePublished":null,"sameAs":null,"mainEntityOfPage":null,"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>

<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            <li><a href="/docs/home/">Documentation</a></li>
            <li><a href="http://blog.kubernetes.io/">Blog</a></li>
            <li><a href="/partners/">Partners</a></li>
            <li><a href="/community/">Community</a></li>
            <li><a href="/case-studies/">Case Studies</a></li>
            <li>
                <a href="#">
                    v1.8 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                  <li><a href="https://kubernetes.io/docs/home/">v1.8</a></li>
                
                  <li><a href="https://v1-7.docs.kubernetes.io/docs/home/">v1.7</a></li>
                
                  <li><a href="https://v1-6.docs.kubernetes.io/docs/home/">v1.6</a></li>
                
                  <li><a href="https://v1-5.docs.kubernetes.io/docs/">v1.5</a></li>
                
                  <li><a href="https://v1-4.docs.kubernetes.io/docs/">v1.4</a></li>
                
                </ul>
              </li>
            </li>
        </ul>
        <!-- <a href="/docs/home" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a> -->
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
        <div class="nav-box">
            <h3><a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a></h3>
            <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
            <p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
        </div>
        <div class="nav-box">
            <h3><a href="/community/">Community</a></h3>
            <p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
        </div>
        <div class="nav-box">
            <h3><a href="http://blog.kubernetes.io">Blog</a></h3>
            <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
        </div>
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Tasks</h1>
  <h5>Step-by-step instructions for performing operations with Kubernetes.</h5>
  <div id="vendorStrip" class="light-text">
    <ul>
      <li><a href="/docs/home/" >HOME</a></li>
      <li><a href="/docs/setup/" >SETUP</a></li>
      <li><a href="/docs/concepts/" >CONCEPTS</a></li>
      <li><a href="/docs/tasks/" class="YAH">TASKS</a></li>
      <li><a href="/docs/tutorials/" >TUTORIALS</a></li>
      <li><a href="/docs/reference/" >REFERENCE</a></li>
    </ul>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)" autofocus="autofocus">
    </div>
  </div>
</section>




<section id="encyclopedia">
  <div id="docsToc">
        <div class="pi-accordion">
          
  

    

    
      <a class="item" data-title="任务" href="/docs/tasks/"></a>
    
  

  
    <div class="item" data-title="Install Tools">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Install and Set Up kubectl" href="/docs/tasks/tools/install-kubectl/"></a>
    
  

  

    

    
      <a class="item" data-title="Install Minikube" href="/docs/tasks/tools/install-minikube/"></a>
    
  

  

    

    
      <a class="item" data-title="安装 kubeadm" href="/docs/setup/independent/install-kubeadm/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Configure Pods and Containers">
      <div class="container">
        
  

    

    
      <a class="item" data-title="给容器和Pod分配内存资源" href="/docs/tasks/configure-pod-container/assign-memory-resource/"></a>
    
  

  

    

    
      <a class="item" data-title="给容器和Pod分配CPU资源" href="/docs/tasks/configure-pod-container/assign-cpu-resource/"></a>
    
  

  

    

    
      <a class="item" data-title="给 Pod 配置服务质量等级" href="/docs/tasks/configure-pod-container/quality-service-pod/"></a>
    
  

  

    

    
      <a class="item" data-title="Assign CPU and RAM Resources to a Container" href="/docs/tasks/configure-pod-container/assign-cpu-ram-container/"></a>
    
  

  

    

    
      <a class="item" data-title="Assign Opaque Integer Resources to a Container" href="/docs/tasks/configure-pod-container/opaque-integer-resource/"></a>
    
  

  

    

    
      <a class="item" data-title="配置Pod使用卷作为存储" href="/docs/tasks/configure-pod-container/configure-volume-storage/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/tasks/configure-pod-container/configure-persistent-volume-storage/"></a>
    
  

  

    

    
      <a class="item" data-title="配置Pod使用配套的存储卷作为存储" href="/docs/tasks/configure-pod-container/configure-projected-volume-storage/"></a>
    
  

  

    

    
  

  

    

    
      <a class="item" data-title="Configure a Security Context for a Pod or Container" href="/docs/tasks/configure-pod-container/security-context/"></a>
    
  

  

    

    
  

  

    

    
      <a class="item" data-title="配置Pod的Service Account" href="/docs/tasks/configure-pod-container/configure-service-account/"></a>
    
  

  

    

    
      <a class="item" data-title="从私有仓库拉取镜像" href="/docs/tasks/configure-pod-container/pull-image-private-registry/"></a>
    
  

  

    

    
      <a class="item" data-title="配置Liveness和Readiness探针" href="/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/"></a>
    
  

  

    

    
      <a class="item" data-title="向节点分配 Pod" href="/docs/tasks/configure-pod-container/assign-pods-nodes/"></a>
    
  

  

    

    
      <a class="item" data-title="配置Pod初始化" href="/docs/tasks/configure-pod-container/configure-pod-initialization/"></a>
    
  

  

    

    
      <a class="item" data-title="给容器生命周期设置操作事件" href="/docs/tasks/configure-pod-container/attach-handler-lifecycle-event/"></a>
    
  

  

    

    
      <a class="item" data-title="使用ConfigMap配置容器" href="/docs/tasks/configure-pod-container/configmap/"></a>
    
  

  

    

    
      <a class="item" data-title="在 Pod 里使用 ConfigMap 数据" href="/docs/tasks/configure-pod-container/configure-pod-configmap/"></a>
    
  

  

    

    
      <a class="item" data-title="Translate a Docker Compose File to Kubernetes Resources" href="/docs/tools/kompose/user-guide/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Inject Data Into Applications">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Define a Command and Arguments for a Container" href="/docs/tasks/inject-data-application/define-command-argument-container/"></a>
    
  

  

    

    
      <a class="item" data-title="Define Environment Variables for a Container" href="/docs/tasks/inject-data-application/define-environment-variable-container/"></a>
    
  

  

    

    
      <a class="item" data-title="Expose Pod Information to Containers Through Environment Variables" href="/docs/tasks/inject-data-application/environment-variable-expose-pod-information/"></a>
    
  

  

    

    
      <a class="item" data-title="Expose Pod Information to Containers Through Files" href="/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Secrets 安全地分发凭证" href="/docs/tasks/inject-data-application/distribute-credentials-secure/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 PodPreset 将信息注入 Pods" href="/docs/tasks/inject-data-application/podpreset/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Run Applications">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Run a Stateless Application Using a Deployment" href="/docs/tasks/run-application/run-stateless-application-deployment/"></a>
    
  

  

    

    
      <a class="item" data-title="Run a Single-Instance Stateful Application" href="/docs/tasks/run-application/run-single-instance-stateful-application/"></a>
    
  

  

    

    
      <a class="item" data-title="Run a Replicated Stateful Application" href="/docs/tasks/run-application/run-replicated-stateful-application/"></a>
    
  

  

    

    
      <a class="item" data-title="Update API Objects in Place Using kubectl patch" href="/docs/tasks/run-application/update-api-object-kubectl-patch/"></a>
    
  

  

    

    
      <a class="item" data-title="Upgrade from PetSets to StatefulSets" href="/docs/tasks/run-application/upgrade-pet-set-to-stateful-set/"></a>
    
  

  

    

    
      <a class="item" data-title="Scale a StatefulSet" href="/docs/tasks/run-application/scale-stateful-set/"></a>
    
  

  

    

    
      <a class="item" data-title="删除StatefulSet" href="/docs/tasks/run-application/delete-stateful-set/"></a>
    
  

  

    

    
      <a class="item" data-title="强制删除StatefulSet中的Pod" href="/docs/tasks/run-application/force-delete-stateful-set-pod/"></a>
    
  

  

    

    
      <a class="item" data-title="Perform Rolling Update Using a Replication Controller" href="/docs/tasks/run-application/rolling-update-replication-controller/"></a>
    
  

  

    

    
      <a class="item" data-title="Horizontal Pod Autoscaling" href="/docs/tasks/run-application/horizontal-pod-autoscale/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod水平自动伸缩（Horizontal Pod Autoscaling）演练" href="/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/"></a>
    
  

  

    

    
      <a class="item" data-title="指定应用程序的中断预算（Disruption Budget）" href="/docs/tasks/run-application/configure-pdb/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Run Jobs">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Parallel Processing using Expansions" href="/docs/tasks/job/parallel-processing-expansion/"></a>
    
  

  

    

    
      <a class="item" data-title="Coarse Parallel Processing Using a Work Queue" href="/docs/tasks/job/coarse-parallel-processing-work-queue/"></a>
    
  

  

    

    
      <a class="item" data-title="Fine Parallel Processing Using a Work Queue" href="/docs/tasks/job/fine-parallel-processing-work-queue/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Access Applications in a Cluster">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Web UI (Dashboard)" href="/docs/tasks/access-application-cluster/web-ui-dashboard/"></a>
    
  

  

    

    
      <a class="item" data-title="访问集群" href="/docs/tasks/access-application-cluster/access-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="配置对多集群的访问" href="/docs/tasks/access-application-cluster/configure-access-multiple-clusters/"></a>
    
  

  

    

    
      <a class="item" data-title="通过端口转发访问集群中的应用程序" href="/docs/tasks/access-application-cluster/port-forward-access-application-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="Provide Load-Balanced Access to an Application in a Cluster" href="/docs/tasks/access-application-cluster/load-balance-access-application-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 service 访问群集中的应用程序" href="/docs/tasks/access-application-cluster/service-access-application-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Service 把前端连接到后端" href="/docs/tasks/access-application-cluster/connecting-frontend-backend/"></a>
    
  

  

    

    
      <a class="item" data-title="创建一个外部负载均衡器" href="/docs/tasks/access-application-cluster/create-external-load-balancer/"></a>
    
  

  

    

    
      <a class="item" data-title="配置云平台防火墙" href="/docs/tasks/access-application-cluster/configure-cloud-provider-firewall/"></a>
    
  

  

    

    
      <a class="item" data-title="List All Container Images Running in a Cluster" href="/docs/tasks/access-application-cluster/list-all-running-container-images/"></a>
    
  

  

    

    
      <a class="item" data-title="同 Pod 内的容器使用共享卷通信" href="/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/"></a>
    
  

  

    

    
      <a class="item" data-title="Configuring DNS for a Cluster" href="https://github.com/kubernetes/kubernetes/tree/release-1.5/examples/cluster-dns"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Monitor, Log, and Debug">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Core metrics pipeline" href="/docs/tasks/debug-application-cluster/core-metrics-pipeline/"></a>
    
  

  

    

    
      <a class="item" data-title="对计算、存储和网络资源进行监控的工具" href="/docs/tasks/debug-application-cluster/resource-usage-monitoring/"></a>
    
  

  

    

    
      <a class="item" data-title="获取一个运行容器的 Shell" href="/docs/tasks/debug-application-cluster/get-shell-running-container/"></a>
    
  

  

    

    
      <a class="item" data-title="监控节点健康状况" href="/docs/tasks/debug-application-cluster/monitor-node-health/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Stackdriver 查看日志" href="/docs/tasks/debug-application-cluster/logging-stackdriver/"></a>
    
  

  

    

    
      <a class="item" data-title="Stackdriver 中的事件" href="/docs/tasks/debug-application-cluster/events-stackdriver/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Elasticsearch 和 Kibana 查看日志" href="/docs/tasks/debug-application-cluster/logging-elasticsearch-kibana/"></a>
    
  

  

    

    
      <a class="item" data-title="确定 Pod 失败的原因" href="/docs/tasks/debug-application-cluster/determine-reason-pod-failure/"></a>
    
  

  

    

    
      <a class="item" data-title="调试 Init 容器" href="/docs/tasks/debug-application-cluster/debug-init-containers/"></a>
    
  

  

    

    
      <a class="item" data-title="Debug Pods and Replication Controllers" href="/docs/tasks/debug-application-cluster/debug-pod-replication-controller/"></a>
    
  

  

    

    
      <a class="item" data-title="Debug Services" href="/docs/tasks/debug-application-cluster/debug-service/"></a>
    
  

  

    

    
      <a class="item" data-title="Troubleshoot Clusters" href="/docs/tasks/debug-application-cluster/debug-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="Troubleshoot Applications" href="/docs/tasks/debug-application-cluster/debug-application/"></a>
    
  

  

    

    
      <a class="item" data-title="Debug a StatefulSet" href="/docs/tasks/debug-application-cluster/debug-stateful-set/"></a>
    
  

  

    

    
      <a class="item" data-title="Application Introspection and Debugging" href="/docs/tasks/debug-application-cluster/debug-application-introspection/"></a>
    
  

  

    

    
      <a class="item" data-title="Auditing" href="/docs/tasks/debug-application-cluster/audit/"></a>
    
  

  

    

    
      <a class="item" data-title="Developing and debugging services locally" href="/docs/tasks/debug-application-cluster/local-debugging/"></a>
    
  

  

    

    
      <a class="item" data-title="Use Explorer to Examine the Runtime Environment" href="https://github.com/kubernetes/kubernetes/tree/release-1.5/examples/explorer"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Extend Kubernetes">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Use an HTTP Proxy to Access the Kubernetes API" href="/docs/tasks/access-kubernetes-api/http-proxy-access-api/"></a>
    
  

  

    

    
      <a class="item" data-title="使用CRD(CustomResourceDefinitions)扩展Kubernetes API" href="/docs/tasks/access-kubernetes-api/extend-api-custom-resource-definitions/"></a>
    
  

  

    

    
      <a class="item" data-title="Extend the Kubernetes API with ThirdPartyResources" href="/docs/tasks/access-kubernetes-api/extend-api-third-party-resource/"></a>
    
  

  

    

    
      <a class="item" data-title="Migrate a ThirdPartyResource to CustomResourceDefinition" href="/docs/tasks/access-kubernetes-api/migrate-third-party-resource/"></a>
    
  

  

    

    
      <a class="item" data-title="Configure the aggregation layer" href="/docs/tasks/access-kubernetes-api/configure-aggregation-layer/"></a>
    
  

  

    

    
      <a class="item" data-title="配置扩展 API 服务器" href="/docs/tasks/access-kubernetes-api/setup-extension-api-server/"></a>
    
  

  

    

    
      <a class="item" data-title="Install Service Catalog using Helm" href="/docs/tasks/service-catalog/install-service-catalog-using-helm/"></a>
    
  

  

    

    
      <a class="item" data-title="Install Service Catalog using SC" href="/docs/tasks/service-catalog/install-service-catalog-using-sc/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="TLS">
      <div class="container">
        
  

    

    
      <a class="item" data-title="管理集群中的TLS认证" href="/docs/tasks/tls/managing-tls-in-a-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="证书轮换" href="/docs/tasks/tls/certificate-rotation/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Administer a Cluster">
      <div class="container">
        
  
    <div class="item" data-title="Manage Memory, CPU, and API Resources">
      <div class="container">
        
  

    

    
      <a class="item" data-title="为命名空间配置默认的内存请求与限额" href="/docs/tasks/administer-cluster/memory-default-namespace/"></a>
    
  

  

    

    
      <a class="item" data-title="在命名空间中配置默认的CPU请求与限额" href="/docs/tasks/administer-cluster/cpu-default-namespace/"></a>
    
  

  

    

    
      <a class="item" data-title="为 Namespace 设置最小和最大内存限制" href="/docs/tasks/administer-cluster/memory-constraint-namespace/"></a>
    
  

  

    

    
      <a class="item" data-title="为 Namespace 配置最小和最大 CPU 限制" href="/docs/tasks/administer-cluster/cpu-constraint-namespace/"></a>
    
  

  

    

    
      <a class="item" data-title="应用资源配额和限额" href="/docs/tasks/administer-cluster/apply-resource-quota-limit/"></a>
    
  

  

    

    
      <a class="item" data-title="为名字空间配置CPU和内存配额（Quota）" href="/docs/tasks/administer-cluster/quota-memory-cpu-namespace/"></a>
    
  

  

    

    
      <a class="item" data-title="为名字空间配置Pod配额" href="/docs/tasks/administer-cluster/quota-pod-namespace/"></a>
    
  

  

    

    
      <a class="item" data-title="配置API对象（API Object）的配额（Quota）" href="/docs/tasks/administer-cluster/quota-api-object/"></a>
    
  

  

    

    
      <a class="item" data-title="为节点发布不透明整数资源（Opaque Integer Resources）" href="/docs/tasks/administer-cluster/opaque-integer-resource-node/"></a>
    
  

  

    

    
      <a class="item" data-title="控制节点上的CPU管理策略" href="/docs/tasks/administer-cluster/cpu-management-policies/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="通过 Kubernetes API 访问集群" href="/docs/tasks/administer-cluster/access-cluster-api/"></a>
    
  

  

    

    
      <a class="item" data-title="访问集群上运行的服务" href="/docs/tasks/administer-cluster/access-cluster-services/"></a>
    
  

  

    

    
      <a class="item" data-title="集群安全" href="/docs/tasks/administer-cluster/securing-a-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="Encrypting data at rest" href="/docs/tasks/administer-cluster/encrypt-data/"></a>
    
  

  

    

    
      <a class="item" data-title="Operating etcd clusters for Kubernetes" href="/docs/tasks/administer-cluster/configure-upgrade-etcd/"></a>
    
  

  

    

    
      <a class="item" data-title="静态 Pod" href="/docs/tasks/administer-cluster/static-pod/"></a>
    
  

  

    

    
      <a class="item" data-title="集群管理" href="/docs/tasks/administer-cluster/cluster-management/"></a>
    
  

  

    

    
      <a class="item" data-title="1.6 版本集群管理指南" href="/docs/tasks/administer-cluster/upgrade-1-6/"></a>
    
  

  

    

    
      <a class="item" data-title="将 kubeadm 集群从 1.6 升级到 1.7" href="/docs/tasks/administer-cluster/kubeadm-upgrade-1-7/"></a>
    
  

  

    

    
      <a class="item" data-title="将 kubeadm 集群从 1.7 升级到 1.8" href="/docs/tasks/administer-cluster/kubeadm-upgrade-1-8/"></a>
    
  

  

    

    
      <a class="item" data-title="使用命名空间共享一个集群" href="/docs/tasks/administer-cluster/namespaces/"></a>
    
  

  

    

    
      <a class="item" data-title="演示命名空间" href="/docs/tasks/administer-cluster/namespaces-walkthrough/"></a>
    
  

  

    

    
      <a class="item" data-title="集群 DNS Service Autoscale" href="/docs/tasks/administer-cluster/dns-horizontal-autoscaling/"></a>
    
  

  

    

    
      <a class="item" data-title="遵循应用中断预算安全移除节点" href="/docs/tasks/administer-cluster/safely-drain-node/"></a>
    
  

  

    

    
      <a class="item" data-title="设置 Pod CPU 和内存限制" href="/docs/tasks/administer-cluster/cpu-memory-limit/"></a>
    
  

  

    

    
      <a class="item" data-title="配置资源不足处理方式" href="/docs/tasks/administer-cluster/out-of-resource/"></a>
    
  

  

    

    
      <a class="item" data-title="为系统守护进程预留计算资源" href="/docs/tasks/administer-cluster/reserve-compute-resources/"></a>
    
  

  

    

    
      <a class="item" data-title="关键插件 Pod 的调度保证" href="/docs/tasks/administer-cluster/guaranteed-scheduling-critical-addon-pods/"></a>
    
  

  

    

    
      <a class="item" data-title="声明网络策略" href="/docs/tasks/administer-cluster/declare-network-policy/"></a>
    
  

  

    

    
      <a class="item" data-title="重新配置活动集群中节点的 Kubelet" href="/docs/tasks/administer-cluster/reconfigure-kubelet/"></a>
    
  

  

    

    
      <a class="item" data-title="通过配置文件设置 Kubelet 参数" href="/docs/tasks/administer-cluster/kubelet-config-file/"></a>
    
  

  
    <div class="item" data-title="Install Network Policy Provider">
      <div class="container">
        
  

    

    
      <a class="item" data-title="为了 NetworkPolicy 使用 Calico" href="/docs/tasks/administer-cluster/calico-network-policy/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Cilium 来提供 NetworkPolicy" href="/docs/tasks/administer-cluster/cilium-network-policy/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Kube-router 来提供 NetworkPolicy" href="/docs/tasks/administer-cluster/kube-router-network-policy/"></a>
    
  

  

    

    
      <a class="item" data-title="为了 NetworkPolicy 使用 Romana" href="/docs/tasks/administer-cluster/romana-network-policy/"></a>
    
  

  

    

    
      <a class="item" data-title="为了 NetworkPolicy 使用 Weave 网络" href="/docs/tasks/administer-cluster/weave-network-policy/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="更改 PersistentVolume 的回收策略" href="/docs/tasks/administer-cluster/change-pv-reclaim-policy/"></a>
    
  

  

    

    
  

  

    

    
      <a class="item" data-title="限制存储使用量" href="/docs/tasks/administer-cluster/limit-storage-consumption/"></a>
    
  

  

    

    
      <a class="item" data-title="改变默认 StorageClass" href="/docs/tasks/administer-cluster/change-default-storage-class/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes 云管理控制器" href="/docs/tasks/administer-cluster/running-cloud-controller/"></a>
    
  

  

    

    
      <a class="item" data-title="开发云管理控制器（Cloud Controller Manager）" href="/docs/tasks/administer-cluster/developing-cloud-controller-manager/"></a>
    
  

  

    

    
      <a class="item" data-title="建立高可用 Kubernetes Master" href="/docs/tasks/administer-cluster/highly-available-master/"></a>
    
  

  

    

    
      <a class="item" data-title="配置多个调度器" href="/docs/tasks/administer-cluster/configure-multiple-schedulers/"></a>
    
  

  

    

    
      <a class="item" data-title="IP 伪装代理用户指南" href="/docs/tasks/administer-cluster/ip-masq-agent/"></a>
    
  

  

    

    
      <a class="item" data-title="在 Kubernetes 中配置私有 DNS 和上游 nameserver" href="/docs/tasks/administer-cluster/dns-custom-nameservers/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Federation - Run an App on Multiple Clusters">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Cross-cluster Service Discovery using Federated Services" href="/docs/tasks/federation/federation-service-discovery/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Kubefed 创建集群联邦" href="/docs/tasks/federation/set-up-cluster-federation-kubefed/"></a>
    
  

  

    

    
      <a class="item" data-title="Set up CoreDNS as DNS provider for Cluster Federation" href="/docs/tasks/federation/set-up-coredns-provider-federation/"></a>
    
  

  

    

    
      <a class="item" data-title="Set up placement policies in Federation" href="/docs/tasks/federation/set-up-placement-policies-federation/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated Cluster" href="/docs/tasks/administer-federation/cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated ConfigMap" href="/docs/tasks/administer-federation/configmap/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated DaemonSet" href="/docs/tasks/administer-federation/daemonset/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated Deployment" href="/docs/tasks/administer-federation/deployment/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated Events" href="/docs/tasks/administer-federation/events/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated Horizontal Pod Autoscalers (HPA)" href="/docs/tasks/administer-federation/hpa/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated Ingress" href="/docs/tasks/administer-federation/ingress/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated Jobs" href="/docs/tasks/administer-federation/job/"></a>
    
  

  

    

    
      <a class="item" data-title="联邦命名空间" href="/docs/tasks/administer-federation/namespaces/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated ReplicaSets" href="/docs/tasks/administer-federation/replicaset/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated Secrets" href="/docs/tasks/administer-federation/secret/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Manage Cluster Daemons">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Perform a Rolling Update on a DaemonSet" href="/docs/tasks/manage-daemon/update-daemon-set/"></a>
    
  

  

    

    
      <a class="item" data-title="对 DaemonSet 执行回滚" href="/docs/tasks/manage-daemon/rollback-daemon-set/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Manage GPUs">
      <div class="container">
        
  

    

    
      <a class="item" data-title="调度 GPU" href="/docs/tasks/manage-gpus/scheduling-gpus/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Manage HugePages">
      <div class="container">
        
  

    

    
      <a class="item" data-title="管理巨页（HugePages）" href="/docs/tasks/manage-hugepages/scheduling-hugepages/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Extend kubectl with plugins">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Extend kubectl with plugins" href="/docs/tasks/extend-kubectl/kubectl-plugins/"></a>
    
  


      </div>
    </div>
  


        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
  </div> <!-- /docsToc -->

  <div id="docsContent">
        <p><a href="/editdocs#docs/tasks/debug-application-cluster/audit.md" id="editPageButton">Edit This Page</a></p>

        
          <h1>Auditing</h1>
        

        <ul id="markdown-toc">
  <li><a href="#legacy-audit" id="markdown-toc-legacy-audit">Legacy Audit</a>    <ul>
      <li><a href="#configuration" id="markdown-toc-configuration">Configuration</a></li>
    </ul>
  </li>
  <li><a href="#advanced-audit" id="markdown-toc-advanced-audit">Advanced audit</a>    <ul>
      <li><a href="#audit-policy" id="markdown-toc-audit-policy">Audit Policy</a></li>
      <li><a href="#audit-backends" id="markdown-toc-audit-backends">Audit backends</a>        <ul>
          <li><a href="#log-backend" id="markdown-toc-log-backend">Log backend</a></li>
          <li><a href="#webhook-backend" id="markdown-toc-webhook-backend">Webhook backend</a></li>
        </ul>
      </li>
      <li><a href="#audit-id" id="markdown-toc-audit-id">Audit-Id</a></li>
      <li><a href="#log-collector-examples" id="markdown-toc-log-collector-examples">Log Collector Examples</a>        <ul>
          <li><a href="#use-fluentd-to-collect-and-distribute-audit-events-from-log-file" id="markdown-toc-use-fluentd-to-collect-and-distribute-audit-events-from-log-file">Use fluentd to collect and distribute audit events from log file</a></li>
          <li><a href="#use-logstash-to-collect-and-distribute-audit-events-from-webhook-backend" id="markdown-toc-use-logstash-to-collect-and-distribute-audit-events-from-webhook-backend">Use logstash to collect and distribute audit events from webhook backend</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>Kubernetes Audit provides a security-relevant chronological set of records documenting
the sequence of activities that have affected system by individual users, administrators
or other components of the system. It allows cluster administrator to
answer the following questions:</p>

<ul>
  <li>what happened?</li>
  <li>when did it happen?</li>
  <li>who initiated it?</li>
  <li>on what did it happen?</li>
  <li>where was it observed?</li>
  <li>from where was it initiated?</li>
  <li>to where was it going?</li>
</ul>

<h2 id="legacy-audit">Legacy Audit</h2>

<p>Kubernetes audit is part of <a href="/docs/admin/kube-apiserver">Kube-apiserver</a> logging all requests
processed by the server. Each audit log entry contains two lines:</p>

<ol>
  <li>The request line containing a unique ID to match the response and request metadata, such as the source IP, requesting user, impersonation information, resource being requested, etc.</li>
  <li>The response line containing a unique ID matching the request line and the response code.</li>
</ol>

<p>Example output for <code class="highlighter-rouge">admin</code> user listing pods in the <code class="highlighter-rouge">default</code> namespace:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2017-03-21T03:57:09.106841886-04:00 AUDIT: id="c939d2a7-1c37-4ef1-b2f7-4ba9b1e43b53" ip="127.0.0.1" method="GET" user="admin" groups="\"system:masters\",\"system:authenticated\"" as="&lt;self&gt;" asgroups="&lt;lookup&gt;" namespace="default" uri="/api/v1/namespaces/default/pods"
2017-03-21T03:57:09.108403639-04:00 AUDIT: id="c939d2a7-1c37-4ef1-b2f7-4ba9b1e43b53" response="200"
</code></pre></div></div>

<p>Note that Kubernetes 1.8 has switched to use the advanced structured audit log by default.
To fallback to this legacy audit, disable the advanced auditing feature
using the <code class="highlighter-rouge">AdvancedAuditing</code> feature gate on the <a href="/docs/admin/kube-apiserver">kube-apiserver</a>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--feature-gates=AdvancedAuditing=false
</code></pre></div></div>

<h3 id="configuration">Configuration</h3>

<p><a href="/docs/admin/kube-apiserver">Kube-apiserver</a> provides the following options which are responsible
for configuring where and how audit logs are handled:</p>

<ul>
  <li><code class="highlighter-rouge">audit-log-path</code> - enables the audit log pointing to a file where the requests are being logged to, ‘-‘ means standard out.</li>
  <li><code class="highlighter-rouge">audit-log-maxage</code> - specifies maximum number of days to retain old audit log files based on the timestamp encoded in their filename.</li>
  <li><code class="highlighter-rouge">audit-log-maxbackup</code> - specifies maximum number of old audit log files to retain.</li>
  <li><code class="highlighter-rouge">audit-log-maxsize</code> - specifies maximum size in megabytes of the audit log file before it gets rotated. Defaults to 100MB.</li>
</ul>

<p>If an audit log file already exists, Kubernetes appends new audit logs to that file.
Otherwise, Kubernetes creates an audit log file at the location you specified in
<code class="highlighter-rouge">audit-log-path</code>. If the audit log file exceeds the size you specify in <code class="highlighter-rouge">audit-log-maxsize</code>,
Kubernetes will rename the current log file by appending the current timestamp on
the file name (before the file extension) and create a new audit log file.
Kubernetes may delete old log files when creating a new log file; you can configure
how many files are retained and how old they can be by specifying the <code class="highlighter-rouge">audit-log-maxbackup</code>
and <code class="highlighter-rouge">audit-log-maxage</code> options.</p>

<h2 id="advanced-audit">Advanced audit</h2>

<p>Kubernetes 1.7 expands auditing with experimental functionality such as event
filtering and a webhook for integration with external systems. Kubernetes 1.8
upgrades the advanced audit feature to beta, and some backward incompatible changes
have been committed.</p>

<p><code class="highlighter-rouge">AdvancedAuditing</code> is customizable in two ways. Policy, which determines what’s recorded,
and backends, which persist records. Backend implementations include logs files and
webhooks.</p>

<p>The structure of audit events changes when enabling the <code class="highlighter-rouge">AdvancedAuditing</code> feature
flag. This includes some cleanups, such as the <code class="highlighter-rouge">method</code> reflecting the verb evaluated
by the <a href="/docs/admin/authorization/">authorization layer</a> instead of the <a href="/docs/admin/authorization/#determine-the-request-verb">HTTP verb</a>.
Also, instead of always generating two events per request, events are recorded with an associated “stage”.
The known stages are:</p>

<ul>
  <li><code class="highlighter-rouge">RequestReceived</code> - The stage for events generated as soon as the audit handler receives the request.</li>
  <li><code class="highlighter-rouge">ResponseStarted</code> - Once the response headers are sent, but before the response body is sent. This stage is only generated for long-running requests (e.g. watch).</li>
  <li><code class="highlighter-rouge">ResponseComplete</code> - Once the response body has been completed.</li>
  <li><code class="highlighter-rouge">Panic</code> - Events generated when a panic occurred.</li>
</ul>

<h3 id="audit-policy">Audit Policy</h3>

<p>Audit policy is a document defining rules about what events should be recorded.
The policy is passed to the <a href="/docs/admin/kube-apiserver">kube-apiserver</a> using the
<code class="highlighter-rouge">--audit-policy-file</code> flag.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--audit-policy-file=/etc/kubernetes/audit-policy.yaml
</code></pre></div></div>

<p>If <code class="highlighter-rouge">AdvancedAuditing</code> is enabled and this flag is omitted, no events are logged.</p>

<p>The policy file holds rules that determine the level of an event. Known audit levels are:</p>

<ul>
  <li><code class="highlighter-rouge">None</code> - don’t log events that match this rule.</li>
  <li><code class="highlighter-rouge">Metadata</code> - log request metadata (requesting user, timestamp, resource, verb, etc.) but not request or response body.</li>
  <li><code class="highlighter-rouge">Request</code> - log event metadata and request body but not response body.</li>
  <li><code class="highlighter-rouge">RequestResponse</code> - log event metadata, request and response bodies.</li>
</ul>

<p>When an event is processed, it’s compared against the list of rules in order.
The first matching rule sets the audit level of the event. The audit policy is
defined by the <a href="https://github.com/kubernetes/kubernetes/blob/v1.8.0-beta.1/staging/src/k8s.io/apiserver/pkg/apis/audit/v1beta1/types.go"><code class="highlighter-rouge">audit.k8s.io</code> API group</a>.
Some new fields are supported in beta version, like <code class="highlighter-rouge">resourceNames</code> and <code class="highlighter-rouge">omitStages</code>.</p>

<p>In Kubernetes 1.8 <code class="highlighter-rouge">kind</code> and <code class="highlighter-rouge">apiVersion</code> along with <code class="highlighter-rouge">rules</code> <strong>must</strong> be provided in
the audit policy file. A policy file with 0 rules, or a policy file that doesn’t provide
a valid <code class="highlighter-rouge">apiVersion</code> and <code class="highlighter-rouge">kind</code> value will be treated as illgal.</p>

<p>Some example audit policy files:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">audit.k8s.io/v1beta1</span>  <span class="c1">#this is required in Kubernetes 1.8</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Policy</span>
<span class="na">rules</span><span class="pi">:</span>
  <span class="c1"># Don't log watch requests by the "system:kube-proxy" on endpoints or services</span>
  <span class="pi">-</span> <span class="na">level</span><span class="pi">:</span> <span class="s">None</span>
    <span class="na">users</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">system:kube-proxy"</span><span class="pi">]</span>
    <span class="na">verbs</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">watch"</span><span class="pi">]</span>
    <span class="na">resources</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">group</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span> <span class="c1"># core API group</span>
      <span class="na">resources</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">endpoints"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">services"</span><span class="pi">]</span>

  <span class="c1"># Don't log authenticated requests to certain non-resource URL paths.</span>
  <span class="pi">-</span> <span class="na">level</span><span class="pi">:</span> <span class="s">None</span>
    <span class="na">userGroups</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">system:authenticated"</span><span class="pi">]</span>
    <span class="na">nonResourceURLs</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">/api*"</span> <span class="c1"># Wildcard matching.</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">/version"</span>

  <span class="c1"># Log the request body of configmap changes in kube-system.</span>
  <span class="pi">-</span> <span class="na">level</span><span class="pi">:</span> <span class="s">Request</span>
    <span class="na">resources</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">group</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span> <span class="c1"># core API group</span>
      <span class="na">resources</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">configmaps"</span><span class="pi">]</span>
    <span class="c1"># This rule only applies to resources in the "kube-system" namespace.</span>
    <span class="c1"># The empty string "" can be used to select non-namespaced resources.</span>
    <span class="na">namespaces</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">kube-system"</span><span class="pi">]</span>

  <span class="c1"># Log configmap and secret changes in all other namespaces at the Metadata level.</span>
  <span class="pi">-</span> <span class="na">level</span><span class="pi">:</span> <span class="s">Metadata</span>
    <span class="na">resources</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">group</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span> <span class="c1"># core API group</span>
      <span class="na">resources</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">secrets"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">configmaps"</span><span class="pi">]</span>

  <span class="c1"># Log all other resources in core and extensions at the Request level.</span>
  <span class="pi">-</span> <span class="na">level</span><span class="pi">:</span> <span class="s">Request</span>
    <span class="na">resources</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">group</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span> <span class="c1"># core API group</span>
    <span class="pi">-</span> <span class="na">group</span><span class="pi">:</span> <span class="s2">"</span><span class="s">extensions"</span> <span class="c1"># Version of group should NOT be included.</span>

  <span class="c1"># A catch-all rule to log all other requests at the Metadata level.</span>
  <span class="pi">-</span> <span class="na">level</span><span class="pi">:</span> <span class="s">Metadata</span>
</code></pre></div></div>

<p>The next audit policy file shows new features introduced in Kubernetes 1.8:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">audit.k8s.io/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Policy</span>
<span class="na">rules</span><span class="pi">:</span>
  <span class="c1"># Log pod changes at Request level</span>
  <span class="pi">-</span> <span class="na">level</span><span class="pi">:</span> <span class="s">Request</span>
    <span class="na">resources</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">group</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="c1"># Resource "pods" no longer matches requests to any subresource of pods,</span>
      <span class="c1"># This behavior is consistent with the RBAC policy.</span>
      <span class="na">resources</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">pods"</span><span class="pi">]</span>
  <span class="c1"># Log "pods/log", "pods/status" at Metadata level</span>
  <span class="pi">-</span> <span class="na">level</span><span class="pi">:</span> <span class="s">Metadata</span>
    <span class="na">resources</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">group</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">resources</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">pods/log"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">pods/status"</span><span class="pi">]</span>

  <span class="c1"># Don't log requests to a configmap called "controller-leader"</span>
  <span class="pi">-</span> <span class="na">level</span><span class="pi">:</span> <span class="s">None</span>
    <span class="na">resources</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">group</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">resources</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">configmaps"</span><span class="pi">]</span>
      <span class="na">resourceNames</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">controller-leader"</span><span class="pi">]</span>

  <span class="c1"># A catch-all rule to log all other requests at the Metadata level.</span>
  <span class="c1"># For this rule we use "omitStages" to omit events at "ReqeustReceived" stage.</span>
  <span class="c1"># Events in this stage will not be sent to backend.</span>
  <span class="pi">-</span> <span class="na">level</span><span class="pi">:</span> <span class="s">Metadata</span>
    <span class="na">omitStages</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">RequestReceived"</span>
</code></pre></div></div>

<p>You can use a minimal audit policy file to log all requests at the <code class="highlighter-rouge">Metadata</code> level:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Log all requests at the Metadata level.</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">audit.k8s.io/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Policy</span>
<span class="na">rules</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">level</span><span class="pi">:</span> <span class="s">Metadata</span>
</code></pre></div></div>

<p>The <a href="https://github.com/kubernetes/kubernetes/blob/v1.8.0-beta.0/cluster/gce/gci/configure-helper.sh#L532">audit profile used by GCE</a> should be used as reference by
admins constructing their own audit profiles.</p>

<h3 id="audit-backends">Audit backends</h3>

<p>Audit backends implement strategies for emitting events. The <a href="/docs/admin/kube-apiserver">kube-apiserver</a>
provides a logging and webhook backend.</p>

<p>Each request to the API server can generate multiple events, one when the request is received,
another when the response is sent, and additional events for long running requests (such as
watches). The ID of events will be the same if they were generated from the same request.</p>

<p>The event format is defined by the <code class="highlighter-rouge">audit.k8s.io</code> API group. The <code class="highlighter-rouge">v1alpha1</code> format of this
API can be found <a href="https://github.com/kubernetes/kubernetes/blob/v1.8.0-beta.1/staging/src/k8s.io/apiserver/pkg/apis/audit/v1beta1/types.go">here</a> with more details about the exact fields captured.</p>

<h4 id="log-backend">Log backend</h4>

<p>The behavior of the <code class="highlighter-rouge">--audit-log-path</code> flag changes when enabling the <code class="highlighter-rouge">AdvancedAuditing</code>
feature flag. All generated events defined by <code class="highlighter-rouge">--audit-policy-file</code> are recorded in structured
json format:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{"kind":"Event","apiVersion":"audit.k8s.io/v1beta1","metadata":{"creationTimestamp":null},"level":"Metadata","timestamp":"2017-09-05T10:04:55Z","auditID":"77e58433-d345-40ac-b2d8-9866bd355cea","stage":"RequestReceived","requestURI":"/apis/rbac.authorization.k8s.io/v1/namespaces/default/roles","verb":"list","user":{"username":"kubecfg","groups":["system:masters","system:authenticated"]},"sourceIPs":["172.16.116.128"],"objectRef":{"resource":"roles","namespace":"default","apiGroup":"rbac.authorization.k8s.io","apiVersion":"v1"}}
{"kind":"Event","apiVersion":"audit.k8s.io/v1beta1","metadata":{"creationTimestamp":null},"level":"Metadata","timestamp":"2017-09-05T10:04:55Z","auditID":"77e58433-d345-40ac-b2d8-9866bd355cea","stage":"ResponseComplete","requestURI":"/apis/rbac.authorization.k8s.io/v1/namespaces/default/roles","verb":"list","user":{"username":"kubecfg","groups":["system:masters","system:authenticated"]},"sourceIPs":["172.16.116.128"],"objectRef":{"resource":"roles","namespace":"default","apiGroup":"rbac.authorization.k8s.io","apiVersion":"v1"},"responseStatus":{"metadata":{},"code":200}}
</code></pre></div></div>

<p>In alpha version, objectRef.apiVersion holds both the api group and version.
In beta version these were break out into objectRef.apiGroup and objectRef.apiVersion.</p>

<p>Starting from Kubernetes 1.8, structured json format is used for log backend by default.
Use the following option to switch log to legacy format:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--audit-log-format=legacy
</code></pre></div></div>

<p>With legacy format, events are formatted as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2017-09-05T06:08:19.885328047-04:00 AUDIT: id="c28a95ad-f9dd-47e1-a617-b6dc152db95f" stage="RequestReceived" ip="172.16.116.128" method="list" user="kubecfg" groups="\"system:masters\",\"system:authenticated\"" as="&lt;self&gt;" asgroups="&lt;lookup&gt;" namespace="default" uri="/apis/rbac.authorization.k8s.io/v1/namespaces/default/roles" response="&lt;deferred&gt;"
2017-09-05T06:08:19.885328047-04:00 AUDIT: id="c28a95ad-f9dd-47e1-a617-b6dc152db95f" stage="ResponseComplete" ip="172.16.116.128" method="list" user="kubecfg" groups="\"system:masters\",\"system:authenticated\"" as="&lt;self&gt;" asgroups="&lt;lookup&gt;" namespace="default" uri="/apis/rbac.authorization.k8s.io/v1/namespaces/default/roles" response="200"
</code></pre></div></div>

<p>Logged events omit the request and response bodies. The <code class="highlighter-rouge">Request</code> and
<code class="highlighter-rouge">RequestResponse</code> levels are equivalent to <code class="highlighter-rouge">Metadata</code> for legacy format. This legacy format
of advanced audit is different from the <a href="# Legacy Audit">Legacy Audit</a> discussed above, such
as changes to the method values and the introduction of a “stage” for each event.</p>

<h4 id="webhook-backend">Webhook backend</h4>

<p>The audit webhook backend can be used to have <a href="/docs/admin/kube-apiserver">kube-apiserver</a>
send audit events to a remote service. The webhook requires the <code class="highlighter-rouge">AdvancedAuditing</code>
feature flag and is configured using the following command line flags:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--audit-webhook-config-file=/etc/kubernetes/audit-webhook-kubeconfig
--audit-webhook-mode=batch
</code></pre></div></div>

<p><code class="highlighter-rouge">audit-webhook-mode</code> controls buffering strategies used by the webhook. Known modes are:</p>

<ul>
  <li><code class="highlighter-rouge">batch</code> - buffer events and asynchronously send the set of events to the external service.</li>
  <li><code class="highlighter-rouge">blocking</code> - block API server responses on sending each event to the external service.</li>
</ul>

<p>The webhook config file uses the kubeconfig format to specify the remote address of
the service and credentials used to connect to it.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># clusters refers to the remote service.
clusters:
  - name: name-of-remote-audit-service
    cluster:
      certificate-authority: /path/to/ca.pem  # CA for verifying the remote service.
      server: https://audit.example.com/audit # URL of remote service to query. Must use 'https'.

# users refers to the API server's webhook configuration.
users:
  - name: name-of-api-server
    user:
      client-certificate: /path/to/cert.pem # cert for the webhook plugin to use
      client-key: /path/to/key.pem          # key matching the cert

# kubeconfig files require a context. Provide one for the API server.
current-context: webhook
contexts:
- context:
    cluster: name-of-remote-audit-service
    user: name-of-api-sever
  name: webhook
</code></pre></div></div>

<p>Events are POSTed as a JSON serialized <code class="highlighter-rouge">EventList</code>. An example payload:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"apiVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"audit.k8s.io/v1beta1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"auditID"</span><span class="p">:</span><span class="w"> </span><span class="s2">"24f30caf-d7d4-45d5-b7bd-e7af300d7886"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"level"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Metadata"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"creationTimestamp"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"objectRef"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"apiGroup"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rbac.authorization.k8s.io"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"apiVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"v1"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"jane"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"namespace"</span><span class="p">:</span><span class="w"> </span><span class="s2">"default"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"roles"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"requestURI"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/apis/rbac.authorization.k8s.io/v1/namespaces/default/roles/jane"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"responseStatus"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
                </span><span class="s2">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"sourceIPs"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"172.16.116.128"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="s2">"stage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ResponseComplete"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-09-05T10:20:24Z"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"user"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"groups"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"system:masters"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"system:authenticated"</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="s2">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"kubecfg"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"verb"</span><span class="p">:</span><span class="w"> </span><span class="s2">"get"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EventList"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="audit-id">Audit-Id</h3>

<p>Audit-Id is a unique ID for each http request to kube-apiserver. The ID of events will be the
same if they were generated from the same request. Starting from Kubernetes 1.8, if an audit
event is generated for the request, kube-apiserver will respond with an Audit-Id in the HTTP header.
Note that for some special requests like <code class="highlighter-rouge">kubectl exec</code>, <code class="highlighter-rouge">kubectl attach</code>, kube-apiserver works
like a proxy, no Audit-Id will be returned even if audit events are recorded.</p>

<h3 id="log-collector-examples">Log Collector Examples</h3>

<h4 id="use-fluentd-to-collect-and-distribute-audit-events-from-log-file">Use fluentd to collect and distribute audit events from log file</h4>

<p><a href="http://www.fluentd.org/">Fluentd</a> is an open source data collector for unified logging layer.
In this example, we will use fluentd to split audit events by different namespaces.
Note that this example requries json format output support in Kubernetes 1.8.</p>

<ol>
  <li>install <a href="http://docs.fluentd.org/v0.12/articles/quickstart#step1-installing-fluentd">fluentd, fluent-plugin-forest and fluent-plugin-rewrite-tag-filter</a> in the kube-apiserver node</li>
  <li>
    <p>create a config file for fluentd</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   $ cat &lt;&lt;EOF &gt; /etc/fluentd/config
   # fluentd conf runs in the same host with kube-apiserver
   &lt;source&gt;
       @type tail
       # audit log path of kube-apiserver
       path /var/log/audit
       pos_file /var/log/audit.pos
       format json
       time_key time
       time_format %Y-%m-%dT%H:%M:%S.%N%z
       tag audit
   &lt;/source&gt;
      
   &lt;filter audit&gt;
       #https://github.com/fluent/fluent-plugin-rewrite-tag-filter/issues/13
       type record_transformer
       enable_ruby
       &lt;record&gt;
       	namespace ${record["objectRef"].nil? ? "none":(record["objectRef"]["namespace"].nil? ?  "none":record["objectRef"]["namespace"])}
       &lt;/record&gt;
   &lt;/filter&gt;
      
   &lt;match audit&gt;
       # route audit according to namespace element in context
       @type rewrite_tag_filter
       rewriterule1 namespace ^(.+) ${tag}.$1
   &lt;/match&gt;
      
   &lt;filter audit.**&gt;
   	  @type record_transformer
   	  remove_keys namespace
   &lt;/filter&gt;
      
   &lt;match audit.**&gt;
       @type forest
       subtype file
       remove_prefix audit
       &lt;template&gt;
           time_slice_format %Y%m%d%H
           compress gz
           path /var/log/audit-${tag}.*.log
           format json
           include_time_key true
       &lt;/template&gt;
   &lt;/match&gt;
</code></pre></div>    </div>
  </li>
  <li>
    <p>start fluentd</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   $ fluentd -c /etc/fluentd/config  -vv
</code></pre></div>    </div>
  </li>
  <li>
    <p>start kube-apiserver with the following options:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   --audit-policy-file=/etc/kubernetes/audit-policy.yaml --audit-log-path=/var/log/kube-audit --audit-log-format=json
</code></pre></div>    </div>
  </li>
  <li>check audits for different namespaces in /var/log/audit-*.log</li>
</ol>

<h4 id="use-logstash-to-collect-and-distribute-audit-events-from-webhook-backend">Use logstash to collect and distribute audit events from webhook backend</h4>

<p><a href="https://www.elastic.co/products/logstash">Logstash</a> is an open source, server-side data processing tool. In this example,
we will use logstash to collect audit events from webhook backend, and save events of
different users into different files.</p>

<ol>
  <li>install <a href="https://www.elastic.co/guide/en/logstash/current/installing-logstash.html">logstash</a></li>
  <li>
    <p>create config file for logstash</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   $ cat &lt;&lt;EOF &gt; /etc/logstash/config
   input{
       http{
           #TODO, figure out a way to use kubeconfig file to authenticate to logstash
           #https://www.elastic.co/guide/en/logstash/current/plugins-inputs-http.html#plugins-inputs-http-ssl
           port=&gt;8888
       }
   }
   filter{
       split{
           # Webhook audit backend sends several events together with EventList
           # split each event here.
           field=&gt;[items]
           # We only need event subelement, remove others.
           remove_field=&gt;[headers, metadata, apiVersion, "@timestamp", kind, "@version", host]
       }
       mutate{
           rename =&gt; {items=&gt;event}
       }
   }
   output{
       file{
           # Audit events from different users will be saved into different files.
           path=&gt;"/var/log/kube-audit-%{[event][user][username]}/audit"
       }
   }
</code></pre></div>    </div>
  </li>
  <li>
    <p>start logstash</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   $ bin/logstash -f /etc/logstash/config --path.settings /etc/logstash/
</code></pre></div>    </div>
  </li>
  <li>
    <p>create a <a href="/docs/tasks/access-application-cluster/authenticate-across-clusters-kubeconfig/">kubeconfig file</a> for kube-apiserver webhook audit backend</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   $ cat &lt;&lt;EOF &gt; /etc/kubernetes/audit-webhook-kubeconfig
   apiVersion: v1
   clusters:
   - cluster:
       server: http://&lt;ip_of_logstash&gt;:8888
     name: logstash
   contexts:
   - context:
       cluster: logstash
       user: ""
     name: default-context
   current-context: default-context
   kind: Config
   preferences: {}
   users: []
   EOF
</code></pre></div>    </div>
  </li>
  <li>
    <p>start kube-apiserver with the following options:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   --audit-policy-file=/etc/kubernetes/audit-policy.yaml --audit-webhook-config-file=/etc/kubernetes/audit-webhook-kubeconfig
</code></pre></div>    </div>
  </li>
  <li>check audits in logstash node’s directories /var/log/kube-audit-*/audit</li>
</ol>

<p>Note that in addition to file output plugin, logstash has a variety of outputs that
let users route data where they want. For example, users can emit audit events to elasticsearch
plugin which supports full-text search and analytics.</p>



        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/tasks/debug-application-cluster/audit.md?pixel" alt="Analytics" /></a></p>
        
	
        <script type="text/javascript">
            PDRTJS_settings_8345992 = {
                "id" : "8345992",
                "unique_id" : "/docs/tasks/debug-application-cluster/audit/",
                "title" : "Auditing",
                "permalink" : "http://kubernetes.github.io/docs/tasks/debug-application-cluster/audit/"
            };
            (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
        <a href="" onclick="window.open('https://github.com/kubernetes/kubernetes.github.io/issues/new?title=Issue%20with%20' +
        'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
	
        
          <a href="/editdocs#docs/tasks/debug-application-cluster/audit.md" class="button issue">Edit this Page</a>
        
    
    </div>
</section>

<footer>
    <main class="light-text">
        <nav>
            <a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a>
            <a href="/docs/home/">Documentation</a>
            <a href="http://blog.kubernetes.io/">Blog</a>
            <a href="/partners/">Partners</a>
            <a href="/community/">Community</a>
            <a href="/case-studies/">Case Studies</a>
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                <a href="/docs/setup/pick-right-solution/" class="button">Get Kubernetes</a>
                <a href="https://github.com/kubernetes/kubernetes" class="button">Contribute</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2017 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2017 The Linux Foundation&reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our Trademark Usage page: <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">https://www.linuxfoundation.org/trademark-usage</a>
        </div>
    </main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
.cse .gsc-control-cse, .gsc-control-cse, {
    padding: 0;
}
  .gsc-control-cse table, .gsc-control-cse-en table {
      margin:0px !important;
  }
  .gsc-above-wrapper-area {
      border-bottom: 0;
  }
</style>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36037335-10', 'auto');
ga('send', 'pageview');

// hide docs nav area if no nav is present, or if nav only contains a link to the current page
(function () {
    window.addEventListener('DOMContentLoaded', init)

        // play nice with our neighbors
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
            var container = toc.querySelector('.container')

                // container is built dynamically, so it may not be present on the first runloop
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>

<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
    <!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->


</body>
</html>
