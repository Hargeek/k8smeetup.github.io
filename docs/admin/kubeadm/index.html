
  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  


<!Doctype html>
<html id="docs" class="">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono">
    <link rel="stylesheet" type="text/css" href="/css/styles.css"><!-- default styles.css on -->
    <link rel="stylesheet" type="text/css" href="/css/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="/css/sweetalert.css">
    <link rel="stylesheet" type="text/css" href="/css/callouts.css">
    <link rel="stylesheet" type="text/css" href="/css/custom-jekyll/tags.css">
    
    
    <!-- no custom css detected -->

    
    <meta name="description" content="kubeadm Setup Tool Reference Guide" />
    

    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/jquery-ui.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/sweetalert.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/custom-jekyll/tags.js"></script>
    <!-- Begin Jekyll SEO tag v2.3.0 -->
<title>kubeadm Setup Tool Reference Guide | Kubernetes</title>
<meta property="og:title" content="kubeadm Setup Tool Reference Guide" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Production-Grade Container Orchestration" />
<meta property="og:description" content="Production-Grade Container Orchestration" />
<link rel="canonical" href="http://0.0.0.0:4000/docs/admin/kubeadm/" />
<meta property="og:url" content="http://0.0.0.0:4000/docs/admin/kubeadm/" />
<meta property="og:site_name" content="Kubernetes" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@kubernetesio" />
<script type="application/ld+json">
{"name":null,"description":"Production-Grade Container Orchestration","author":null,"@type":"WebPage","url":"http://0.0.0.0:4000/docs/admin/kubeadm/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/images/favicon.png"}},"image":null,"headline":"kubeadm Setup Tool Reference Guide","dateModified":null,"datePublished":null,"sameAs":null,"mainEntityOfPage":null,"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>

<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            <li><a href="/docs/home/">Documentation</a></li>
            <li><a href="http://blog.kubernetes.io/">Blog</a></li>
            <li><a href="/partners/">Partners</a></li>
            <li><a href="/community/">Community</a></li>
            <li><a href="/case-studies/">Case Studies</a></li>
            <li>
                <a href="#">
                    v1.8 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                  <li><a href="https://kubernetes.io/docs/home/">v1.8</a></li>
                
                  <li><a href="https://v1-7.docs.kubernetes.io/docs/home/">v1.7</a></li>
                
                  <li><a href="https://v1-6.docs.kubernetes.io/docs/home/">v1.6</a></li>
                
                  <li><a href="https://v1-5.docs.kubernetes.io/docs/">v1.5</a></li>
                
                  <li><a href="https://v1-4.docs.kubernetes.io/docs/">v1.4</a></li>
                
                </ul>
              </li>
            </li>
        </ul>
        <!-- <a href="/docs/home" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a> -->
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
        <div class="nav-box">
            <h3><a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a></h3>
            <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
            <p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
        </div>
        <div class="nav-box">
            <h3><a href="/community/">Community</a></h3>
            <p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
        </div>
        <div class="nav-box">
            <h3><a href="http://blog.kubernetes.io">Blog</a></h3>
            <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
        </div>
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1></h1>
  <h5></h5>
  <div id="vendorStrip" class="light-text">
    <ul>
      <li><a href="/docs/home/" >HOME</a></li>
      <li><a href="/docs/setup/" >SETUP</a></li>
      <li><a href="/docs/concepts/" >CONCEPTS</a></li>
      <li><a href="/docs/tasks/" >TASKS</a></li>
      <li><a href="/docs/tutorials/" >TUTORIALS</a></li>
      <li><a href="/docs/reference/" >REFERENCE</a></li>
    </ul>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)" autofocus="autofocus">
    </div>
  </div>
</section>




<section id="encyclopedia">
  <div id="docsToc">
        <div class="pi-accordion">
          
  

    

    
      <a class="item" data-title="Search Results" href="/docs/search/"></a>
    
  


        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
  </div> <!-- /docsToc -->

  <div id="docsContent">
        <p><a href="/editdocs#docs/admin/kubeadm.md" id="editPageButton">Edit This Page</a></p>

        
          <h1>kubeadm Setup Tool Reference Guide</h1>
        

        <p>This document provides information on how to use kubeadm’s advanced options.</p>

<p>Running <code class="highlighter-rouge">kubeadm init</code> bootstraps a Kubernetes cluster. This consists of the
following steps:</p>

<ol>
  <li>
    <p>kubeadm runs a series of pre-flight checks to validate the system state
before making changes. Some checks only trigger warnings, others are
considered errors and will exit kubeadm until the problem is corrected or the
user specifies <code class="highlighter-rouge">--skip-preflight-checks</code>.</p>
  </li>
  <li>
    <p>kubeadm generates a token that additional nodes can use to register
themselves with the master in future.  Optionally, the user can provide a
token.</p>
  </li>
  <li>
    <p>kubeadm generates a self-signed CA to provision identities for each component
(including nodes) in the cluster.  It also generates client certificates to
be used by various components.  If the user has provided their own CA by
dropping it in the cert directory (configured via <code class="highlighter-rouge">--cert-dir</code>, by default
<code class="highlighter-rouge">/etc/kubernetes/pki</code>), this step is skipped.</p>
  </li>
  <li>
    <p>Outputting a kubeconfig file for the kubelet to use to connect to the API
server, as well as an additional kubeconfig file for administration.</p>
  </li>
  <li>
    <p>kubeadm generates Kubernetes static Pod manifests for the API server,
controller manager and scheduler.  It places them in
<code class="highlighter-rouge">/etc/kubernetes/manifests</code>. The kubelet watches this directory for Pods to
create on startup. These are the core components of Kubernetes. Once they are
up and running kubeadm can set up and manage any additional components.</p>
  </li>
  <li>
    <p>kubeadm “taints” the master node so that only control plane components will
run there.  It also sets up the RBAC authorization system and writes a
special ConfigMap that is used to bootstrap trust with the kubelets.</p>
  </li>
  <li>
    <p>kubeadm installs add-on components via the API server.  Right now this is
the internal DNS server and the kube-proxy DaemonSet.</p>
  </li>
</ol>

<p>Running <code class="highlighter-rouge">kubeadm join</code> on each node in the cluster consists of the following
steps:</p>

<ol>
  <li>
    <p>kubeadm downloads root CA information from the API server.  It uses the token
to verify the authenticity of that data.</p>
  </li>
  <li>
    <p>kubeadm creates a local key pair.  It prepares a certificate signing request
(CSR) and sends that off to the API server for signing.  The bootstrap token
is used to authenticate.  The control plane will sign this CSR requested
automatically.</p>
  </li>
  <li>
    <p>kubeadm configures the local kubelet to connect to the API server</p>
  </li>
</ol>

<h2 id="usage">Usage</h2>

<p>Fields that support multiple values do so either with comma separation, or by
specifying the flag multiple times.</p>

<p>The kubeadm command line interface is currently in <strong>beta</strong>.  We are aiming to
not break any scripted use of the main <code class="highlighter-rouge">kubeadm init</code> and <code class="highlighter-rouge">kubeadm join</code>.  The
single exception here is the format of the kubeadm config file as detailed
below.  That format is still considered alpha and may change.</p>

<h3 id="kubeadm-init"><code class="highlighter-rouge">kubeadm init</code></h3>

<p>It is usually sufficient to run <code class="highlighter-rouge">kubeadm init</code> without any flags, but in some
cases you might like to override the default behaviour. Here we specify all the
flags that can be used to customise the Kubernetes installation.</p>

<ul>
  <li><code class="highlighter-rouge">--apiserver-advertise-address</code></li>
</ul>

<p>This is the address the API Server will advertise to other members of the
cluster.  This is also the address used to construct the suggested <code class="highlighter-rouge">kubeadm
join</code> line at the end of the init process.  If not set (or set to 0.0.0.0) then
IP for the default interface will be used.</p>

<p>This address is also added to the certifcate that the API Server uses.</p>

<ul>
  <li><code class="highlighter-rouge">--apiserver-bind-port</code></li>
</ul>

<p>The port that the API server will bind on.  This defaults to 6443.</p>

<ul>
  <li><code class="highlighter-rouge">--apiserver-cert-extra-sans</code></li>
</ul>

<p>Additional hostnames or IP addresses that should be added to the Subject
Alternate Name section for the certificate that the API Server will use.  If you
expose the API Server through a load balancer and public DNS you could specify
this with</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--apiserver-cert-extra-sans=kubernetes.example.com,kube.example.com,10.100.245.1
</code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">--cert-dir</code></li>
</ul>

<p>The path where to save and store the certificates.  The default is
“/etc/kubernetes/pki”.</p>

<ul>
  <li><code class="highlighter-rouge">--config</code></li>
</ul>

<p>A kubeadm specific <a href="#config-file">config file</a>.  This can be used to specify an
extended set of options including passing arbitrary command line flags to the
control plane components.</p>

<p><strong>Note</strong>: When providing configuration values using <em>both</em> a configuration file
and flags, the file will take precedence. For example, if a file exists with:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubeadm.k8s.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">MasterConfiguration</span>
<span class="na">token</span><span class="pi">:</span> <span class="s">1234</span>
</code></pre></div></div>

<p>and the user ran <code class="highlighter-rouge">kubeadm init --config file.yaml --token 5678</code>,
the chosen token value will be <code class="highlighter-rouge">1234</code>.</p>

<ul>
  <li><code class="highlighter-rouge">--kubernetes-version</code> (default ‘latest’) the kubernetes version to initialise</li>
</ul>

<p>The <strong>v1.6</strong> version of kubeadm only supports building clusters that are at
least <strong>v1.6.0</strong>.  There are many reasons for this including kubeadm’s use of
RBAC, the Bootstrap Token system, and enhancements to the Certificates API. With
this flag you can try any future version of Kubernetes.  Check <a href="https://github.com/kubernetes/kubernetes/releases">releases
page</a> for a full list of
available versions.</p>

<ul>
  <li><code class="highlighter-rouge">--pod-network-cidr</code></li>
</ul>

<p>For certain networking solutions the Kubernetes master can also play a role in
allocating network ranges (CIDRs) to each node. This includes many cloud
providers and flannel. You can specify a subnet range that will be broken down
and handed out to each node with the <code class="highlighter-rouge">--pod-network-cidr</code> flag. This should be a
minimum of a /16 so controller-manager is able to assign /24 subnets to each
node in the cluster. If you are using flannel with <a href="https://github.com/coreos/flannel/blob/master/Documentation/kube-flannel.yml">this
manifest</a>
you should use <code class="highlighter-rouge">--pod-network-cidr=10.244.0.0/16</code>. Most CNI based networking
solutions do not require this flag.</p>

<ul>
  <li><code class="highlighter-rouge">--service-cidr</code> (default ‘10.96.0.0/12’)</li>
</ul>

<p>You can use the <code class="highlighter-rouge">--service-cidr</code> flag to override the subnet Kubernetes uses to
assign pods IP addresses. If you do, you will also need to update the
<code class="highlighter-rouge">/etc/systemd/system/kubelet.service.d/10-kubeadm.conf</code> file to reflect this
change else DNS will not function correctly.</p>

<ul>
  <li><code class="highlighter-rouge">--service-dns-domain</code> (default ‘cluster.local’)</li>
</ul>

<p>By default, <code class="highlighter-rouge">kubeadm init</code> deploys a cluster that assigns services with DNS
names <code class="highlighter-rouge">&lt;service_name&gt;.&lt;namespace&gt;.svc.cluster.local</code>. You can use the
<code class="highlighter-rouge">--service-dns-domain</code> to change the DNS name suffix. Again, you will need to
update the <code class="highlighter-rouge">/etc/systemd/system/kubelet.service.d/10-kubeadm.conf</code> file
accordingly else DNS will not function correctly.</p>

<p><strong>Note</strong>: This flag has an effect (it’s needed for the kube-dns Deployment
manifest and the API Server’s serving certificate) but not as you might expect,
since you will have to modify the arguments to the kubelets in the cluster for
it to work fully. Specifying DNS parameters using this flag only is not enough.
Rewriting the kubelet’s CLI arguments is out of scope for kubeadm as it should
be agnostic to how you run the kubelet. However, making all kubelets in the
cluster pick up information dynamically via the API <em>is</em> in scope and is a
<a href="https://github.com/kubernetes/kubeadm/issues/28">planned feature</a> for upcoming
releases.</p>

<ul>
  <li><code class="highlighter-rouge">--skip-preflight-checks</code></li>
</ul>

<p>By default, kubeadm runs a series of preflight checks to validate the system
before making any changes. Advanced users can use this flag to bypass these if
necessary.</p>

<ul>
  <li><code class="highlighter-rouge">--token</code></li>
</ul>

<p>By default, <code class="highlighter-rouge">kubeadm init</code> automatically generates the token used to initialise
each new node. If you would like to manually specify this token, you can use the
<code class="highlighter-rouge">--token</code> flag. The token must be of the format <code class="highlighter-rouge">[a-z0-9]{6}\.[a-z0-9]{16}</code>.  A
compatible random token can be generated <code class="highlighter-rouge">kubeadm token generate</code>.  Tokens can
be managed through the API after the cluster is created.  See the <a href="#manage-tokens">section on
managing tokens</a> below.</p>

<ul>
  <li><code class="highlighter-rouge">--token-ttl</code></li>
</ul>

<p>This sets an expiration time for the token.  This is specified as a duration
from the current time.  After this time the token will no longer be valid and
will be removed. A value of 0 specifies that the token never expires.  0 is the
default.  See the <a href="#manage-tokens">section on managing tokens</a> below.</p>

<h3 id="kubeadm-join"><code class="highlighter-rouge">kubeadm join</code></h3>

<p>When joining a kubeadm initialized cluster, we need to establish bidirectional
trust. This is split into discovery (having the Node trust the Kubernetes
master) and TLS bootstrap (having the Kubernetes master trust the Node).</p>

<p>There are 2 main schemes for discovery. The first is to use a shared token along
with the IP address of the API server. The second is to provide a file (a subset
of the standard kubeconfig file). This file can be a local file or downloaded
via an HTTPS URL. The forms are <code class="highlighter-rouge">kubeadm join --discovery-token
abcdef.1234567890abcdef 1.2.3.4:6443</code>, <code class="highlighter-rouge">kubeadm join --discovery-file
path/to/file.conf</code> or <code class="highlighter-rouge">kubeadm join --discovery-file https://url/file.conf</code>.
Only one form can be used. If the discovery information is loaded from a URL,
HTTPS must be used and the host installed CA bundle is used to verify the
connection.</p>

<p>The TLS bootstrap mechanism is also driven via a shared token. This is used to
temporarily authenticate with the Kubernetes master to submit a certificate
signing request (CSR) for a locally created key pair. By default kubeadm will
set up the Kubernetes master to automatically approve these signing requests.
This token is passed in with the <code class="highlighter-rouge">--tls-bootstrap-token abcdef.1234567890abcdef</code>
flag.</p>

<p>Often times the same token is use for both parts. In this case, the <code class="highlighter-rouge">--token</code> flag
can be used instead of specifying the each token individually.</p>

<p>Here’s an example on how to use it:</p>

<p><code class="highlighter-rouge">kubeadm join --token=abcdef.1234567890abcdef 192.168.1.1:6443</code></p>

<p>Specific options:</p>

<ul>
  <li><code class="highlighter-rouge">--config</code></li>
</ul>

<p>Extended options a specified in the <a href="#config-file">kubeadm specific config file</a>.</p>

<ul>
  <li><code class="highlighter-rouge">--skip-preflight-checks</code></li>
</ul>

<p>By default, kubeadm runs a series of preflight checks to validate the system
before making any changes. Advanced users can use this flag to bypass these if
necessary.</p>

<ul>
  <li><code class="highlighter-rouge">--discovery-file</code></li>
</ul>

<p>A local file path or HTTPS URL.  The file specified must be a kubeconfig file
with nothing but an unnamed cluster entry.  This is used to find both the
location of the API server to join along with a root CA bundle to use when
talking to that server.</p>

<p>This might look something like this:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">clusters</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">cluster</span><span class="pi">:</span>
    <span class="na">certificate-authority-data</span><span class="pi">:</span> <span class="s">&lt;really long certificate data&gt;</span>
    <span class="na">server</span><span class="pi">:</span> <span class="s">https://10.138.0.2:6443</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
<span class="na">contexts</span><span class="pi">:</span> <span class="pi">[]</span>
<span class="na">current-context</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Config</span>
<span class="na">preferences</span><span class="pi">:</span> <span class="pi">{}</span>
<span class="na">users</span><span class="pi">:</span> <span class="pi">[]</span>
</code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">--discovery-token</code></li>
</ul>

<p>The discovery token is used along with the address of the API server (as an
unnamed argument) to download and verify information about the cluster.  The
most critical part of the cluster information is the root CA bundle used to
verify the identity of the server during subsequent TLS connections.</p>

<ul>
  <li><code class="highlighter-rouge">--tls-bootstrap-token</code></li>
</ul>

<p>The token used to authenticate to the API server for the purposes of TLS
bootstrapping.</p>

<ul>
  <li><code class="highlighter-rouge">--token=&lt;token&gt;</code></li>
</ul>

<p>Often times the same token is used for both <code class="highlighter-rouge">--discovery-token</code> and
<code class="highlighter-rouge">--tls-bootstrap-token</code>.  This option specifies the same token for both.  Other
flags override this flag if present.</p>

<h2 id="config-file">Using kubeadm with a configuration file</h2>

<p><strong>WARNING:</strong> While kubeadm command line interface is in beta, the config file is
still considered alpha and may change in future versions.</p>

<p>It’s possible to configure kubeadm with a configuration file instead of command
line flags, and some more advanced features may only be available as
configuration file options.  This file is passed in to the <code class="highlighter-rouge">--config</code> option on
both <code class="highlighter-rouge">kubeadm init</code> and <code class="highlighter-rouge">kubeadm join</code>.</p>

<h3 id="sample-master-configuration">Sample Master Configuration</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubeadm.k8s.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">MasterConfiguration</span>
<span class="na">api</span><span class="pi">:</span>
  <span class="na">advertiseAddress</span><span class="pi">:</span> <span class="s">&lt;address|string&gt;</span>
  <span class="na">bindPort</span><span class="pi">:</span> <span class="s">&lt;int&gt;</span>
<span class="na">etcd</span><span class="pi">:</span>
  <span class="na">endpoints</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">&lt;endpoint1|string&gt;</span>
  <span class="pi">-</span> <span class="s">&lt;endpoint2|string&gt;</span>
  <span class="na">caFile</span><span class="pi">:</span> <span class="s">&lt;path|string&gt;</span>
  <span class="na">certFile</span><span class="pi">:</span> <span class="s">&lt;path|string&gt;</span>
  <span class="na">keyFile</span><span class="pi">:</span> <span class="s">&lt;path|string&gt;</span>
<span class="na">networking</span><span class="pi">:</span>
  <span class="na">dnsDomain</span><span class="pi">:</span> <span class="s">&lt;string&gt;</span>
  <span class="na">serviceSubnet</span><span class="pi">:</span> <span class="s">&lt;cidr&gt;</span>
  <span class="na">podSubnet</span><span class="pi">:</span> <span class="s">&lt;cidr&gt;</span>
<span class="na">kubernetesVersion</span><span class="pi">:</span> <span class="s">&lt;string&gt;</span>
<span class="na">cloudProvider</span><span class="pi">:</span> <span class="s">&lt;string&gt;</span>
<span class="na">authorizationModes</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">&lt;authorizationMode1|string&gt;</span>
<span class="pi">-</span> <span class="s">&lt;authorizationMode2|string&gt;</span>
<span class="na">token</span><span class="pi">:</span> <span class="s">&lt;string&gt;</span>
<span class="na">tokenTTL</span><span class="pi">:</span> <span class="s">&lt;time duration&gt;</span>
<span class="na">selfHosted</span><span class="pi">:</span> <span class="s">&lt;bool&gt;</span>
<span class="na">apiServerExtraArgs</span><span class="pi">:</span>
  <span class="s">&lt;argument&gt;</span><span class="pi">:</span> <span class="s">&lt;value|string&gt;</span>
  <span class="s">&lt;argument&gt;</span><span class="pi">:</span> <span class="s">&lt;value|string&gt;</span>
<span class="na">controllerManagerExtraArgs</span><span class="pi">:</span>
  <span class="s">&lt;argument&gt;</span><span class="pi">:</span> <span class="s">&lt;value|string&gt;</span>
  <span class="s">&lt;argument&gt;</span><span class="pi">:</span> <span class="s">&lt;value|string&gt;</span>
<span class="na">schedulerExtraArgs</span><span class="pi">:</span>
  <span class="s">&lt;argument&gt;</span><span class="pi">:</span> <span class="s">&lt;value|string&gt;</span>
  <span class="s">&lt;argument&gt;</span><span class="pi">:</span> <span class="s">&lt;value|string&gt;</span>
<span class="na">apiServerCertSANs</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">&lt;name1|string&gt;</span>
<span class="pi">-</span> <span class="s">&lt;name2|string&gt;</span>
<span class="na">certificatesDir</span><span class="pi">:</span> <span class="s">&lt;string&gt;</span>
</code></pre></div></div>
<p>In addition, if authorizationMode is set to <code class="highlighter-rouge">ABAC</code>, you should write the config to <code class="highlighter-rouge">/etc/kubernetes/abac_policy.json</code>.
However, if authorizationMode is set to <code class="highlighter-rouge">Webhook</code>, you should write the config to <code class="highlighter-rouge">/etc/kubernetes/webhook_authz.conf</code>.</p>

<h3 id="sample-node-configuration">Sample Node Configuration</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubeadm.k8s.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NodeConfiguration</span>
<span class="na">caCertPath</span><span class="pi">:</span> <span class="s">&lt;path|string&gt;</span>
<span class="na">discoveryFile</span><span class="pi">:</span> <span class="s">&lt;path|string&gt;</span>
<span class="na">discoveryToken</span><span class="pi">:</span> <span class="s">&lt;string&gt;</span>
<span class="na">discoveryTokenAPIServers</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">&lt;address|string&gt;</span>
<span class="pi">-</span> <span class="s">&lt;address|string&gt;</span>
<span class="na">tlsBootstrapToken</span><span class="pi">:</span> <span class="s">&lt;string&gt;</span>
</code></pre></div></div>

<h2 id="securing-your-installation-even-more">Securing your installation even more</h2>

<p>The defaults for kubeadm may not work for everyone. This section documents how to tighten up a kubeadm install
at the cost of some usability.</p>

<h3 id="turning-off-auto-approval-of-node-client-certificates">Turning off auto-approval of Node Client Certificates</h3>

<p>By default, there is an CSR auto-approver enabled that basically approves any client certificate request
for a kubelet when a Bootstrap Token was used when authenticating. If you don’t want the cluster to
automatically approve kubelet client certs, you can turn it off by executing this command:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> kubectl delete clusterrole kubeadm:node-autoapprove-bootstrap
</code></pre></div></div>

<p>After that, <code class="highlighter-rouge">kubeadm join</code> will block until the admin has manually approved the CSR in flight:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> kubectl get csr
<span class="go">NAME                                                   AGE       REQUESTOR                 CONDITION
node-csr-c69HXe7aYcqkS1bKmH4faEnHAWxn6i2bHZ2mD04jZyQ   18s       system:bootstrap:878f07   Pending

</span><span class="gp">$</span> kubectl certificate approve node-csr-c69HXe7aYcqkS1bKmH4faEnHAWxn6i2bHZ2mD04jZyQ
<span class="go">certificatesigningrequest "node-csr-c69HXe7aYcqkS1bKmH4faEnHAWxn6i2bHZ2mD04jZyQ" approved

</span><span class="gp">$</span> kubectl get csr
<span class="go">NAME                                                   AGE       REQUESTOR                 CONDITION
node-csr-c69HXe7aYcqkS1bKmH4faEnHAWxn6i2bHZ2mD04jZyQ   1m        system:bootstrap:878f07   Approved,Issued
</span></code></pre></div></div>

<p>Only after <code class="highlighter-rouge">kubectl certificate approve</code> has been run, <code class="highlighter-rouge">kubeadm join</code> can proceed.</p>

<h3 id="turning-off-public-access-to-the-cluster-info-configmap">Turning off public access to the cluster-info ConfigMap</h3>

<p>In order to achieve the joining flow using the token as the only piece of validation information, a
public ConfigMap with some data needed for validation of the master’s identity is exposed publicly by
default. While there is no private data in this ConfigMap, some users are sensitive and wish to turn
it off regardless. Doing so will disable the ability to use the <code class="highlighter-rouge">--discovery-token</code> flag of the
<code class="highlighter-rouge">kubeadm join</code> flow. Here are the steps to do so:</p>

<p>Fetch the <code class="highlighter-rouge">cluster-info</code> file from the API Server:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> kubectl <span class="nt">-n</span> kube-public get cm cluster-info <span class="nt">-oyaml</span> | <span class="nb">grep</span> <span class="s2">"kubeconfig:"</span> <span class="nt">-A11</span> | <span class="nb">grep</span> <span class="s2">"apiVersion"</span> <span class="nt">-A10</span> | sed <span class="s2">"s/    //"</span> | tee cluster-info.yaml
<span class="go">apiVersion: v1
clusters:
- cluster:
</span><span class="gp">    certificate-authority-data: &lt;ca-cert&gt;</span>
<span class="gp">    server: https://&lt;ip&gt;</span>:&lt;port&gt;
<span class="go">  name: ""
contexts: []
current-context: ""
kind: Config
preferences: {}
users: []
</span></code></pre></div></div>

<p>You can then use the <code class="highlighter-rouge">cluster-info.yaml</code> file as an argument to <code class="highlighter-rouge">kubeadm join --discovery-file</code>.</p>

<p>Turning of public access to the <code class="highlighter-rouge">cluster-info</code> ConfigMap:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> kubectl <span class="nt">-n</span> kube-public delete rolebinding kubeadm:bootstrap-signer-clusterinfo
</code></pre></div></div>

<p>These command should be run after <code class="highlighter-rouge">kubeadm init</code> but before <code class="highlighter-rouge">kubeadm join</code>.</p>

<h2 id="manage-tokens">Managing Tokens</h2>

<p>You can use the <code class="highlighter-rouge">kubeadm</code> tool to manage tokens on a running cluster.  It will
automatically grab the default admin credentials on a master from a <code class="highlighter-rouge">kubeadm</code>
created cluster (<code class="highlighter-rouge">/etc/kubernetes/admin.conf</code>).  You can specify an alternate
kubeconfig file for credentials with the <code class="highlighter-rouge">--kubeconfig</code> to the following
commands.</p>

<ul>
  <li><code class="highlighter-rouge">kubeadm token list</code> Lists the tokens along with when they expire and what the
approved usages are.</li>
  <li><code class="highlighter-rouge">kubeadm token create</code> Creates a new token.
    <ul>
      <li><code class="highlighter-rouge">--description</code> Set the description on the new token.</li>
      <li><code class="highlighter-rouge">--ttl duration</code> Set expiration time of the token as a delta from “now”.
Default is 0 for no expiration. The unit of the duration is seconds.</li>
      <li><code class="highlighter-rouge">--usages</code> Set the ways that the token can be used.  The default is
<code class="highlighter-rouge">signing,authentication</code>.  These are the usages as described above.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">kubeadm token delete &lt;token id&gt;|&lt;token id&gt;.&lt;token secret&gt;</code> Delete a token.
The token can either be identified with just an ID or with the entire token
value.  Only the ID is used; the token is still deleted if the secret does not
match.</li>
</ul>

<p>In addition, you can use the <code class="highlighter-rouge">kubeadm token generate</code> command to locally creates
a new token.  This token is of the correct form for specifying with the
<code class="highlighter-rouge">--token</code> argument to <code class="highlighter-rouge">kubeadm init</code>.</p>

<p>For the gory details on how the tokens are implemented (including managing them
outside of kubeadm) see the <a href="/docs/admin/bootstrap-tokens/">Bootstrap Token
docs</a>.</p>

<h2 id="automating-kubeadm">Automating kubeadm</h2>

<p>Rather than copying the token you obtained from <code class="highlighter-rouge">kubeadm init</code> to each node, as
in the <a href="/docs/admin/kubeadm/">basic kubeadm tutorial</a>, you can
parallelize the token distribution for easier automation. To implement this
automation, you must know the IP address that the master will have after it is
started.</p>

<ol>
  <li>
    <p>Generate a token. This token must have the form  <code class="highlighter-rouge">&lt;6 character string&gt;.&lt;16
character string&gt;</code>.  More formally, it must match the regex:
<code class="highlighter-rouge">[a-z0-9]{6}\.[a-z0-9]{16}</code>.</p>

    <p>kubeadm can generate a token for you:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubeadm token generate
</code></pre></div>    </div>
  </li>
  <li>
    <p>Start both the master node and the worker nodes concurrently with this token.
As they come up they should find each other and form the cluster.  The same
<code class="highlighter-rouge">--token</code> argument can be used on both <code class="highlighter-rouge">kubeadm init</code> and <code class="highlighter-rouge">kubeadm join</code>.</p>
  </li>
</ol>

<p>Once the cluster is up, you can grab the admin credentials from the master node
at <code class="highlighter-rouge">/etc/kubernetes/admin.conf</code> and use that to talk to the cluster.</p>

<h2 id="use-kubeadm-with-other-cri-runtimes">Use Kubeadm with other CRI runtimes</h2>

<p>Since <a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG.md#node-components-1">Kubernetes 1.6 release</a>, Kubernetes container runtimes have been transferred to using CRI by default. Currently, the build-in container runtime is Docker which is enabled by build-in <code class="highlighter-rouge">dockershim</code> in <code class="highlighter-rouge">kubelet</code>.</p>

<p>Using other CRI based runtimes with kubeadm is very simple, and currently supported runtimes are:</p>

<ul>
  <li><a href="https://github.com/kubernetes-incubator/cri-o">cri-o</a></li>
  <li><a href="https://github.com/kubernetes/frakti">frakti</a></li>
  <li><a href="https://github.com/kubernetes-incubator/rktlet">rkt</a></li>
</ul>

<p>After you have successfully installed <code class="highlighter-rouge">kubeadm</code> and <code class="highlighter-rouge">kubelet</code>, please follow these two steps:</p>

<ol>
  <li>
    <p>Install runtime shim on every node. You will need to follow the installation document in the runtime shim project listing above.</p>
  </li>
  <li>
    <p>Configure kubelet to use remote CRI runtime. Please remember to change <code class="highlighter-rouge">RUNTIME_ENDPOINT</code> to your own value like <code class="highlighter-rouge">/var/run/{your_runtime}.sock</code>:</p>
  </li>
</ol>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span><span class="nb">cat</span> <span class="o">&gt;</span> /etc/systemd/system/kubelet.service.d/20-cri.conf <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
Environment="KUBELET_EXTRA_ARGS=--container-runtime=remote --container-runtime-endpoint=</span><span class="nv">$RUNTIME_ENDPOINT</span><span class="sh"> --feature-gates=AllAlpha=true"
</span><span class="no">EOF
</span>  <span class="nv">$ </span>systemctl daemon-reload
</code></pre></div></div>

<p>Now <code class="highlighter-rouge">kubelet</code> is ready to use the specified CRI runtime, and you can continue with <code class="highlighter-rouge">kubeadm init</code> and <code class="highlighter-rouge">kubeadm join</code> workflow to deploy Kubernetes cluster.</p>

<h2 id="running-kubeadm-without-an-internet-connection">Running kubeadm without an internet connection</h2>

<p>All of the control plane components run in Pods started by the kubelet and
the following images are required for the cluster works will be automatically
pulled by the kubelet if they don’t exist locally while <code class="highlighter-rouge">kubeadm init</code> is initializing
your master:</p>

<table>
  <thead>
    <tr>
      <th>Image Name</th>
      <th>v1.6 release branch version</th>
      <th>v1.7 release branch version</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>gcr.io/google_containers/kube-apiserver-${ARCH}</td>
      <td>v1.6.x</td>
      <td>v1.7.x</td>
    </tr>
    <tr>
      <td>gcr.io/google_containers/kube-controller-manager-${ARCH}</td>
      <td>v1.6.x</td>
      <td>v1.7.x</td>
    </tr>
    <tr>
      <td>gcr.io/google_containers/kube-scheduler-${ARCH}</td>
      <td>v1.6.x</td>
      <td>v1.7.x</td>
    </tr>
    <tr>
      <td>gcr.io/google_containers/kube-proxy-${ARCH}</td>
      <td>v1.6.x</td>
      <td>v1.7.x</td>
    </tr>
    <tr>
      <td>gcr.io/google_containers/etcd-${ARCH}</td>
      <td>3.0.17</td>
      <td>3.0.17</td>
    </tr>
    <tr>
      <td>gcr.io/google_containers/pause-${ARCH}</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <td>gcr.io/google_containers/k8s-dns-sidecar-${ARCH}</td>
      <td>1.14.1</td>
      <td>1.14.4</td>
    </tr>
    <tr>
      <td>gcr.io/google_containers/k8s-dns-kube-dns-${ARCH}</td>
      <td>1.14.1</td>
      <td>1.14.4</td>
    </tr>
    <tr>
      <td>gcr.io/google_containers/k8s-dns-dnsmasq-nanny-${ARCH}</td>
      <td>1.14.1</td>
      <td>1.14.4</td>
    </tr>
  </tbody>
</table>

<p>Here <code class="highlighter-rouge">v1.7.x</code> means the “latest patch release of the v1.7 branch”.</p>

<p><code class="highlighter-rouge">${ARCH}</code> can be one of: <code class="highlighter-rouge">amd64</code>, <code class="highlighter-rouge">arm</code>, <code class="highlighter-rouge">arm64</code>, <code class="highlighter-rouge">ppc64le</code> or <code class="highlighter-rouge">s390x</code>.</p>

<h2 id="managing-the-kubeadm-drop-in-file-for-the-kubelet">Managing the kubeadm drop-in file for the kubelet</h2>

<p>The kubeadm deb package ships with configuration for how the kubelet should
be run. Note that the <code class="highlighter-rouge">kubeadm</code> CLI command will never touch this drop-in file.
This drop-in file belongs to the kubeadm deb/rpm package.</p>

<p>This is what it looks like in v1.7:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Service]
Environment="KUBELET_KUBECONFIG_ARGS=--kubeconfig=/etc/kubernetes/kubelet.conf --require-kubeconfig=true"
Environment="KUBELET_SYSTEM_PODS_ARGS=--pod-manifest-path=/etc/kubernetes/manifests --allow-privileged=true"
Environment="KUBELET_NETWORK_ARGS=--network-plugin=cni --cni-conf-dir=/etc/cni/net.d --cni-bin-dir=/opt/cni/bin"
Environment="KUBELET_DNS_ARGS=--cluster-dns=10.96.0.10 --cluster-domain=cluster.local"
Environment="KUBELET_AUTHZ_ARGS=--authorization-mode=Webhook --client-ca-file=/etc/kubernetes/pki/ca.crt"
Environment="KUBELET_CADVISOR_ARGS=--cadvisor-port=0"
ExecStart=
ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_SYSTEM_PODS_ARGS $KUBELET_NETWORK_ARGS $KUBELET_DNS_ARGS $KUBELET_AUTHZ_ARGS $KUBELET_CADVISOR_ARGS $KUBELET_EXTRA_ARGS
</code></pre></div></div>

<p>A breakdown of what/why:</p>

<ul>
  <li><code class="highlighter-rouge">--kubeconfig=/etc/kubernetes/kubelet.conf</code> points to the kubeconfig file that
 tells the kubelet where the API server is. This file also has the kubelet’s
 credentials.</li>
  <li><code class="highlighter-rouge">--require-kubeconfig=true</code> the kubelet should fail fast if the kubeconfig file
 is not present. This makes the kubelet crashloop during the time the service is
 started until <code class="highlighter-rouge">kubeadm init</code> is run.</li>
  <li><code class="highlighter-rouge">--pod-manifest-path=/etc/kubernetes/manifests</code> specifies from where to read
 Static Pod manifests used for spinning up the control plane</li>
  <li><code class="highlighter-rouge">--allow-privileged=true</code> allows this kubelet to run privileged Pods</li>
  <li><code class="highlighter-rouge">--network-plugin=cni</code> uses CNI networking</li>
  <li><code class="highlighter-rouge">--cni-conf-dir=/etc/cni/net.d</code> specifies where to look for the
 <a href="https://github.com/containernetworking/cni/blob/master/SPEC.md">CNI spec file(s)</a></li>
  <li><code class="highlighter-rouge">--cni-bin-dir=/opt/cni/bin</code> specifies where to look for the actual CNI binaries</li>
  <li><code class="highlighter-rouge">--cluster-dns=10.96.0.10</code> use this cluster-internal DNS server for <code class="highlighter-rouge">nameserver</code>
 entries in Pods’ <code class="highlighter-rouge">/etc/resolv.conf</code></li>
  <li><code class="highlighter-rouge">--cluster-domain=cluster.local</code> uses this cluster-internal DNS domain for
 <code class="highlighter-rouge">search</code> entries in Pods’ <code class="highlighter-rouge">/etc/resolv.conf</code></li>
  <li><code class="highlighter-rouge">--client-ca-file=/etc/kubernetes/pki/ca.crt</code> authenticates requests to the Kubelet
 API using this CA certificate.</li>
  <li><code class="highlighter-rouge">--authorization-mode=Webhook</code> authorizes requests to the Kubelet API by <code class="highlighter-rouge">POST</code>-ing
 a <code class="highlighter-rouge">SubjectAccessReview</code> to the API Server</li>
  <li>
    <p><code class="highlighter-rouge">--cadvisor-port=0</code> disables cAdvisor from listening to <code class="highlighter-rouge">0.0.0.0:4194</code> by default.
 cAdvisor will still be run inside of the kubelet and its API can be accessed at
 <code class="highlighter-rouge">https://{node-ip}:10250/stats/</code>. If you want to enable cAdvisor to listen on a
 wide-open port, run:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> sed -e "/cadvisor-port=0/d" -i /etc/systemd/system/kubelet.service.d/10-kubeadm.conf
 systemctl daemon-reload
 systemctl restart kubelet
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="cloudprovider-integrations-experimental">Cloudprovider integrations (experimental)</h2>

<p>Enabling specific cloud providers is a common request. This currently requires
manual configuration and is therefore not yet fully supported. If you wish to do
so, edit the kubeadm drop-in for the kubelet service
(<code class="highlighter-rouge">/etc/systemd/system/kubelet.service.d/10-kubeadm.conf</code>) on all nodes,
including the master. If your cloud provider requires any extra packages
installed on the host, for example for volume mounting/unmounting, install those
packages.</p>

<p>Specify the <code class="highlighter-rouge">--cloud-provider</code> flag for the kubelet and set it to the cloud of your
choice. If your cloudprovider requires a configuration file, create the file
<code class="highlighter-rouge">/etc/kubernetes/cloud-config</code> on every node. The exact format and content of
that file depends on the requirements imposed by your cloud provider. If you use
the <code class="highlighter-rouge">/etc/kubernetes/cloud-config</code> file, you must append it to the kubelet
arguments as follows: <code class="highlighter-rouge">--cloud-config=/etc/kubernetes/cloud-config</code></p>

<p>Note that there is most likely other per-provider configuration that may be needed
(IAM roles for AWS) that is currently underdocumented.</p>

<p>Next, specify the cloud provider in the kubeadm config file.  Create a file called
<code class="highlighter-rouge">kubeadm.conf</code> with the following contents:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">kind</span><span class="pi">:</span> <span class="s">MasterConfiguration</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubeadm.k8s.io/v1alpha1</span>
<span class="na">cloudProvider</span><span class="pi">:</span> <span class="s">&lt;cloud provider&gt;</span>
</code></pre></div></div>

<p>Lastly, run <code class="highlighter-rouge">kubeadm init --config=kubeadm.conf</code> to bootstrap your cluster with
the cloud provider.</p>

<p>This workflow is not yet fully supported, however we hope to make it extremely
easy to spin up clusters with cloud providers in the future. (See <a href="https://github.com/kubernetes/community/pull/128">this
proposal</a> for more
information) The <a href="https://github.com/kubernetes/kubernetes/pull/29459">Kubelet Dynamic
Settings</a> feature may also
help to fully automate this process in the future.</p>

<h2 id="environment-variables">Environment variables</h2>

<p>There are some environment variables that modify the way that kubeadm works.
Most users will have no need to set these. These environment variables are a
short-term solution, eventually they will be integrated in the kubeadm
configuration file.</p>

<p><strong>Note:</strong> These environment variables are deprecated and will stop functioning in v1.8!</p>

<table>
  <thead>
    <tr>
      <th>Variable</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">KUBE_KUBERNETES_DIR</code></td>
      <td><code class="highlighter-rouge">/etc/kubernetes</code></td>
      <td>Where most configuration files are written to and read from</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">KUBE_HYPERKUBE_IMAGE</code></td>
      <td> </td>
      <td>If set, use a single hyperkube image with this name. If not set, individual images per server component will be used.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">KUBE_ETCD_IMAGE</code></td>
      <td><code class="highlighter-rouge">gcr.io/google_containers/etcd-&lt;arch&gt;:3.0.17</code></td>
      <td>The etcd container image to use.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">KUBE_REPO_PREFIX</code></td>
      <td><code class="highlighter-rouge">gcr.io/google_containers</code></td>
      <td>The image prefix for all images that are used.</td>
    </tr>
  </tbody>
</table>

<p>If <code class="highlighter-rouge">KUBE_KUBERNETES_DIR</code> is specified, you may need to rewrite the arguments of the kubelet.
(e.g. –kubeconfig, –pod-manifest-path)</p>

<p>If <code class="highlighter-rouge">KUBE_REPO_PREFIX</code> is specified, you may need to set the kubelet flag
<code class="highlighter-rouge">--pod-infra-container-image</code> which specifies which pause image to use.</p>

<p>Defaults to <code class="highlighter-rouge">gcr.io/google_containers/pause-${ARCH}:3.0</code> where <code class="highlighter-rouge">${ARCH}</code>
can be one of <code class="highlighter-rouge">amd64</code>, <code class="highlighter-rouge">arm</code>, <code class="highlighter-rouge">arm64</code>, <code class="highlighter-rouge">ppc64le</code> or <code class="highlighter-rouge">s390x</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> <span class="o">&gt;</span> /etc/systemd/system/kubelet.service.d/20-pod-infra-image.conf <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
[Service]
Environment="KUBELET_EXTRA_ARGS=--pod-infra-container-image=&lt;your-image&gt;"
</span><span class="no">EOF
</span>systemctl daemon-reload
systemctl restart kubelet
</code></pre></div></div>

<p>If you want to use kubeadm with an http proxy, you may need to configure it to
support http_proxy, https_proxy, or no_proxy.</p>

<p>For example, if your kube master node IP address is 10.18.17.16 and you have a
proxy which supports both http/https on 10.18.17.16 port 8080, you can use the
following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PROXY_PORT</span><span class="o">=</span>8080
<span class="nb">export </span><span class="nv">PROXY_IP</span><span class="o">=</span>10.18.17.16
<span class="nb">export </span><span class="nv">http_proxy</span><span class="o">=</span>http://<span class="nv">$PROXY_IP</span>:<span class="nv">$PROXY_PORT</span>
<span class="nb">export </span><span class="nv">HTTP_PROXY</span><span class="o">=</span><span class="nv">$http_proxy</span>
<span class="nb">export </span><span class="nv">https_proxy</span><span class="o">=</span><span class="nv">$http_proxy</span>
<span class="nb">export </span><span class="nv">HTTPS_PROXY</span><span class="o">=</span><span class="nv">$http_proxy</span>
<span class="nb">export </span><span class="nv">no_proxy</span><span class="o">=</span><span class="s2">"localhost,127.0.0.1,localaddress,.localdomain.com,example.com,10.18.17.16"</span>
</code></pre></div></div>

<p>Remember to change <code class="highlighter-rouge">proxy_ip</code> and add a kube master node IP address to
<code class="highlighter-rouge">no_proxy</code>.</p>

<h2 id="using-custom-certificates">Using custom certificates</h2>

<p>By default kubeadm will generate all the certificates needed for a cluster to run.
You can override this behaviour by providing your own certificates.</p>

<p>To do so, you must place them in whatever directory is specified by the
<code class="highlighter-rouge">--cert-dir</code> flag or <code class="highlighter-rouge">CertificatesDir</code> configuration file key. By default this
is <code class="highlighter-rouge">/etc/kubernetes/pki</code>.</p>

<p>If a given certificate and private key pair both exist, kubeadm will skip the
generation step and those files will be validated and used for the prescribed
use-case.</p>

<p>This means you can, for example, prepopulate <code class="highlighter-rouge">/etc/kubernetes/pki/ca.crt</code>
and <code class="highlighter-rouge">/etc/kubernetes/pki/ca.key</code> with an existing CA, which then will be used
for signing the rest of the certs.</p>

<h2 id="releases-and-release-notes">Releases and release notes</h2>

<p>If you already have kubeadm installed and want to upgrade, run <code class="highlighter-rouge">apt-get update
&amp;&amp; apt-get upgrade</code> or <code class="highlighter-rouge">yum update</code> to get the latest version of kubeadm.</p>

<p>Refer to the
<a href="https://git.k8s.io/kubeadm/CHANGELOG.md">CHANGELOG.md</a>
for more information.</p>


        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/admin/kubeadm.md?pixel" alt="Analytics" /></a></p>
        
	
        <script type="text/javascript">
            PDRTJS_settings_8345992 = {
                "id" : "8345992",
                "unique_id" : "/docs/admin/kubeadm/",
                "title" : "kubeadm Setup Tool Reference Guide",
                "permalink" : "http://kubernetes.github.io/docs/admin/kubeadm/"
            };
            (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
        <a href="" onclick="window.open('https://github.com/kubernetes/kubernetes.github.io/issues/new?title=Issue%20with%20' +
        'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
	
        
          <a href="/editdocs#docs/admin/kubeadm.md" class="button issue">Edit this Page</a>
        
    
    </div>
</section>

<footer>
    <main class="light-text">
        <nav>
            <a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a>
            <a href="/docs/home/">Documentation</a>
            <a href="http://blog.kubernetes.io/">Blog</a>
            <a href="/partners/">Partners</a>
            <a href="/community/">Community</a>
            <a href="/case-studies/">Case Studies</a>
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                <a href="/docs/setup/pick-right-solution/" class="button">Get Kubernetes</a>
                <a href="https://github.com/kubernetes/kubernetes" class="button">Contribute</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2017 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2017 The Linux Foundation&reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our Trademark Usage page: <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">https://www.linuxfoundation.org/trademark-usage</a>
        </div>
    </main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
.cse .gsc-control-cse, .gsc-control-cse, {
    padding: 0;
}
  .gsc-control-cse table, .gsc-control-cse-en table {
      margin:0px !important;
  }
  .gsc-above-wrapper-area {
      border-bottom: 0;
  }
</style>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36037335-10', 'auto');
ga('send', 'pageview');

// hide docs nav area if no nav is present, or if nav only contains a link to the current page
(function () {
    window.addEventListener('DOMContentLoaded', init)

        // play nice with our neighbors
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
            var container = toc.querySelector('.container')

                // container is built dynamically, so it may not be present on the first runloop
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>

<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
    <!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->


</body>
</html>
